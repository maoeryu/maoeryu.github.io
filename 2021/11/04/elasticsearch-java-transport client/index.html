<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"maoeryu.github.io","root":"/","images":"/images","scheme":"Pisces","version":"8.2.1","exturl":false,"sidebar":{"position":"left","width":200,"display":"post","padding":7,"offset":5},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}};
  </script>
<meta name="description" content="elasticsearch版本为7.10,需要java版本为1.8以上. maven12345&lt;dependency&gt;    &lt;groupId&gt;org.elasticsearch.client&lt;&#x2F;groupId&gt;    &lt;artifactId&gt;transport&lt;&#x2F;artifactId&gt;    &lt;version&gt;7.10.0&amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="elasticsearch-java-transport client">
<meta property="og:url" content="https://maoeryu.github.io/2021/11/04/elasticsearch-java-transport%20client/index.html">
<meta property="og:site_name" content="FlyingPig">
<meta property="og:description" content="elasticsearch版本为7.10,需要java版本为1.8以上. maven12345&lt;dependency&gt;    &lt;groupId&gt;org.elasticsearch.client&lt;&#x2F;groupId&gt;    &lt;artifactId&gt;transport&lt;&#x2F;artifactId&gt;    &lt;version&gt;7.10.0&amp;">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-11-03T16:00:00.000Z">
<meta property="article:modified_time" content="2022-07-26T02:50:36.870Z">
<meta property="article:author" content="maoeryu">
<meta property="article:tag" content="elasticsearch">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://maoeryu.github.io/2021/11/04/elasticsearch-java-transport%20client/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>
<title>elasticsearch-java-transport client | FlyingPig</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">FlyingPig</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#maven"><span class="nav-number">1.</span> <span class="nav-text">maven</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#client"><span class="nav-number">2.</span> <span class="nav-text">client</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%8F%82%E6%95%B0"><span class="nav-number">2.1.</span> <span class="nav-text">客户端参数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#common"><span class="nav-number">3.</span> <span class="nav-text">common</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#document"><span class="nav-number">4.</span> <span class="nav-text">document</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%95%E6%96%87%E6%A1%A3api"><span class="nav-number">4.1.</span> <span class="nav-text">单文档api</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#index"><span class="nav-number">4.1.1.</span> <span class="nav-text">index</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8map"><span class="nav-number">4.1.1.1.</span> <span class="nav-text">使用map</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8XContentFactory"><span class="nav-number">4.1.1.2.</span> <span class="nav-text">使用XContentFactory</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#get"><span class="nav-number">4.1.2.</span> <span class="nav-text">get</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#delete"><span class="nav-number">4.1.3.</span> <span class="nav-text">delete</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#update"><span class="nav-number">4.1.4.</span> <span class="nav-text">update</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8prepareupdate"><span class="nav-number">4.1.4.1.</span> <span class="nav-text">使用prepareupdate</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8script"><span class="nav-number">4.1.4.2.</span> <span class="nav-text">使用script</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#update-by-script"><span class="nav-number">4.1.4.3.</span> <span class="nav-text">update by script</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#upsert"><span class="nav-number">4.1.4.4.</span> <span class="nav-text">upsert</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E6%96%87%E6%A1%A3api"><span class="nav-number">4.2.</span> <span class="nav-text">多文档api</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#multi-get"><span class="nav-number">4.2.1.</span> <span class="nav-text">multi get</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#bulk"><span class="nav-number">4.2.2.</span> <span class="nav-text">bulk</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#using-bulk-processor"><span class="nav-number">4.2.3.</span> <span class="nav-text">using bulk processor</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E5%85%A8%E5%B1%80%E5%8F%82%E6%95%B0"><span class="nav-number">4.2.3.1.</span> <span class="nav-text">设置全局参数</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#reindex"><span class="nav-number">4.2.4.</span> <span class="nav-text">reindex</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#update-by-query"><span class="nav-number">4.2.5.</span> <span class="nav-text">update by query</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BB%BB%E5%8A%A1api"><span class="nav-number">4.2.5.1.</span> <span class="nav-text">任务api</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#delete-by-query"><span class="nav-number">4.2.6.</span> <span class="nav-text">delete by query</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#search"><span class="nav-number">5.</span> <span class="nav-text">search</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#using-scroll"><span class="nav-number">5.1.</span> <span class="nav-text">using scroll</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#multisearch"><span class="nav-number">5.2.</span> <span class="nav-text">multisearch</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#using-aggregations"><span class="nav-number">5.3.</span> <span class="nav-text">using aggregations</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#terminate-after"><span class="nav-number">5.4.</span> <span class="nav-text">terminate after</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#search-template"><span class="nav-number">5.5.</span> <span class="nav-text">search template</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#aggregations"><span class="nav-number">6.</span> <span class="nav-text">aggregations</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#structuring-agg"><span class="nav-number">6.1.</span> <span class="nav-text">structuring agg</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#metrics-agg"><span class="nav-number">6.2.</span> <span class="nav-text">metrics agg</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#bucket-agg"><span class="nav-number">6.3.</span> <span class="nav-text">bucket agg</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5"><span class="nav-number">7.</span> <span class="nav-text">查询语句</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8C%B9%E9%85%8D%E6%89%80%E6%9C%89"><span class="nav-number">7.1.</span> <span class="nav-text">匹配所有</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E6%9C%AC%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.2.</span> <span class="nav-text">文本查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#matchQuery"><span class="nav-number">7.2.1.</span> <span class="nav-text">matchQuery</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#multiMatchQuery"><span class="nav-number">7.2.2.</span> <span class="nav-text">multiMatchQuery</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#commonTermsQuery"><span class="nav-number">7.2.3.</span> <span class="nav-text">commonTermsQuery</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#queryStringQuery"><span class="nav-number">7.2.4.</span> <span class="nav-text">queryStringQuery</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#simpleQueryStringQuery"><span class="nav-number">7.2.5.</span> <span class="nav-text">simpleQueryStringQuery</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.3.</span> <span class="nav-text">条件查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#term%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.3.1.</span> <span class="nav-text">term查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#terms%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.3.2.</span> <span class="nav-text">terms查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#range%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.3.3.</span> <span class="nav-text">range查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#exists%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.3.4.</span> <span class="nav-text">exists查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#prefix%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.3.5.</span> <span class="nav-text">prefix查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E9%85%8D%E7%AC%A6%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.3.6.</span> <span class="nav-text">通配符查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#regexp%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.3.7.</span> <span class="nav-text">regexp查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.3.8.</span> <span class="nav-text">模糊查询</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%8D%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.4.</span> <span class="nav-text">复合查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#constant-score%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.4.1.</span> <span class="nav-text">constant_score查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#bool%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.4.2.</span> <span class="nav-text">bool查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#dis-max%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.4.3.</span> <span class="nav-text">dis_max查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#function-score%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.4.4.</span> <span class="nav-text">function_score查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#boosting%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.4.5.</span> <span class="nav-text">boosting查询</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#joining"><span class="nav-number">7.5.</span> <span class="nav-text">joining</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B5%8C%E5%A5%97%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.5.1.</span> <span class="nav-text">嵌套查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.5.2.</span> <span class="nav-text">子查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%88%B6%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.5.3.</span> <span class="nav-text">父查询</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#geo"><span class="nav-number">7.6.</span> <span class="nav-text">geo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%93%E7%94%A8%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.7.</span> <span class="nav-text">专用查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#more-like-this%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.7.1.</span> <span class="nav-text">more_like_this查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#script%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.7.2.</span> <span class="nav-text">script查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.7.3.</span> <span class="nav-text">过滤查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#wrapper%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.7.4.</span> <span class="nav-text">wrapper查询</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.8.</span> <span class="nav-text">范围查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#span-term%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.8.1.</span> <span class="nav-text">span_term查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#span-multi%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.8.2.</span> <span class="nav-text">span_multi查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#span-first%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.8.3.</span> <span class="nav-text">span_first查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#span-near%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.8.4.</span> <span class="nav-text">span_near查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#span-or%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.8.5.</span> <span class="nav-text">span_or查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#span-not%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.8.6.</span> <span class="nav-text">span_not查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#span-containing%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.8.7.</span> <span class="nav-text">span_containing查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#span-within%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.8.8.</span> <span class="nav-text">span_within查询</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#java-api-administration"><span class="nav-number">8.</span> <span class="nav-text">java api administration</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#indices"><span class="nav-number">8.1.</span> <span class="nav-text">indices</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="nav-number">8.1.1.</span> <span class="nav-text">创建索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#put-mapping"><span class="nav-number">8.1.2.</span> <span class="nav-text">put mapping</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0mapping"><span class="nav-number">8.1.2.1.</span> <span class="nav-text">更新mapping</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#refresh"><span class="nav-number">8.1.3.</span> <span class="nav-text">refresh</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#get-setting"><span class="nav-number">8.1.4.</span> <span class="nav-text">get setting</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#update-indices-setting"><span class="nav-number">8.1.5.</span> <span class="nav-text">update indices setting</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cluster"><span class="nav-number">8.2.</span> <span class="nav-text">cluster</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#health"><span class="nav-number">8.2.1.</span> <span class="nav-text">health</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#wait-for-status"><span class="nav-number">8.2.2.</span> <span class="nav-text">wait for status</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#stored-scripts"><span class="nav-number">8.2.3.</span> <span class="nav-text">stored scripts</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">maoeryu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">221</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://maoeryu.github.io/2021/11/04/elasticsearch-java-transport%20client/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="maoeryu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FlyingPig">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          elasticsearch-java-transport client
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-11-04 00:00:00" itemprop="dateCreated datePublished" datetime="2021-11-04T00:00:00+08:00">2021-11-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-07-26 10:50:36" itemprop="dateModified" datetime="2022-07-26T10:50:36+08:00">2022-07-26</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>elasticsearch版本为7.10,需要java版本为1.8以上.</p>
<h2 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;transport&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;7.10.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h2 id="client"><a href="#client" class="headerlink" title="client"></a>client</h2><p>使用java客户端对现在集群进行index/get/delete/search操作.</p>
<blockquote>
<p>transport client在7.0.0版本之后已弃用.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> TransportClient client;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">  Settings.Builder builder = Settings.builder();</span><br><span class="line">  <span class="comment">// 配置文件中集群名称</span></span><br><span class="line">  builder.put(<span class="string">&quot;cluster.name&quot;</span>, <span class="string">&quot;logging-monitor&quot;</span>);</span><br><span class="line">  Settings settings = builder.build();</span><br><span class="line">  client = <span class="keyword">new</span> PreBuiltTransportClient(settings);</span><br><span class="line">  <span class="comment">// client = new PreBuiltTransportClient(Settings.EMPTY);</span></span><br><span class="line">  client.addTransportAddress(<span class="keyword">new</span> TransportAddress(InetAddress.getByName(<span class="string">&quot;oceanbase004&quot;</span>), <span class="number">9300</span>));</span><br><span class="line">  client.addTransportAddress(<span class="keyword">new</span> TransportAddress(InetAddress.getByName(<span class="string">&quot;oceanbase004&quot;</span>), <span class="number">9311</span>));</span><br><span class="line">  client.addTransportAddress(<span class="keyword">new</span> TransportAddress(InetAddress.getByName(<span class="string">&quot;oceanbase004&quot;</span>), <span class="number">9321</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@After</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  client.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>传输客户端具有群集嗅探功能,可动态添加新主机和删除旧主机.<br>启用嗅探后,传输客户端将连接到其内部节点列表中的节点,该列表是通过调用addTransportAddress.<br>在此之后,客户端将调用这些节点上的内部群集状态API,以发现可用的数据节点.<br>客户机的内部节点列表将仅替换为这些数据节点.<br>默认情况下,此列表每五秒刷新一次.</p>
<h3 id="客户端参数"><a href="#客户端参数" class="headerlink" title="客户端参数"></a>客户端参数</h3><p><code>client.transport.ignore_cluster_name</code><br>设置为true,忽略已连接节点的clustername验证.</p>
<p><code>client.transport.ping_timeout</code><br>等待节点发出ping响应的时间,默认为5s.</p>
<p><code>client.transport.nodes_sampler_interval</code><br>Ping与所列节点的连接频率,默认为5s.</p>
<p><code>client.transport.sniff</code><br>设置为true,启用嗅探.</p>
<h2 id="common"><a href="#common" class="headerlink" title="common"></a>common</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(Object... objects)</span> </span>&#123;</span><br><span class="line">  Arrays.stream(objects).map(o -&gt; o + <span class="string">&quot;|&quot;</span>).forEach(System.out::print);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="document"><a href="#document" class="headerlink" title="document"></a>document</h2><h3 id="单文档api"><a href="#单文档api" class="headerlink" title="单文档api"></a>单文档api</h3><p>所有curd都是单索引api,这个index参数接受单个索引名称,或别名指向单个索引.</p>
<h4 id="index"><a href="#index" class="headerlink" title="index"></a>index</h4><p>未提供id时,自动生成.</p>
<h5 id="使用map"><a href="#使用map" class="headerlink" title="使用map"></a>使用map</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">map.put(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;tom1&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;postDate&quot;</span>,<span class="keyword">new</span> Date());</span><br><span class="line">map.put(<span class="string">&quot;message&quot;</span>,<span class="string">&quot;trying out Elasticsearch&quot;</span>);</span><br><span class="line"></span><br><span class="line">IndexResponse response = client.prepareIndex(<span class="string">&quot;twitter&quot;</span>, <span class="string">&quot;_doc&quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">    .setSource(map).get();</span><br><span class="line"></span><br><span class="line">String index = response.getIndex();</span><br><span class="line">String type = response.getType();</span><br><span class="line">String id = response.getId();</span><br><span class="line"><span class="keyword">long</span> version = response.getVersion();</span><br><span class="line">RestStatus status = response.status();</span><br><span class="line">DocWriteResponse.Result result = response.getResult();</span><br><span class="line">Util.print(index, type, id, version, status, result);</span><br></pre></td></tr></table></figure>

<p>twitter|_doc|1|8|OK|UPDATED|<br>第一次插入时result为CREATED</p>
<h5 id="使用XContentFactory"><a href="#使用XContentFactory" class="headerlink" title="使用XContentFactory"></a>使用XContentFactory</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">XContentBuilder builder = XContentFactory.jsonBuilder()</span><br><span class="line">    .startObject()</span><br><span class="line">    .field(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;tom2&quot;</span>)</span><br><span class="line">    .field(<span class="string">&quot;postDate&quot;</span>, <span class="keyword">new</span> Date())</span><br><span class="line">    .field(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;trying out Elasticsearch&quot;</span>)</span><br><span class="line">    .endObject();</span><br></pre></td></tr></table></figure>

<h4 id="get"><a href="#get" class="headerlink" title="get"></a>get</h4><p>需传入index/type/id.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GetResponse response = client.prepareGet(<span class="string">&quot;twitter&quot;</span>, <span class="string">&quot;_doc&quot;</span>, <span class="string">&quot;1&quot;</span>).get();</span><br><span class="line">String index = response.getIndex();</span><br><span class="line">String type = response.getType();</span><br><span class="line">String id = response.getId();</span><br><span class="line"><span class="keyword">long</span> version = response.getVersion();</span><br><span class="line"><span class="keyword">boolean</span> exists = response.isExists();</span><br><span class="line">Util.print(index, type, id, version, exists);</span><br><span class="line"></span><br><span class="line">String sourceAsString = response.getSourceAsString();</span><br><span class="line">System.out.println(sourceAsString);</span><br><span class="line">Map&lt;String, DocumentField&gt; fields = response.getFields();</span><br><span class="line">System.out.println(fields);</span><br></pre></td></tr></table></figure>

<p>twitter|_doc|1|8|true|<br>{&quot;postDate&quot;:&quot;2021-11-04T09:19:42.176Z&quot;,&quot;message&quot;:&quot;trying out Elasticsearch&quot;,&quot;user&quot;:&quot;tom1&quot;}<br>{}</p>
<p>twitter|_doc|1|-1|false|<br>未找到文档时,sourceAsString为null.</p>
<h4 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h4><p>需传入index/type/id.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DeleteResponse response = client.prepareDelete(<span class="string">&quot;twitter&quot;</span>, <span class="string">&quot;_doc&quot;</span>, <span class="string">&quot;2&quot;</span>).get();</span><br><span class="line">String index = response.getIndex();</span><br><span class="line">String type = response.getType();</span><br><span class="line">String id = response.getId();</span><br><span class="line"><span class="keyword">long</span> version = response.getVersion();</span><br><span class="line">RestStatus status = response.status();</span><br><span class="line"><span class="keyword">boolean</span> refresh = response.forcedRefresh();</span><br><span class="line">DocWriteResponse.Result result = response.getResult();</span><br><span class="line">Util.print(index, type, id, version, status, refresh, result);</span><br></pre></td></tr></table></figure>

<p>twitter|_doc|2|3|OK|false|DELETED|<br>未找到文档时,result为NOT_FOUND<br>twitter|_doc|1|1|NOT_FOUND|false|NOT_FOUND|</p>
<h4 id="update"><a href="#update" class="headerlink" title="update"></a>update</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; map = Maps.newHashMap();</span><br><span class="line">map.put(<span class="string">&quot;gender&quot;</span>, <span class="string">&quot;male&quot;</span>);</span><br><span class="line">UpdateRequest request = <span class="keyword">new</span> UpdateRequest();</span><br><span class="line">request.index(<span class="string">&quot;twitter&quot;</span>);</span><br><span class="line">request.type(<span class="string">&quot;_doc&quot;</span>);</span><br><span class="line">request.id(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">request.doc(map);</span><br><span class="line">UpdateResponse response = client.update(request).get();</span><br><span class="line">String index = response.getIndex();</span><br><span class="line">String type = response.getType();</span><br><span class="line">String id = response.getId();</span><br><span class="line"><span class="keyword">long</span> version = response.getVersion();</span><br><span class="line">RestStatus status = response.status();</span><br><span class="line">DocWriteResponse.Result result = response.getResult();</span><br><span class="line">Util.print(index, type, id, version, status, result);</span><br><span class="line"></span><br><span class="line">GetResult getResult = response.getGetResult();</span><br><span class="line">System.out.println(getResult);</span><br></pre></td></tr></table></figure>

<p>twitter|_doc|2|2|OK|UPDATED|<br>null<br>文档无更新时,result为NOOP,twitter|_doc|1|2|OK|NOOP|</p>
<h5 id="使用prepareupdate"><a href="#使用prepareupdate" class="headerlink" title="使用prepareupdate"></a>使用prepareupdate</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; map = Maps.newHashMap();</span><br><span class="line">map.put(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">UpdateResponse response = client.prepareUpdate(<span class="string">&quot;twitter&quot;</span>, <span class="string">&quot;_doc&quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">    .setDoc(map).get();</span><br></pre></td></tr></table></figure>

<p>twitter|_doc|1|3|OK|UPDATED|<br>文档存在时,twitter|_doc|1|10|OK|NOOP|</p>
<h5 id="使用script"><a href="#使用script" class="headerlink" title="使用script"></a>使用script</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UpdateResponse response = client.prepareUpdate(<span class="string">&quot;twitter&quot;</span>, <span class="string">&quot;_doc&quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">    .setScript(<span class="keyword">new</span> Script(<span class="string">&quot;ctx._source.age = \&quot;4\&quot;&quot;</span>)).get();</span><br></pre></td></tr></table></figure>

<p>twitter|_doc|1|5|OK|UPDATED|<br>文档存在时,twitter|_doc|1|9|OK|UPDATED|</p>
<h5 id="update-by-script"><a href="#update-by-script" class="headerlink" title="update by script"></a>update by script</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UpdateRequest request = <span class="keyword">new</span> UpdateRequest(<span class="string">&quot;twitter&quot;</span>, <span class="string">&quot;_doc&quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">    .script(<span class="keyword">new</span> Script(<span class="string">&quot;ctx._source.age = \&quot;3\&quot;&quot;</span>));</span><br><span class="line">UpdateResponse response = client.update(request).get();</span><br></pre></td></tr></table></figure>

<p>twitter|_doc|1|4|OK|UPDATED|<br>文档存在时,twitter|_doc|1|7|OK|UPDATED|</p>
<h5 id="upsert"><a href="#upsert" class="headerlink" title="upsert"></a>upsert</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; map = Maps.newHashMap();</span><br><span class="line">map.put(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">IndexRequest indexRequest = <span class="keyword">new</span> IndexRequest(<span class="string">&quot;twitter&quot;</span>, <span class="string">&quot;_doc&quot;</span>, <span class="string">&quot;4&quot;</span>)</span><br><span class="line">    .source(map);</span><br><span class="line"></span><br><span class="line">Map&lt;String, Object&gt; map2 = Maps.newHashMap();</span><br><span class="line">map.put(<span class="string">&quot;gender&quot;</span>, <span class="string">&quot;male&quot;</span>);</span><br><span class="line">UpdateRequest updateRequest = <span class="keyword">new</span> UpdateRequest(<span class="string">&quot;twitter&quot;</span>, <span class="string">&quot;_doc&quot;</span>, <span class="string">&quot;4&quot;</span>)</span><br><span class="line">    .doc(map2).upsert(indexRequest);</span><br><span class="line"></span><br><span class="line">UpdateResponse response = client.update(updateRequest).get();</span><br></pre></td></tr></table></figure>

<p>如果文档不存在,则插入indexRequest,twitter|_doc|4|1|CREATED|CREATED|<br>如果文档存在,则插入updateRequest,twitter|_doc|4|5|OK|UPDATED|<br>如果文档存在,更新无变化时,twitter|_doc|4|5|OK|NOOP|</p>
<h3 id="多文档api"><a href="#多文档api" class="headerlink" title="多文档api"></a>多文档api</h3><h4 id="multi-get"><a href="#multi-get" class="headerlink" title="multi get"></a>multi get</h4><p>可以添加单个或多个id,或其它索引.<br>itemResponse.isFailed为true表示索引不存在.<br>response.isExists为true表示id存在.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">MultiGetRequestBuilder prepareMultiGet = client.prepareMultiGet();</span><br><span class="line">prepareMultiGet.add(<span class="string">&quot;twitter&quot;</span>, <span class="string">&quot;_doc&quot;</span>, <span class="string">&quot;11&quot;</span>);</span><br><span class="line">prepareMultiGet.add(<span class="string">&quot;twitter&quot;</span>, <span class="string">&quot;_doc&quot;</span>, <span class="string">&quot;12&quot;</span>, <span class="string">&quot;13&quot;</span>, <span class="string">&quot;14&quot;</span>);</span><br><span class="line">prepareMultiGet.add(<span class="string">&quot;another&quot;</span>, <span class="string">&quot;_doc&quot;</span>, <span class="string">&quot;foo&quot;</span>);</span><br><span class="line">MultiGetResponse multiGetItemResponses = prepareMultiGet.get();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (MultiGetItemResponse itemResponse : multiGetItemResponses) &#123;</span><br><span class="line">  String id1 = itemResponse.getId();</span><br><span class="line">  String index1 = itemResponse.getIndex();</span><br><span class="line">  String type1 = itemResponse.getType();</span><br><span class="line">  <span class="keyword">boolean</span> failed = itemResponse.isFailed();</span><br><span class="line">  Util.print(index1, type1, id1, failed);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!failed) &#123;</span><br><span class="line">    GetResponse response = itemResponse.getResponse();</span><br><span class="line">    <span class="keyword">if</span> (response.isExists()) &#123;</span><br><span class="line">      String index = response.getIndex();</span><br><span class="line">      String type = response.getType();</span><br><span class="line">      String id = response.getId();</span><br><span class="line">      <span class="keyword">long</span> version = response.getVersion();</span><br><span class="line">      Util.print(index, type, id, version);</span><br><span class="line"></span><br><span class="line">      String sourceAsString = response.getSourceAsString();</span><br><span class="line">      System.out.println(sourceAsString);</span><br><span class="line">      Map&lt;String, DocumentField&gt; fields = response.getFields();</span><br><span class="line">      System.out.println(fields);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>twitter|_doc|11|false|<br>twitter|_doc|12|false|<br>twitter|_doc|13|false|<br>twitter|_doc|14|false|<br>another|_doc|foo|true|</p>
<h4 id="bulk"><a href="#bulk" class="headerlink" title="bulk"></a>bulk</h4><p>一个bulk操作中,可以添加index/update/delete.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">BulkRequestBuilder bulkRequestBuilder = client.prepareBulk();</span><br><span class="line"></span><br><span class="line">Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">map.put(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">IndexRequestBuilder indexRequestBuilder = client.prepareIndex(<span class="string">&quot;twitter&quot;</span>, <span class="string">&quot;_doc&quot;</span>, <span class="string">&quot;11&quot;</span>).setSource(map);</span><br><span class="line">bulkRequestBuilder.add(indexRequestBuilder);</span><br><span class="line"></span><br><span class="line">Map&lt;String, Object&gt; map2 = Maps.newHashMap();</span><br><span class="line">map2.put(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">IndexRequest indexRequest = <span class="keyword">new</span> IndexRequest(<span class="string">&quot;twitter&quot;</span>, <span class="string">&quot;_doc&quot;</span>, <span class="string">&quot;12&quot;</span>).source(map2);</span><br><span class="line">bulkRequestBuilder.add(indexRequest);</span><br><span class="line"></span><br><span class="line">Map&lt;String, Object&gt; map3 = Maps.newHashMap();</span><br><span class="line">map3.put(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;11&quot;</span>);</span><br><span class="line">UpdateRequest updateRequest = <span class="keyword">new</span> UpdateRequest(<span class="string">&quot;twitter&quot;</span>, <span class="string">&quot;_doc&quot;</span>, <span class="string">&quot;1&quot;</span>).doc(map3);</span><br><span class="line">bulkRequestBuilder.add(updateRequest);</span><br><span class="line"></span><br><span class="line">Map&lt;String, Object&gt; map4 = Maps.newHashMap();</span><br><span class="line">map4.put(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;11&quot;</span>);</span><br><span class="line">UpdateRequestBuilder updateRequestBuilder = client.prepareUpdate(<span class="string">&quot;twitter&quot;</span>, <span class="string">&quot;_doc&quot;</span>, <span class="string">&quot;2&quot;</span>).setDoc(map4);</span><br><span class="line">bulkRequestBuilder.add(updateRequestBuilder);</span><br><span class="line"></span><br><span class="line">DeleteRequestBuilder deleteRequestBuilder = client.prepareDelete(<span class="string">&quot;twitter&quot;</span>, <span class="string">&quot;_doc&quot;</span>, <span class="string">&quot;3&quot;</span>);</span><br><span class="line">bulkRequestBuilder.add(deleteRequestBuilder);</span><br><span class="line"></span><br><span class="line">BulkResponse bulkResponse = bulkRequestBuilder.get();</span><br><span class="line">System.out.println(bulkResponse.hasFailures());</span><br><span class="line">BulkItemResponse[] items = bulkResponse.getItems();</span><br><span class="line"><span class="keyword">for</span> (BulkItemResponse response : items) &#123;</span><br><span class="line">  <span class="keyword">boolean</span> failed = response.isFailed();</span><br><span class="line">  System.out.println(failed);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="using-bulk-processor"><a href="#using-bulk-processor" class="headerlink" title="using bulk processor"></a>using bulk processor</h4><p>bulkProcessor添加request,提供了一个简单的接口,根据请求的数量或大小,或在给定的时间段之后自动刷新批量操作.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">BulkProcessor bulkProcessor = BulkProcessor.builder(</span><br><span class="line">    client,</span><br><span class="line">    <span class="keyword">new</span> BulkProcessor.Listener() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeBulk</span><span class="params">(<span class="keyword">long</span> executionId, BulkRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 执行前调用 -- 3</span></span><br><span class="line">        System.out.println(request.numberOfActions());</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterBulk</span><span class="params">(<span class="keyword">long</span> executionId, BulkRequest request, BulkResponse response)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 执行后调用 -- true</span></span><br><span class="line">        System.out.println(response.hasFailures());</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterBulk</span><span class="params">(<span class="keyword">long</span> executionId, BulkRequest request, Throwable failure)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 执行失败时</span></span><br><span class="line">        System.out.println(failure.getMessage());</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line">    .setBulkActions(<span class="number">10000</span>)</span><br><span class="line">    .setBulkSize(<span class="keyword">new</span> ByteSizeValue(<span class="number">5</span>, ByteSizeUnit.MB))</span><br><span class="line">    .setFlushInterval(TimeValue.timeValueSeconds(<span class="number">5</span>))</span><br><span class="line">    .setConcurrentRequests(<span class="number">1</span>)</span><br><span class="line">    .setBackoffPolicy(BackoffPolicy.exponentialBackoff(TimeValue.timeValueMillis(<span class="number">100</span>), <span class="number">3</span>))</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加请求</span></span><br><span class="line">Map&lt;String, Object&gt; map2 = Maps.newHashMap();</span><br><span class="line">map2.put(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;11&quot;</span>);</span><br><span class="line">IndexRequest indexRequest = <span class="keyword">new</span> IndexRequest(<span class="string">&quot;twitter&quot;</span>, <span class="string">&quot;_doc&quot;</span>, <span class="string">&quot;112&quot;</span>).source(map2);</span><br><span class="line">bulkProcessor.add(indexRequest);</span><br><span class="line"></span><br><span class="line">Map&lt;String, Object&gt; map3 = Maps.newHashMap();</span><br><span class="line">map3.put(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;111&quot;</span>);</span><br><span class="line">UpdateRequest updateRequest = <span class="keyword">new</span> UpdateRequest(<span class="string">&quot;twitter&quot;</span>, <span class="string">&quot;_doc&quot;</span>, <span class="string">&quot;1&quot;</span>).doc(map3);</span><br><span class="line">bulkProcessor.add(updateRequest);</span><br><span class="line"></span><br><span class="line">DeleteRequest deleteRequest = <span class="keyword">new</span> DeleteRequest(<span class="string">&quot;twitter1&quot;</span>, <span class="string">&quot;_doc&quot;</span>, <span class="string">&quot;3&quot;</span>);</span><br><span class="line">bulkProcessor.add(deleteRequest);</span><br><span class="line"></span><br><span class="line"><span class="comment">// bulkProcessor.flush();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 等待关闭,如果有并发请求会等待完成.</span></span><br><span class="line">bulkProcessor.awaitClose(<span class="number">10</span>, TimeUnit.MINUTES);</span><br><span class="line"><span class="comment">// 直接关闭</span></span><br><span class="line"><span class="comment">// bulkProcessor.close();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// client.admin().indices().prepareRefresh().get();</span></span><br><span class="line"><span class="comment">// client.prepareSearch().get();</span></span><br></pre></td></tr></table></figure>

<p>setBulkActions,设置批量请求个数,默认1000.<br>setBulkSize,设置批量请求大小,默认5M.<br>setFlushInterval,不管请求量进行刷新,默认无.<br>setConcurrentRequests,设置为1表示异步执行刷新,0表示只允许执行单个请求.<br>setBackoffPolicy,设置指数退避策略,最初等待100ms,最多重试3次,默认8次.<br>BackoffPolicy.noBackoff()为禁用退避策略.</p>
<h5 id="设置全局参数"><a href="#设置全局参数" class="headerlink" title="设置全局参数"></a>设置全局参数</h5><p>setGlobalIndex<br>setGlobalType</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">BulkProcessor bulkProcessor = BulkProcessor.builder(</span><br><span class="line">        client,</span><br><span class="line">        listener</span><br><span class="line">    )</span><br><span class="line">    .setBulkActions(<span class="number">10000</span>)</span><br><span class="line">    .setBulkSize(<span class="keyword">new</span> ByteSizeValue(<span class="number">5</span>, ByteSizeUnit.MB))</span><br><span class="line">    .setFlushInterval(TimeValue.timeValueSeconds(<span class="number">5</span>))</span><br><span class="line">    .setConcurrentRequests(<span class="number">1</span>)</span><br><span class="line">    .setBackoffPolicy(BackoffPolicy.exponentialBackoff(TimeValue.timeValueMillis(<span class="number">100</span>), <span class="number">3</span>))</span><br><span class="line">    .setGlobalIndex(<span class="string">&quot;twitter&quot;</span>)</span><br><span class="line">    .setGlobalType(<span class="string">&quot;_doc&quot;</span>)</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line">bulkProcessor.add(<span class="keyword">new</span> IndexRequest(<span class="string">&quot;blog&quot;</span>).id(<span class="string">&quot;1&quot;</span>).source(XContentType.JSON, <span class="string">&quot;title&quot;</span>, <span class="string">&quot;xxx&quot;</span>));</span><br><span class="line">bulkProcessor.add(<span class="keyword">new</span> UpdateRequest().doc(XContentType.JSON, <span class="string">&quot;user&quot;</span>, <span class="string">&quot;maoeryu&quot;</span>).id(<span class="string">&quot;1&quot;</span>));</span><br><span class="line">bulkProcessor.add(<span class="keyword">new</span> DeleteRequest().id(<span class="string">&quot;112&quot;</span>));</span><br><span class="line">bulkProcessor.awaitClose(<span class="number">10</span>, TimeUnit.MINUTES);</span><br></pre></td></tr></table></figure>

<h4 id="reindex"><a href="#reindex" class="headerlink" title="reindex"></a>reindex</h4><p>根据查询结果,复制索引.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">BulkByScrollResponse response = <span class="keyword">new</span> ReindexRequestBuilder(client, ReindexAction.INSTANCE)</span><br><span class="line">    .source(<span class="string">&quot;twitter&quot;</span>)</span><br><span class="line">    .destination(<span class="string">&quot;my-twitter&quot;</span>)</span><br><span class="line">    .filter(QueryBuilders.matchQuery(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;1&quot;</span>))</span><br><span class="line">    .get();</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> batches = response.getBatches();</span><br><span class="line"><span class="keyword">long</span> created = response.getCreated();</span><br><span class="line"><span class="keyword">long</span> updated = response.getUpdated();</span><br><span class="line"><span class="keyword">long</span> deleted = response.getDeleted();</span><br><span class="line"><span class="keyword">long</span> noops = response.getNoops();</span><br><span class="line"><span class="keyword">long</span> bulkRetries = response.getBulkRetries();</span><br><span class="line"><span class="comment">// System.out.println(response.getStatus());</span></span><br><span class="line">Util.print(batches, created, updated, deleted, noops, bulkRetries);</span><br></pre></td></tr></table></figure>

<p>1|3|0|0|0|0|<br>sliceId=null,updated=0,created=3,deleted=0,batches=1,versionConflicts=0,noops=0,retries=0,throttledUntil=0s<br>第二次运行,<br>sliceId=null,updated=3,created=0,deleted=0,batches=1,versionConflicts=0,noops=0,retries=0,throttledUntil=0s</p>
<h4 id="update-by-query"><a href="#update-by-query" class="headerlink" title="update by query"></a>update by query</h4><p>maxDocs,设置更新的最大文档数.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">UpdateByQueryRequestBuilder updateByQuery = <span class="keyword">new</span> UpdateByQueryRequestBuilder(client, UpdateByQueryAction.INSTANCE);</span><br><span class="line">updateByQuery</span><br><span class="line">    .source(<span class="string">&quot;twitter&quot;</span>)</span><br><span class="line">    .size(<span class="number">500</span>)</span><br><span class="line">    .filter(QueryBuilders.termQuery(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;1&quot;</span>))</span><br><span class="line">    .maxDocs(<span class="number">2</span>)</span><br><span class="line">    .script(<span class="keyword">new</span> Script(<span class="string">&quot;ctx._source.age = \&quot;3\&quot;&quot;</span>))</span><br><span class="line">    .abortOnVersionConflict(<span class="keyword">false</span>);</span><br><span class="line">BulkByScrollResponse response = updateByQuery.get();</span><br><span class="line">System.out.println(response.getStatus());</span><br></pre></td></tr></table></figure>

<p>将age=1的文档中,age修改为3,最大更新2个.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">UpdateByQueryRequestBuilder updateByQuery = <span class="keyword">new</span> UpdateByQueryRequestBuilder(client, UpdateByQueryAction.INSTANCE);</span><br><span class="line">updateByQuery</span><br><span class="line">    .source(<span class="string">&quot;twitter&quot;</span>)</span><br><span class="line">    .size(<span class="number">500</span>)</span><br><span class="line">    .filter(QueryBuilders.termQuery(<span class="string">&quot;gender&quot;</span>, <span class="string">&quot;male&quot;</span>))</span><br><span class="line">    .maxDocs(<span class="number">3</span>)</span><br><span class="line">    .script(<span class="keyword">new</span> Script(ScriptType.INLINE,</span><br><span class="line">        <span class="string">&quot;painless&quot;</span>,</span><br><span class="line">        <span class="string">&quot;if (ctx._source.age == &#x27;11&#x27;) &#123;&quot;</span></span><br><span class="line">            + <span class="string">&quot;  ctx.op=&#x27;noop&#x27;&quot;</span></span><br><span class="line">            + <span class="string">&quot;&#125; else if (ctx._source.age == &#x27;111&#x27;) &#123;&quot;</span></span><br><span class="line">            + <span class="string">&quot;  ctx.op=&#x27;delete&#x27;&quot;</span></span><br><span class="line">            + <span class="string">&quot;&#125; else &#123;&quot;</span></span><br><span class="line">            + <span class="string">&quot;ctx._source.user = &#x27;xx1&#x27;&#125;&quot;</span>,</span><br><span class="line">        Collections.emptyMap()))</span><br><span class="line">    .abortOnVersionConflict(<span class="keyword">false</span>);</span><br><span class="line">BulkByScrollResponse response = updateByQuery.get();</span><br><span class="line">System.out.println(response.getStatus());</span><br></pre></td></tr></table></figure>

<p>sliceId=null,updated=1,created=0,deleted=0,batches=1,versionConflicts=0,noops=1,retries=0,throttledUntil=0s<br>通过脚本修改,将文档中gender=male的,<br>如果age=11,无修改(noop),<br>如果age=111,删除操作(delete),<br>其它的,将user修改为xx1.<br>最大修改文档数为3.</p>
<h5 id="任务api"><a href="#任务api" class="headerlink" title="任务api"></a>任务api</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">ListTasksResponse listTasksResponse = client.admin().cluster().prepareListTasks()</span><br><span class="line">    .setActions(UpdateByQueryAction.NAME).setDetailed(<span class="keyword">true</span>).get();</span><br><span class="line"><span class="keyword">for</span> (TaskInfo info : listTasksResponse.getTasks()) &#123;</span><br><span class="line">  TaskId taskId = info.getTaskId();</span><br><span class="line">  BulkByScrollTask.Status status = (BulkByScrollTask.Status) info.getStatus();</span><br><span class="line">  System.out.println(taskId);</span><br><span class="line">  System.out.println(status);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用taskid直接查找任务</span></span><br><span class="line">  GetTaskResponse response = client.admin().cluster().prepareGetTask(taskId).get();</span><br><span class="line">  System.out.println(response);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 取消指定taskid的任务</span></span><br><span class="line">  List&lt;TaskInfo&gt; tasks = client.admin().cluster().prepareCancelTasks().setTaskId(taskId).get().getTasks();</span><br><span class="line">  <span class="comment">// 取消所有任务</span></span><br><span class="line">  List&lt;TaskInfo&gt; tasks1 = client.admin().cluster().prepareCancelTasks()</span><br><span class="line">      .setActions(UpdateByQueryAction.NAME).get().getTasks();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用taskid恢复任务</span></span><br><span class="line">  <span class="keyword">new</span> RethrottleRequestBuilder(client, RethrottleAction.INSTANCE)</span><br><span class="line">      .setTaskId(taskId)</span><br><span class="line">      .setRequestsPerSecond(<span class="number">2.0f</span>)</span><br><span class="line">      .get();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="delete-by-query"><a href="#delete-by-query" class="headerlink" title="delete by query"></a>delete by query</h4><p>删除age=1的文档,最大数据为1.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">BulkByScrollResponse response = <span class="keyword">new</span> DeleteByQueryRequestBuilder(client, DeleteByQueryAction.INSTANCE)</span><br><span class="line">    .source(<span class="string">&quot;twitter&quot;</span>)</span><br><span class="line">    .filter(QueryBuilders.matchQuery(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;1&quot;</span>))</span><br><span class="line">    .maxDocs(<span class="number">1</span>)</span><br><span class="line">    .get();</span><br><span class="line"><span class="keyword">long</span> deleted = response.getDeleted();</span><br><span class="line">System.out.println(deleted);</span><br></pre></td></tr></table></figure>

<h2 id="search"><a href="#search" class="headerlink" title="search"></a>search</h2><p>可同时查询多个索引.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SearchResponse response = client.prepareSearch(<span class="string">&quot;twitter&quot;</span>)</span><br><span class="line">    .setSearchType(SearchType.DFS_QUERY_THEN_FETCH)</span><br><span class="line">    .setQuery(QueryBuilders.termQuery(<span class="string">&quot;gender&quot;</span>, <span class="string">&quot;male&quot;</span>))</span><br><span class="line">    .setPostFilter(QueryBuilders.rangeQuery(<span class="string">&quot;age&quot;</span>).from(<span class="number">1</span>).to(<span class="number">2</span>))</span><br><span class="line">    .setFrom(<span class="number">0</span>)</span><br><span class="line">    .setSize(<span class="number">60</span>)</span><br><span class="line">    .setExplain(<span class="keyword">true</span>)</span><br><span class="line">    .get();</span><br><span class="line"></span><br><span class="line">SearchHits hits = response.getHits();</span><br><span class="line"><span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">  System.out.println(hit.getSourceAsString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>{&quot;postDate&quot;:&quot;2021-11-04T10:52:24.832Z&quot;,&quot;message&quot;:&quot;trying out Elasticsearch&quot;,&quot;user&quot;:&quot;tom1&quot;,&quot;gender&quot;:&quot;male&quot;,&quot;age&quot;:&quot;11&quot;}</p>
<h3 id="using-scroll"><a href="#using-scroll" class="headerlink" title="using scroll"></a>using scroll</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">TermQueryBuilder query = QueryBuilders.termQuery(<span class="string">&quot;gender&quot;</span>, <span class="string">&quot;male&quot;</span>);</span><br><span class="line">SearchResponse response = client.prepareSearch(<span class="string">&quot;twitter&quot;</span>)</span><br><span class="line">    .addSort(FieldSortBuilder.DOC_FIELD_NAME, SortOrder.ASC)</span><br><span class="line">    .setScroll(<span class="keyword">new</span> TimeValue(<span class="number">60000</span>))</span><br><span class="line">    .setQuery(query)</span><br><span class="line">    .setSize(<span class="number">100</span>)</span><br><span class="line">    .get();</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (SearchHit hit : response.getHits().getHits()) &#123;</span><br><span class="line">    System.out.println(hit.getSourceAsString());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  response = client.prepareSearchScroll(response.getScrollId())</span><br><span class="line">      .setScroll(<span class="keyword">new</span> TimeValue(<span class="number">60000</span>))</span><br><span class="line">      .execute()</span><br><span class="line">      .actionGet();</span><br><span class="line">&#125; <span class="keyword">while</span> (response.getHits().getHits().length != <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<h3 id="multisearch"><a href="#multisearch" class="headerlink" title="multisearch"></a>multisearch</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">QueryStringQueryBuilder query1 = QueryBuilders.queryStringQuery(<span class="string">&quot;xx1&quot;</span>);</span><br><span class="line">SearchRequestBuilder request1 = client.prepareSearch().setQuery(query1).setSize(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">MatchQueryBuilder query2 = QueryBuilders.matchQuery(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;3&quot;</span>);</span><br><span class="line">SearchRequestBuilder request2 = client.prepareSearch().setQuery(query2).setSize(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">MultiSearchResponse response = client.prepareMultiSearch().add(request1).add(request2).get();</span><br><span class="line"><span class="keyword">for</span> (MultiSearchResponse.Item item : response.getResponses()) &#123;</span><br><span class="line">  SearchResponse searchResponse = item.getResponse();</span><br><span class="line">  <span class="keyword">for</span> (SearchHit hit : searchResponse.getHits()) &#123;</span><br><span class="line">    Util.print(hit.getIndex(), hit.getSourceAsString());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>twitter|{&quot;gender&quot;:&quot;male&quot;,&quot;user&quot;:&quot;xx1&quot;,&quot;age&quot;:&quot;3&quot;}|<br>twitter|{&quot;gender&quot;:&quot;male&quot;,&quot;user&quot;:&quot;xx1&quot;,&quot;age&quot;:&quot;3&quot;}|</p>
<h3 id="using-aggregations"><a href="#using-aggregations" class="headerlink" title="using aggregations"></a>using aggregations</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">SearchResponse response = client.prepareSearch(<span class="string">&quot;twitter&quot;</span>)</span><br><span class="line">    .setQuery(QueryBuilders.termQuery(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;11&quot;</span>))</span><br><span class="line">    .addAggregation(</span><br><span class="line">        AggregationBuilders.terms(<span class="string">&quot;agg1&quot;</span>)</span><br><span class="line">            .field(<span class="string">&quot;time&quot;</span>)</span><br><span class="line">    )</span><br><span class="line">    .addAggregation(</span><br><span class="line">        AggregationBuilders.dateHistogram(<span class="string">&quot;agg2&quot;</span>)</span><br><span class="line">            .field(<span class="string">&quot;postDate&quot;</span>)</span><br><span class="line">            .calendarInterval(DateHistogramInterval.YEAR)</span><br><span class="line">    )</span><br><span class="line">    .get();</span><br><span class="line">Terms agg1 = response.getAggregations().get(<span class="string">&quot;agg1&quot;</span>);</span><br><span class="line">Histogram agg2 = response.getAggregations().get(<span class="string">&quot;agg2&quot;</span>);</span><br><span class="line">System.out.println(agg1.toString());</span><br><span class="line">System.out.println(agg2.toString());</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;agg1&quot;:&#123;&quot;doc_count_error_upper_bound&quot;:0,&quot;sum_other_doc_count&quot;:0,&quot;buckets&quot;:[&#123;&quot;key&quot;:11,&quot;doc_count&quot;:1&#125;]&#125;&#125;</span><br><span class="line">&#123;&quot;agg2&quot;:&#123;&quot;buckets&quot;:[&#123;&quot;key_as_string&quot;:&quot;2021-01-01T00:00:00.000Z&quot;,&quot;key&quot;:1609459200000,&quot;doc_count&quot;:1&#125;]&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="terminate-after"><a href="#terminate-after" class="headerlink" title="terminate after"></a>terminate after</h3><p>每个分片要收集的最大文档数,达到该数目时,查询执行将提前终止.<br>如果设置,则可以通过请求检查操作是否提前终止.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SearchResponse response = client.prepareSearch(<span class="string">&quot;twitter&quot;</span>)</span><br><span class="line">    .setTerminateAfter(<span class="number">1</span>)</span><br><span class="line">    .get();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (response.isTerminatedEarly()) &#123;</span><br><span class="line">  Arrays.stream(response.getHits().getHits()).forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> : <span class="string">&quot;twitter&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_type&quot;</span> : <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> : <span class="string">&quot;4&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_score&quot;</span> : <span class="number">1.0</span>,</span><br><span class="line">  <span class="attr">&quot;_source&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;gender&quot;</span> : <span class="string">&quot;male&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;user&quot;</span> : <span class="string">&quot;xx1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;age&quot;</span> : <span class="string">&quot;3&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="search-template"><a href="#search-template" class="headerlink" title="search template"></a>search template</h3><p>inline模板.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; params = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">params.put(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;3&quot;</span>);</span><br><span class="line"></span><br><span class="line">SearchResponse response = <span class="keyword">new</span> SearchTemplateRequestBuilder(client)</span><br><span class="line">    .setScript(<span class="string">&quot;&#123;\&quot;query\&quot;:&#123;\&quot;match\&quot;:&#123;\&quot;age\&quot;:\&quot;&#123;&#123;age&#125;&#125;\&quot;&#125;&#125;&#125;&quot;</span>)</span><br><span class="line">    .setScriptType(ScriptType.INLINE)</span><br><span class="line">    .setScriptParams(params)</span><br><span class="line">    .setRequest(<span class="keyword">new</span> SearchRequest(<span class="string">&quot;my-twitter&quot;</span>))</span><br><span class="line">    .get().getResponse();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (SearchHit hit : response.getHits()) &#123;</span><br><span class="line">  System.out.println(hit.getSourceAsString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="aggregations"><a href="#aggregations" class="headerlink" title="aggregations"></a>aggregations</h2><h3 id="structuring-agg"><a href="#structuring-agg" class="headerlink" title="structuring agg"></a>structuring agg</h3><p>构建聚合,聚合可以是度量聚合或存储桶聚合.以下是一个3级聚合,<br>1.Terms aggregation (bucket)<br>2.Date Histogram aggregation (bucket)<br>3.Average aggregation (metric)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">SearchResponse response = client.prepareSearch(<span class="string">&quot;twitter&quot;</span>)</span><br><span class="line">    .setQuery(QueryBuilders.termQuery(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;11&quot;</span>))</span><br><span class="line">    .addAggregation(AggregationBuilders</span><br><span class="line">        .terms(<span class="string">&quot;by_t&quot;</span>).field(<span class="string">&quot;time&quot;</span>)</span><br><span class="line">        .subAggregation(AggregationBuilders.</span><br><span class="line">            dateHistogram(<span class="string">&quot;by_year&quot;</span>).field(<span class="string">&quot;postDate&quot;</span>).calendarInterval(DateHistogramInterval.YEAR)</span><br><span class="line">            .subAggregation(AggregationBuilders</span><br><span class="line">                .avg(<span class="string">&quot;avg_time&quot;</span>).field(<span class="string">&quot;time&quot;</span>))</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">    .execute().actionGet();</span><br><span class="line"></span><br><span class="line">Terms by_t = response.getAggregations().get(<span class="string">&quot;by_t&quot;</span>);</span><br><span class="line">System.out.println(by_t);</span><br><span class="line"><span class="keyword">for</span> (Terms.Bucket entry : by_t.getBuckets()) &#123;</span><br><span class="line">  Object key = entry.getKey();</span><br><span class="line">  System.out.println(key);</span><br><span class="line">  InternalDateHistogram by_year = entry.getAggregations().get(<span class="string">&quot;by_year&quot;</span>);</span><br><span class="line">  System.out.println(by_year);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (InternalDateHistogram.Bucket entry2 : by_year.getBuckets()) &#123;</span><br><span class="line">    Object key2 = entry2.getKey();</span><br><span class="line">    System.out.println(key2);</span><br><span class="line">    InternalAvg avg_time = entry2.getAggregations().get(<span class="string">&quot;avg_time&quot;</span>);</span><br><span class="line">    System.out.println(avg_time);</span><br><span class="line">    Util.print(avg_time.getName(), avg_time.getValue());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;postDate&quot;:&quot;2021-11-05T08:55:45.635Z&quot;,&quot;time&quot;:11,&quot;message&quot;:&quot;trying out Elasticsearch&quot;,&quot;user&quot;:&quot;tom1&quot;,&quot;age&quot;:&quot;11&quot;&#125;</span><br><span class="line">&#123;&quot;by_t&quot;:&#123;&quot;doc_count_error_upper_bound&quot;:0,&quot;sum_other_doc_count&quot;:0,&quot;buckets&quot;:[&#123;&quot;key&quot;:11,&quot;doc_count&quot;:1,&quot;by_year&quot;:&#123;&quot;buckets&quot;:[&#123;&quot;key_as_string&quot;:&quot;2021-01-01T00:00:00.000Z&quot;,&quot;key&quot;:1609459200000,&quot;doc_count&quot;:1,&quot;avg_time&quot;:&#123;&quot;value&quot;:11.0&#125;&#125;]&#125;&#125;]&#125;&#125;</span><br><span class="line">11</span><br><span class="line">&#123;&quot;by_year&quot;:&#123;&quot;buckets&quot;:[&#123;&quot;key_as_string&quot;:&quot;2021-01-01T00:00:00.000Z&quot;,&quot;key&quot;:1609459200000,&quot;doc_count&quot;:1,&quot;avg_time&quot;:&#123;&quot;value&quot;:11.0&#125;&#125;]&#125;&#125;</span><br><span class="line">2021-01-01T00:00Z</span><br><span class="line">&#123;&quot;avg_time&quot;:&#123;&quot;value&quot;:11.0&#125;&#125;</span><br><span class="line">avg_time|11.0|</span><br></pre></td></tr></table></figure>

<h3 id="metrics-agg"><a href="#metrics-agg" class="headerlink" title="metrics agg"></a>metrics agg</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">MinAggregationBuilder minAgg = AggregationBuilders.min(<span class="string">&quot;min&quot;</span>).field(<span class="string">&quot;time&quot;</span>);</span><br><span class="line">MaxAggregationBuilder maxAgg = AggregationBuilders.max(<span class="string">&quot;max&quot;</span>).field(<span class="string">&quot;time&quot;</span>);</span><br><span class="line">SumAggregationBuilder sumAgg = AggregationBuilders.sum(<span class="string">&quot;sum&quot;</span>).field(<span class="string">&quot;time&quot;</span>);</span><br><span class="line">AvgAggregationBuilder avgAgg = AggregationBuilders.avg(<span class="string">&quot;avg&quot;</span>).field(<span class="string">&quot;time&quot;</span>);</span><br><span class="line">StatsAggregationBuilder statsAgg = AggregationBuilders.stats(<span class="string">&quot;stats&quot;</span>).field(<span class="string">&quot;time&quot;</span>);</span><br><span class="line"></span><br><span class="line">SearchResponse response = client.prepareSearch(<span class="string">&quot;twitter&quot;</span>)</span><br><span class="line">    .setQuery(QueryBuilders.termQuery(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;11&quot;</span>))</span><br><span class="line">    .addAggregation(minAgg)</span><br><span class="line">    .addAggregation(maxAgg)</span><br><span class="line">    .addAggregation(sumAgg)</span><br><span class="line">    .addAggregation(avgAgg)</span><br><span class="line">    .addAggregation(statsAgg)</span><br><span class="line">    .get();</span><br><span class="line"></span><br><span class="line">Min min = response.getAggregations().get(<span class="string">&quot;min&quot;</span>);</span><br><span class="line">Max max = response.getAggregations().get(<span class="string">&quot;max&quot;</span>);</span><br><span class="line">Sum sum = response.getAggregations().get(<span class="string">&quot;sum&quot;</span>);</span><br><span class="line">Avg avg = response.getAggregations().get(<span class="string">&quot;avg&quot;</span>);</span><br><span class="line">InternalStats stats = response.getAggregations().get(<span class="string">&quot;stats&quot;</span>);</span><br><span class="line">Util.print(min.getValue(), max.getValue(), sum.getValue(), avg.getValue());</span><br><span class="line">System.out.println(stats.toString());</span><br></pre></td></tr></table></figure>

<p>11.0|11.0|11.0|11.0|<br>{&quot;stats&quot;:{&quot;count&quot;:1,&quot;min&quot;:11.0,&quot;max&quot;:11.0,&quot;avg&quot;:11.0,&quot;sum&quot;:11.0}}</p>
<h3 id="bucket-agg"><a href="#bucket-agg" class="headerlink" title="bucket agg"></a>bucket agg</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GlobalAggregationBuilder golbal = AggregationBuilders.global(<span class="string">&quot;golbal&quot;</span>)</span><br><span class="line">    .subAggregation(AggregationBuilders.terms(<span class="string">&quot;gender&quot;</span>).field(<span class="string">&quot;gender&quot;</span>));</span><br><span class="line"></span><br><span class="line">FiltersAggregationBuilder filters = AggregationBuilders.filters(<span class="string">&quot;filters&quot;</span>,</span><br><span class="line">    <span class="keyword">new</span> FiltersAggregator.KeyedFilter(<span class="string">&quot;men&quot;</span>, QueryBuilders.termQuery(<span class="string">&quot;gender&quot;</span>, <span class="string">&quot;male&quot;</span>)),</span><br><span class="line">    <span class="keyword">new</span> FiltersAggregator.KeyedFilter(<span class="string">&quot;women&quot;</span>, QueryBuilders.termQuery(<span class="string">&quot;gender&quot;</span>, <span class="string">&quot;female&quot;</span>)));</span><br><span class="line"></span><br><span class="line">TermsAggregationBuilder terms = AggregationBuilders.terms(<span class="string">&quot;terms&quot;</span>).field(<span class="string">&quot;user&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="查询语句"><a href="#查询语句" class="headerlink" title="查询语句"></a>查询语句</h2><h3 id="匹配所有"><a href="#匹配所有" class="headerlink" title="匹配所有"></a>匹配所有</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MatchAllQueryBuilder query = QueryBuilders.matchAllQuery();</span><br></pre></td></tr></table></figure>

<h3 id="文本查询"><a href="#文本查询" class="headerlink" title="文本查询"></a>文本查询</h3><h4 id="matchQuery"><a href="#matchQuery" class="headerlink" title="matchQuery"></a>matchQuery</h4><p>用于执行全文查询的标准查询,包括模糊匹配和短语或邻近查询.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MatchQueryBuilder query = QueryBuilders.matchQuery(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;xx1&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="multiMatchQuery"><a href="#multiMatchQuery" class="headerlink" title="multiMatchQuery"></a>multiMatchQuery</h4><p>多字段版本match查询.<br>第一个参数为text,后面的参数为field.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MultiMatchQueryBuilder query = QueryBuilders.multiMatchQuery(<span class="string">&quot;xx1&quot;</span>, <span class="string">&quot;genger&quot;</span>, <span class="string">&quot;user&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="commonTermsQuery"><a href="#commonTermsQuery" class="headerlink" title="commonTermsQuery"></a>commonTermsQuery</h4><p>一种更专业化的查询,它对不常见的词有更多的偏好.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CommonTermsQueryBuilder query = QueryBuilders.commonTermsQuery(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;xx1&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="queryStringQuery"><a href="#queryStringQuery" class="headerlink" title="queryStringQuery"></a>queryStringQuery</h4><p>支持压缩Lucene查询字符串语法,允许您在单个查询字符串中指定<code>AND|OR|NOT</code>条件和多字段搜索.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QueryStringQueryBuilder query = QueryBuilders.queryStringQuery(<span class="string">&quot;+xx1&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="simpleQueryStringQuery"><a href="#simpleQueryStringQuery" class="headerlink" title="simpleQueryStringQuery"></a>simpleQueryStringQuery</h4><p>更简单/更健壮的版本.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SimpleQueryStringBuilder query = QueryBuilders.simpleQueryStringQuery(<span class="string">&quot;+xx1&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h3><p>通常用于结构化数据,如数字/日期/数字,而不是全文字段.</p>
<h4 id="term查询"><a href="#term查询" class="headerlink" title="term查询"></a>term查询</h4><p>查找包含在指定字段中指定的确切术语的文档.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TermQueryBuilder query = QueryBuilders.termQuery(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;xx1&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="terms查询"><a href="#terms查询" class="headerlink" title="terms查询"></a>terms查询</h4><p>查找包含指定字段中指定的任何确切术语的文档.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TermsQueryBuilder query = QueryBuilders.termsQuery(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;xx1&quot;</span>, <span class="string">&quot;user&quot;</span>, <span class="string">&quot;tom1&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="range查询"><a href="#range查询" class="headerlink" title="range查询"></a>range查询</h4><p>查找指定字段包含指定范围内的值(日期/数字或字符串)的文档.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RangeQueryBuilder query = QueryBuilders.rangeQuery(<span class="string">&quot;xx1&quot;</span>).from(<span class="number">1</span>).to(<span class="number">10</span>).includeLower(<span class="keyword">true</span>).includeUpper(<span class="keyword">false</span>);</span><br><span class="line">RangeQueryBuilder query = QueryBuilders.rangeQuery(<span class="string">&quot;user&quot;</span>).gte(<span class="string">&quot;a&quot;</span>).lt(<span class="string">&quot;z&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="exists查询"><a href="#exists查询" class="headerlink" title="exists查询"></a>exists查询</h4><p>查找指定字段包含任何非空值的文档.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ExistsQueryBuilder query = QueryBuilders.existsQuery(<span class="string">&quot;user&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="prefix查询"><a href="#prefix查询" class="headerlink" title="prefix查询"></a>prefix查询</h4><p>查找文档,其中指定的字段包含与指定的前缀完全相同的术语.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PrefixQueryBuilder query = QueryBuilders.prefixQuery(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;xx&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="通配符查询"><a href="#通配符查询" class="headerlink" title="通配符查询"></a>通配符查询</h4><p>查找文档,其中指定的字段包含与指定模式匹配的术语,其中模式支持单字符通配符(?)和多字符通配符(*).</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WildcardQueryBuilder query = QueryBuilders.wildcardQuery(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;t?m*&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="regexp查询"><a href="#regexp查询" class="headerlink" title="regexp查询"></a>regexp查询</h4><p>查找文档,其中指定的字段包含与指定的规则表达式匹配的术语.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RegexpQueryBuilder query = QueryBuilders.regexpQuery(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;t.*&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h4><p>查找指定字段包含与指定术语模糊相似的术语的文档.模糊性被衡量为Levenshtein编辑距离1或2的.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FuzzyQueryBuilder query = QueryBuilders.fuzzyQuery(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;x&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="复合查询"><a href="#复合查询" class="headerlink" title="复合查询"></a>复合查询</h3><p>复合查询将其他复合查询或叶查询包装起来,以组合结果和分数,更改其行为,或从查询切换到筛选器上下文.</p>
<h4 id="constant-score查询"><a href="#constant-score查询" class="headerlink" title="constant_score查询"></a>constant_score查询</h4><p>包装另一个查询,但在筛选器上下文中执行它的查询.<br>所有匹配的文档都是相同的鈥渃固定鈥_score.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ConstantScoreQueryBuilder query = QueryBuilders.constantScoreQuery(QueryBuilders.termQuery(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;xx1&quot;</span>)).boost(<span class="number">2.0f</span>);</span><br></pre></td></tr></table></figure>

<h4 id="bool查询"><a href="#bool查询" class="headerlink" title="bool查询"></a>bool查询</h4><p>用于组合多个叶或复合查询子句的默认查询,如must/must_not,或滤波器条款.<br>这个must应该从句的分数是合起来的匹配的从句越多越好,而must_not和滤波器子句在筛选器上下文中执行.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">BoolQueryBuilder query = QueryBuilders.boolQuery()</span><br><span class="line">    .must(QueryBuilders.termQuery(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;xx1&quot;</span>))</span><br><span class="line">    .mustNot(QueryBuilders.termQuery(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;tom1&quot;</span>))</span><br><span class="line">    .should(QueryBuilders.termQuery(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;xx2&quot;</span>))</span><br><span class="line">    .filter(QueryBuilders.termQuery(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;xx3&quot;</span>));</span><br></pre></td></tr></table></figure>

<h4 id="dis-max查询"><a href="#dis-max查询" class="headerlink" title="dis_max查询"></a>dis_max查询</h4><p>一种接受多个查询并返回与任何查询子句相匹配的任何文档的查询.<br>而bool查询合并来自所有匹配查询的分数最大排水量查询使用单个最佳匹配查询子句的分数.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DisMaxQueryBuilder query = QueryBuilders.disMaxQuery()</span><br><span class="line">    .add(QueryBuilders.termQuery(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;xx1&quot;</span>))</span><br><span class="line">    .boost(<span class="number">1.2f</span>)</span><br><span class="line">    .tieBreaker(<span class="number">0.7f</span>);</span><br></pre></td></tr></table></figure>

<h4 id="function-score查询"><a href="#function-score查询" class="headerlink" title="function_score查询"></a>function_score查询</h4><p>使用函数修改主查询返回的分数,以考虑流行度/最近度/距离或使用脚本简化的自定义算法等因素.</p>
<h4 id="boosting查询"><a href="#boosting查询" class="headerlink" title="boosting查询"></a>boosting查询</h4><p>返回与a匹配的文档positive查询,但减少与消极的查询.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BoostingQueryBuilder query = QueryBuilders.boostingQuery(</span><br><span class="line">    QueryBuilders.termQuery(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;xx1&quot;</span>),</span><br><span class="line">    QueryBuilders.termQuery(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;tom1&quot;</span>)</span><br><span class="line">).negativeBoost(<span class="number">0.2f</span>);</span><br></pre></td></tr></table></figure>

<h3 id="joining"><a href="#joining" class="headerlink" title="joining"></a>joining</h3><h4 id="嵌套查询"><a href="#嵌套查询" class="headerlink" title="嵌套查询"></a>嵌套查询</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">NestedQueryBuilder query = QueryBuilders.nestedQuery(<span class="string">&quot;user&quot;</span>,</span><br><span class="line">    QueryBuilders.boolQuery()</span><br><span class="line">        .must(QueryBuilders.matchQuery(<span class="string">&quot;user.name&quot;</span>, <span class="string">&quot;xx1&quot;</span>))</span><br><span class="line">        .must(QueryBuilders.rangeQuery(<span class="string">&quot;user.age&quot;</span>).gt(<span class="number">5</span>)),</span><br><span class="line">    ScoreMode.Avg</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h4><p>当使用子查询时,需使用PreBuiltTransportClient客户端.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HasChildQueryBuilder query = JoinQueryBuilders.hasChildQuery(</span><br><span class="line">    <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">    QueryBuilders.termQuery(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;xx1&quot;</span>),</span><br><span class="line">    ScoreMode.None</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="父查询"><a href="#父查询" class="headerlink" title="父查询"></a>父查询</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HasParentQueryBuilder query = JoinQueryBuilders.hasParentQuery(</span><br><span class="line">    <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">    QueryBuilders.termQuery(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;xx1&quot;</span>),</span><br><span class="line">    <span class="keyword">false</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="geo"><a href="#geo" class="headerlink" title="geo"></a>geo</h3><h3 id="专用查询"><a href="#专用查询" class="headerlink" title="专用查询"></a>专用查询</h3><h4 id="more-like-this查询"><a href="#more-like-this查询" class="headerlink" title="more_like_this查询"></a>more_like_this查询</h4><p>此查询查找与指定的文本/文档或文档集合相似的文档.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String[] fields = &#123;<span class="string">&quot;user&quot;</span>&#125;;</span><br><span class="line">String[] texts = &#123;<span class="string">&quot;xx1&quot;</span>&#125;;</span><br><span class="line">MoreLikeThisQueryBuilder query = QueryBuilders.moreLikeThisQuery(fields, texts, <span class="keyword">null</span>)</span><br><span class="line">    .minTermFreq(<span class="number">1</span>)</span><br><span class="line">    .maxQueryTerms(<span class="number">12</span>);</span><br></pre></td></tr></table></figure>

<h4 id="script查询"><a href="#script查询" class="headerlink" title="script查询"></a>script查询</h4><p>此查询允许脚本充当筛选器.另请参见function_score查询.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ScriptQueryBuilder query = QueryBuilders.scriptQuery(<span class="keyword">new</span> Script(<span class="string">&quot;doc[user].value &gt; 1&quot;</span>));</span><br></pre></td></tr></table></figure>

<h4 id="过滤查询"><a href="#过滤查询" class="headerlink" title="过滤查询"></a>过滤查询</h4><p>此查询根据文档查找percolator查询.</p>
<h4 id="wrapper查询"><a href="#wrapper查询" class="headerlink" title="wrapper查询"></a>wrapper查询</h4><p>接受json或yaml字符串形式的其他查询的查询.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WrapperQueryBuilder query = QueryBuilders.wrapperQuery(<span class="string">&quot;&#123;\&quot;term\&quot;:&#123;\&quot;user\&quot;:\&quot;xx1\&quot;&#125;&#125;&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="范围查询"><a href="#范围查询" class="headerlink" title="范围查询"></a>范围查询</h3><h4 id="span-term查询"><a href="#span-term查询" class="headerlink" title="span_term查询"></a>span_term查询</h4><p>相当于term查询但用于其他span查询.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SpanTermQueryBuilder query = QueryBuilders.spanTermQuery(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;xx1&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="span-multi查询"><a href="#span-multi查询" class="headerlink" title="span_multi查询"></a>span_multi查询</h4><p>包装aterm/range/prefix/wildcard/regexp/fuzzy查询.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SpanMultiTermQueryBuilder query = QueryBuilders.spanMultiTermQueryBuilder(</span><br><span class="line">    QueryBuilders.prefixQuery(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;to&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="span-first查询"><a href="#span-first查询" class="headerlink" title="span_first查询"></a>span_first查询</h4><p>接受另一个范围查询,其匹配项必须出现在字段的第一个Npositions中.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SpanFirstQueryBuilder query = QueryBuilders.spanFirstQuery(</span><br><span class="line">    QueryBuilders.spanTermQuery(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;xx1&quot;</span>),</span><br><span class="line">    <span class="number">3</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="span-near查询"><a href="#span-near查询" class="headerlink" title="span_near查询"></a>span_near查询</h4><p>接受多个范围查询,这些查询的匹配项必须在彼此指定的距离内,并且可能以相同的顺序进行.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SpanNearQueryBuilder query = QueryBuilders.spanNearQuery(</span><br><span class="line">        QueryBuilders.spanTermQuery(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;xx1&quot;</span>), <span class="number">12</span></span><br><span class="line">    ).addClause(QueryBuilders.spanTermQuery(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;xx1&quot;</span>))</span><br><span class="line">    .inOrder(<span class="keyword">false</span>);</span><br></pre></td></tr></table></figure>

<h4 id="span-or查询"><a href="#span-or查询" class="headerlink" title="span_or查询"></a>span_or查询</h4><p>组合多个范围查询,返回与任何指定查询匹配的文档.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SpanOrQueryBuilder query = QueryBuilders.spanOrQuery(</span><br><span class="line">        QueryBuilders.spanTermQuery(<span class="string">&quot;field&quot;</span>, <span class="string">&quot;value1&quot;</span>))</span><br><span class="line">    .addClause(QueryBuilders.spanTermQuery(<span class="string">&quot;field&quot;</span>, <span class="string">&quot;value2&quot;</span>));</span><br></pre></td></tr></table></figure>

<h4 id="span-not查询"><a href="#span-not查询" class="headerlink" title="span_not查询"></a>span_not查询</h4><p>包装另一个span查询,并排除与该查询匹配的任何文档.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SpanNotQueryBuilder query = QueryBuilders.spanNotQuery(</span><br><span class="line">    QueryBuilders.spanTermQuery(<span class="string">&quot;field&quot;</span>, <span class="string">&quot;value1&quot;</span>),</span><br><span class="line">    QueryBuilders.spanTermQuery(<span class="string">&quot;field&quot;</span>, <span class="string">&quot;value2&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="span-containing查询"><a href="#span-containing查询" class="headerlink" title="span_containing查询"></a>span_containing查询</h4><p>接受范围查询的列表,但只返回与第二个范围查询匹配的范围.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SpanContainingQueryBuilder query = QueryBuilders.spanContainingQuery(</span><br><span class="line">    QueryBuilders.spanNearQuery(QueryBuilders.spanTermQuery(<span class="string">&quot;field1&quot;</span>, <span class="string">&quot;bar&quot;</span>), <span class="number">5</span>)</span><br><span class="line">        .addClause(QueryBuilders.spanTermQuery(<span class="string">&quot;field1&quot;</span>, <span class="string">&quot;baz&quot;</span>))</span><br><span class="line">        .inOrder(<span class="keyword">true</span>),</span><br><span class="line">    QueryBuilders.spanTermQuery(<span class="string">&quot;field1&quot;</span>, <span class="string">&quot;foo&quot;</span>));</span><br></pre></td></tr></table></figure>

<h4 id="span-within查询"><a href="#span-within查询" class="headerlink" title="span_within查询"></a>span_within查询</h4><p>单个span查询的结果将返回,只要它的span falls在其他span查询的列表中返回span.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SpanWithinQueryBuilder query = QueryBuilders.spanWithinQuery(</span><br><span class="line">    QueryBuilders.spanNearQuery(QueryBuilders.spanTermQuery(<span class="string">&quot;field1&quot;</span>, <span class="string">&quot;bar&quot;</span>), <span class="number">5</span>)</span><br><span class="line">        .addClause(QueryBuilders.spanTermQuery(<span class="string">&quot;field1&quot;</span>, <span class="string">&quot;baz&quot;</span>))</span><br><span class="line">        .inOrder(<span class="keyword">true</span>),</span><br><span class="line">    QueryBuilders.spanTermQuery(<span class="string">&quot;field1&quot;</span>, <span class="string">&quot;foo&quot;</span>));</span><br></pre></td></tr></table></figure>

<h2 id="java-api-administration"><a href="#java-api-administration" class="headerlink" title="java api administration"></a>java api administration</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AdminClient adminClient = client.admin();</span><br></pre></td></tr></table></figure>

<h3 id="indices"><a href="#indices" class="headerlink" title="indices"></a>indices</h3><p>调用admin的indices方法.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IndicesAdminClient indicesAdminClient = client.admin().indices();</span><br></pre></td></tr></table></figure>

<h4 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CreateIndexResponse response = indicesAdminClient.prepareCreate(<span class="string">&quot;twitter2&quot;</span>).get();</span><br><span class="line">CreateIndexResponse response = indicesAdminClient.prepareCreate(<span class="string">&quot;twitter3&quot;</span>)</span><br><span class="line">    .setSettings(Settings.builder()</span><br><span class="line">        .put(<span class="string">&quot;index.number_of_shards&quot;</span>, <span class="number">3</span>)</span><br><span class="line">        .put(<span class="string">&quot;index.number_of_replicas&quot;</span>, <span class="number">2</span>))</span><br><span class="line">    .get();</span><br></pre></td></tr></table></figure>

<h4 id="put-mapping"><a href="#put-mapping" class="headerlink" title="put mapping"></a>put mapping</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CreateIndexResponse response = indicesAdminClient.prepareCreate(<span class="string">&quot;twitter4&quot;</span>)</span><br><span class="line">    .addMapping(<span class="string">&quot;_doc&quot;</span>, <span class="string">&quot;user&quot;</span>, <span class="string">&quot;type=text&quot;</span>)</span><br><span class="line">    .get();</span><br></pre></td></tr></table></figure>

<h5 id="更新mapping"><a href="#更新mapping" class="headerlink" title="更新mapping"></a>更新mapping</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">AcknowledgedResponse response = indicesAdminClient.preparePutMapping(<span class="string">&quot;twitter3&quot;</span>)</span><br><span class="line">    .setType(<span class="string">&quot;_doc&quot;</span>)</span><br><span class="line">    .setSource(<span class="string">&quot;&#123;\&quot;properties\&quot;:&#123;\&quot;name\&quot;:&#123;\&quot;type\&quot;:\&quot;text\&quot;&#125;&#125;&#125;&quot;</span>, XContentType.JSON)</span><br><span class="line">    .get();</span><br></pre></td></tr></table></figure>

<h4 id="refresh"><a href="#refresh" class="headerlink" title="refresh"></a>refresh</h4><p>不传参数时刷新所有索引,可传多个索引.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RefreshResponse response = indicesAdminClient.prepareRefresh(<span class="string">&quot;twitter2&quot;</span>).get();</span><br></pre></td></tr></table></figure>

<h4 id="get-setting"><a href="#get-setting" class="headerlink" title="get setting"></a>get setting</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GetSettingsResponse response = indicesAdminClient.prepareGetSettings(<span class="string">&quot;twitter&quot;</span>).get();</span><br><span class="line"><span class="keyword">for</span> (ObjectObjectCursor&lt;String, Settings&gt; cursor : response.getIndexToSettings()) &#123;</span><br><span class="line">  String index = cursor.key;</span><br><span class="line">  Settings settings = cursor.value;</span><br><span class="line">  Integer shards = settings.getAsInt(<span class="string">&quot;index.number_of_shards&quot;</span>, <span class="keyword">null</span>);</span><br><span class="line">  Integer replicas = settings.getAsInt(<span class="string">&quot;index.number_of_replicas&quot;</span>, <span class="keyword">null</span>);</span><br><span class="line">  Util.print(index, shards, replicas);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="update-indices-setting"><a href="#update-indices-setting" class="headerlink" title="update indices setting"></a>update indices setting</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">AcknowledgedResponse response = indicesAdminClient.prepareUpdateSettings(<span class="string">&quot;twitter&quot;</span>)</span><br><span class="line">    .setSettings(Settings.builder()</span><br><span class="line">        .put(<span class="string">&quot;index.number_of_replicas&quot;</span>, <span class="number">0</span>)</span><br><span class="line">    ).get();</span><br></pre></td></tr></table></figure>

<h3 id="cluster"><a href="#cluster" class="headerlink" title="cluster"></a>cluster</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ClusterAdminClient clusterAdminClient = client.admin().cluster();</span><br></pre></td></tr></table></figure>

<h4 id="health"><a href="#health" class="headerlink" title="health"></a>health</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ClusterHealthResponse response = clusterAdminClient.prepareHealth().get();</span><br><span class="line">String clusterName = response.getClusterName();</span><br><span class="line"><span class="keyword">int</span> numberOfDataNodes = response.getNumberOfDataNodes();</span><br><span class="line"><span class="keyword">int</span> numberOfNodes = response.getNumberOfNodes();</span><br><span class="line">Util.print(clusterName, numberOfDataNodes, numberOfNodes);</span><br><span class="line">System.out.println();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (ClusterIndexHealth health : response.getIndices().values()) &#123;</span><br><span class="line">  String index = health.getIndex();</span><br><span class="line">  <span class="keyword">int</span> numberOfShards = health.getNumberOfShards();</span><br><span class="line">  <span class="keyword">int</span> numberOfReplicas = health.getNumberOfReplicas();</span><br><span class="line">  ClusterHealthStatus status = health.getStatus();</span><br><span class="line">  Util.print(index, numberOfShards, numberOfReplicas, status);</span><br><span class="line">  System.out.println();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>logging-monitor|3|3|</p>
<p>twitter4|1|1|GREEN|<br>twitter|1|0|GREEN|<br>twitter3|3|2|GREEN|<br>my-twitter|1|1|GREEN|<br>index|1|1|GREEN|<br>twitter2|1|1|GREEN|<br>blog|1|1|GREEN|</p>
<h4 id="wait-for-status"><a href="#wait-for-status" class="headerlink" title="wait for status"></a>wait for status</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ClusterHealthResponse response = clusterAdminClient.prepareHealth()</span><br><span class="line">    .setWaitForYellowStatus()</span><br><span class="line">    .get();</span><br><span class="line"></span><br><span class="line">clusterAdminClient.prepareHealth(<span class="string">&quot;twitter&quot;</span>)</span><br><span class="line">    .setWaitForGreenStatus()</span><br><span class="line">    .get();</span><br><span class="line"></span><br><span class="line">clusterAdminClient.prepareHealth(<span class="string">&quot;twitter&quot;</span>)</span><br><span class="line">    .setWaitForGreenStatus()</span><br><span class="line">    .setTimeout(TimeValue.timeValueSeconds(<span class="number">2</span>))</span><br><span class="line">    .get();</span><br></pre></td></tr></table></figure>

<h4 id="stored-scripts"><a href="#stored-scripts" class="headerlink" title="stored scripts"></a>stored scripts</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">AcknowledgedResponse s1 = clusterAdminClient.preparePutStoredScript()</span><br><span class="line">    .setId(<span class="string">&quot;s1&quot;</span>)</span><br><span class="line">    .setContent(<span class="keyword">new</span> BytesArray(<span class="string">&quot;&#123;\&quot;script\&quot;:&#123;\&quot;lang\&quot;:\&quot;painless\&quot;,\&quot;source\&quot;:\&quot;_score * doc[&#x27;my_numeric_field&#x27;].value\&quot;&#125;&#125;&quot;</span>), XContentType.JSON)</span><br><span class="line">    .get();</span><br><span class="line"></span><br><span class="line">GetStoredScriptResponse s2 = clusterAdminClient.prepareGetStoredScript()</span><br><span class="line">    .setId(<span class="string">&quot;s2&quot;</span>)</span><br><span class="line">    .get();</span><br><span class="line"></span><br><span class="line">AcknowledgedResponse s3 = clusterAdminClient.prepareDeleteStoredScript()</span><br><span class="line">    .setId(<span class="string">&quot;s3&quot;</span>)</span><br><span class="line">    .get();</span><br></pre></td></tr></table></figure>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/elasticsearch/" rel="tag"># elasticsearch</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/09/24/java8%20stream/" rel="prev" title="java8 stream">
                  <i class="fa fa-chevron-left"></i> java8 stream
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/11/11/elasticsearch-rest%20apis/" rel="next" title="elasticsearch-rest apis">
                  elasticsearch-rest apis <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>







<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">maoeryu</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  






  





</body>
</html>
