<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"maoeryu.github.io","root":"/","images":"/images","scheme":"Pisces","version":"8.2.1","exturl":false,"sidebar":{"position":"left","width":200,"display":"post","padding":7,"offset":5},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}};
  </script>
<meta name="description" content="elasticsearch rest apis.">
<meta property="og:type" content="article">
<meta property="og:title" content="elasticsearch-query dsl">
<meta property="og:url" content="https://maoeryu.github.io/2021/11/26/elasticsearch-query%20dsl/index.html">
<meta property="og:site_name" content="FlyingPig">
<meta property="og:description" content="elasticsearch rest apis.">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-11-25T16:00:00.000Z">
<meta property="article:modified_time" content="2022-07-26T02:50:49.019Z">
<meta property="article:author" content="maoeryu">
<meta property="article:tag" content="elasticsearch">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://maoeryu.github.io/2021/11/26/elasticsearch-query%20dsl/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>
<title>elasticsearch-query dsl | FlyingPig</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">FlyingPig</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#query-dsl"><span class="nav-number">1.</span> <span class="nav-text">query dsl</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E5%92%8C%E7%AD%9B%E9%80%89%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="nav-number">1.1.</span> <span class="nav-text">查询和筛选上下文</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%8D%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.2.</span> <span class="nav-text">复合查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#bool%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.2.1.</span> <span class="nav-text">bool查询</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%91%BD%E5%90%8D%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">命名查询</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#boosting%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.2.2.</span> <span class="nav-text">boosting查询</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%82%E6%95%B0"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">参数</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#constant-score%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.2.3.</span> <span class="nav-text">constant_score查询</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%82%E6%95%B0-1"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">参数</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#dis-max%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.2.4.</span> <span class="nav-text">dis_max查询</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%82%E6%95%B0-2"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">参数</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#function-score%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.2.5.</span> <span class="nav-text">function_score查询</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#score-mode"><span class="nav-number">1.2.5.1.</span> <span class="nav-text">score_mode</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#boost-mode"><span class="nav-number">1.2.5.2.</span> <span class="nav-text">boost_mode</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%A8%E6%96%87%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.3.</span> <span class="nav-text">全文查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8C%BA%E9%97%B4%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.3.1.</span> <span class="nav-text">区间查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#match"><span class="nav-number">1.3.2.</span> <span class="nav-text">match</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%AE%80%E5%8C%96%E5%8C%B9%E9%85%8D%E6%9F%A5%E8%AF%A2%E8%AF%AD%E6%B3%95"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">简化匹配查询语法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%82%E6%95%B0-3"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">参数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-number">1.3.2.3.</span> <span class="nav-text">工作原理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8C%B9%E9%85%8D%E6%9F%A5%E8%AF%A2%E4%B8%AD%E7%9A%84%E6%A8%A1%E7%B3%8A%E6%80%A7"><span class="nav-number">1.3.2.4.</span> <span class="nav-text">匹配查询中的模糊性</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%90%8C%E4%B9%89%E8%AF%8D"><span class="nav-number">1.3.2.5.</span> <span class="nav-text">同义词</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#match-bool-prefix"><span class="nav-number">1.3.3.</span> <span class="nav-text">match_bool_prefix</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8C%B9%E9%85%8D%E7%9F%AD%E8%AF%AD%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.3.4.</span> <span class="nav-text">匹配短语查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8C%B9%E9%85%8D%E7%9F%AD%E8%AF%AD%E5%89%8D%E7%BC%80%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.3.5.</span> <span class="nav-text">匹配短语前缀查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%9A%E5%8C%B9%E9%85%8D%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.3.6.</span> <span class="nav-text">多匹配查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#combined-fields"><span class="nav-number">1.3.7.</span> <span class="nav-text">combined_fields</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.3.8.</span> <span class="nav-text">查询字符串查询</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95"><span class="nav-number">1.3.8.1.</span> <span class="nav-text">语法</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AD%97%E6%AE%B5"><span class="nav-number">1.3.8.1.1.</span> <span class="nav-text">字段</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%80%9A%E9%85%8D%E7%AC%A6"><span class="nav-number">1.3.8.1.2.</span> <span class="nav-text">通配符</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">1.3.8.1.3.</span> <span class="nav-text">正则表达式</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%A8%A1%E7%B3%8A"><span class="nav-number">1.3.8.1.4.</span> <span class="nav-text">模糊</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%82%BB%E8%BF%91%E6%90%9C%E7%B4%A2"><span class="nav-number">1.3.8.1.5.</span> <span class="nav-text">邻近搜索</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%8C%83%E5%9B%B4"><span class="nav-number">1.3.8.1.6.</span> <span class="nav-text">范围</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Boosting"><span class="nav-number">1.3.8.1.7.</span> <span class="nav-text">Boosting</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%B8%83%E5%B0%94%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">1.3.8.1.8.</span> <span class="nav-text">布尔运算符</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%88%86%E7%BB%84"><span class="nav-number">1.3.8.1.9.</span> <span class="nav-text">分组</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BF%9D%E7%95%99%E5%AD%97%E7%AC%A6"><span class="nav-number">1.3.8.1.10.</span> <span class="nav-text">保留字符</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%A9%BA%E6%A0%BC-%E7%A9%BA%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.3.8.1.11.</span> <span class="nav-text">空格&#x2F;空查询</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%A4%9A%E5%AD%97%E6%AE%B5"><span class="nav-number">1.3.8.1.12.</span> <span class="nav-text">多字段</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E6%9F%A5%E8%AF%A2%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.3.9.</span> <span class="nav-text">简单查询字符串查询</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%B0%E7%90%86%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.4.</span> <span class="nav-text">地理查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#GeoShape-Query"><span class="nav-number">1.4.1.</span> <span class="nav-text">GeoShape Query</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Geo-Bounding-Box-Query"><span class="nav-number">1.4.2.</span> <span class="nav-text">Geo Bounding Box Query</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Geo-Distance-Query"><span class="nav-number">1.4.3.</span> <span class="nav-text">Geo Distance Query</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Geo-Polygon-Query"><span class="nav-number">1.4.4.</span> <span class="nav-text">Geo Polygon Query</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8C%B9%E9%85%8D%E6%89%80%E6%9C%89%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.5.</span> <span class="nav-text">匹配所有查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.6.</span> <span class="nav-text">范围查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#span-containing"><span class="nav-number">1.6.1.</span> <span class="nav-text">span_containing</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Span-Term-Query"><span class="nav-number">1.6.2.</span> <span class="nav-text">Span Term Query</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Span-Multi-Term-Query"><span class="nav-number">1.6.3.</span> <span class="nav-text">Span Multi Term Query</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Span-First-Query"><span class="nav-number">1.6.4.</span> <span class="nav-text">Span First Query</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Span-Near-Query"><span class="nav-number">1.6.5.</span> <span class="nav-text">Span Near Query</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Span-Or-Query"><span class="nav-number">1.6.6.</span> <span class="nav-text">Span Or Query</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Span-Not-Query"><span class="nav-number">1.6.7.</span> <span class="nav-text">Span Not Query</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Span-Within-Query"><span class="nav-number">1.6.8.</span> <span class="nav-text">Span Within Query</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Span-Field-Masking-Query"><span class="nav-number">1.6.9.</span> <span class="nav-text">Span Field Masking Query</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%93%E7%94%A8%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.7.</span> <span class="nav-text">专用查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B7%9D%E7%A6%BB%E7%89%B9%E5%BE%81%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.7.1.</span> <span class="nav-text">距离特征查询</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.7.1.1.</span> <span class="nav-text">查询</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%82%E6%95%B0-4"><span class="nav-number">1.7.1.2.</span> <span class="nav-text">参数</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#more-like-this"><span class="nav-number">1.7.2.</span> <span class="nav-text">more_like_this</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#percolate"><span class="nav-number">1.7.3.</span> <span class="nav-text">percolate</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#rank-feature"><span class="nav-number">1.7.4.</span> <span class="nav-text">rank_feature</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#script"><span class="nav-number">1.7.5.</span> <span class="nav-text">script</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#script-score"><span class="nav-number">1.7.6.</span> <span class="nav-text">script_score</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#wrapper"><span class="nav-number">1.7.7.</span> <span class="nav-text">wrapper</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#pinned"><span class="nav-number">1.7.8.</span> <span class="nav-text">pinned</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AF%E8%AF%AD%E7%BA%A7%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.8.</span> <span class="nav-text">术语级查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Exists"><span class="nav-number">1.8.1.</span> <span class="nav-text">Exists</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#fuzzy"><span class="nav-number">1.8.2.</span> <span class="nav-text">fuzzy</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Ids"><span class="nav-number">1.8.3.</span> <span class="nav-text">Ids</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Prefix"><span class="nav-number">1.8.4.</span> <span class="nav-text">Prefix</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Range-Query"><span class="nav-number">1.8.5.</span> <span class="nav-text">Range Query</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%82%E6%95%B0-5"><span class="nav-number">1.8.5.1.</span> <span class="nav-text">参数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#date%E5%AD%97%E6%AE%B5"><span class="nav-number">1.8.5.2.</span> <span class="nav-text">date字段</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Regexp"><span class="nav-number">1.8.6.</span> <span class="nav-text">Regexp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%AF%E8%AF%AD%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.8.7.</span> <span class="nav-text">术语查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Terms-Query"><span class="nav-number">1.8.8.</span> <span class="nav-text">Terms Query</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#terms-lookup"><span class="nav-number">1.8.8.1.</span> <span class="nav-text">terms lookup</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Terms-Set-Query"><span class="nav-number">1.8.9.</span> <span class="nav-text">Terms Set Query</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E9%85%8D%E7%AC%A6%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.8.10.</span> <span class="nav-text">通配符查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Type"><span class="nav-number">1.8.11.</span> <span class="nav-text">Type</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">maoeryu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">219</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">50</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://maoeryu.github.io/2021/11/26/elasticsearch-query%20dsl/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="maoeryu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FlyingPig">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          elasticsearch-query dsl
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-11-26 00:00:00" itemprop="dateCreated datePublished" datetime="2021-11-26T00:00:00+08:00">2021-11-26</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-07-26 10:50:49" itemprop="dateModified" datetime="2022-07-26T10:50:49+08:00">2022-07-26</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>elasticsearch rest apis.</p>
<span id="more"></span>

<h2 id="query-dsl"><a href="#query-dsl" class="headerlink" title="query dsl"></a>query dsl</h2><p>提供了一个基于json的完整查询dsl来定义查询,可以将查询dsl看作是一个抽象语法树,由两种类型的语句组成,<br>叶查询子句:在特定的字段中查找某个特定的值,match/term/range.<br>复合查询子句:bool/dis_max/constant_score.</p>
<blockquote>
<p>允许耗时的查询<br>script/fuzzy/regexp/prefix/wildcard/range(text,keyword)/join/geo/script_score,<br>可通过设置<code>search.allow_expensive_queries=false</code>来禁用,默认true.</p>
</blockquote>
<h3 id="查询和筛选上下文"><a href="#查询和筛选上下文" class="headerlink" title="查询和筛选上下文"></a>查询和筛选上下文</h3><p>查询上下文:除了判断文档是否匹配,query子句还计算<code>_score</code>.<br>筛选上下文:此文档与此查询子句是否匹配,经常使用的过滤器被自动缓存,以提高性能.</p>
<p>title包含单词的字段<code>Search</code>.<br>content包含单词的字段<code>Elasticsearch</code>.<br>status字段包含<code>完全相同</code>的单词<code>published</code>.<br>publish_date字段包含从2015年1月1日起的日期.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123; </span><br><span class="line">    <span class="attr">&quot;bool&quot;</span>: &#123; </span><br><span class="line">      <span class="attr">&quot;must&quot;</span>: [</span><br><span class="line">        &#123; <span class="attr">&quot;match&quot;</span>: &#123; <span class="attr">&quot;title&quot;</span>:   <span class="string">&quot;Search&quot;</span> &#125;&#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;match&quot;</span>: &#123; <span class="attr">&quot;content&quot;</span>: <span class="string">&quot;Elasticsearch&quot;</span> &#125;&#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;filter&quot;</span>: [ </span><br><span class="line">        &#123; <span class="attr">&quot;term&quot;</span>:  &#123; <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;published&quot;</span> &#125;&#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;range&quot;</span>: &#123; <span class="attr">&quot;publish_date&quot;</span>: &#123; <span class="attr">&quot;gte&quot;</span>: <span class="string">&quot;2015-01-01&quot;</span> &#125;&#125;&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>query参数指示查询上下文.<br>bool还有两个match子句在查询上下文中使用,这意味着它们用于计算每个文档匹配的程度.<br>filter参数指示筛选器上下文,term和range子句在筛选器上下文中使用,它们将过滤出不匹配的文档,但不会影响匹配文档的分数.</p>
<h3 id="复合查询"><a href="#复合查询" class="headerlink" title="复合查询"></a>复合查询</h3><p>复合查询将其他复合查询或叶查询包装起来,以组合结果和分数,更改其行为,或从查询切换到筛选器上下文.</p>
<h4 id="bool查询"><a href="#bool查询" class="headerlink" title="bool查询"></a>bool查询</h4><p>用于组合多个叶或复合查询子句的默认查询,如must/should/must_not/filter.<br>这个must/should从句的分数是合起来的,匹配的从句越多越好,而must_not/filter子句在筛选器上下文中执行.</p>
<p><code>must</code><br>子句(查询)必须出现在匹配的文档中,并将对分数作出贡献.</p>
<p><code>filter</code><br>子句(查询)必须出现在匹配的文档中,但忽略查询的分数,筛选器子句在执行筛选器上下文,这意味着计分被忽略,子句被考虑用于缓存.</p>
<p><code>should</code><br>子句(查询)应出现在匹配的文档中.</p>
<p><code>must_not</code><br>子句(查询)不得出现在匹配文档中,子句在中执行筛选器上下文这意味着评分被忽略,子句被考虑用于缓存.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;bool&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;must&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;term&quot;</span> : &#123; <span class="attr">&quot;user.id&quot;</span> : <span class="string">&quot;kimchy&quot;</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;filter&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;term&quot;</span> : &#123; <span class="attr">&quot;tags&quot;</span> : <span class="string">&quot;production&quot;</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;must_not&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;range&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;age&quot;</span> : &#123; <span class="attr">&quot;gte&quot;</span> : <span class="number">10</span>, <span class="attr">&quot;lte&quot;</span> : <span class="number">20</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;should&quot;</span> : [</span><br><span class="line">        &#123; <span class="attr">&quot;term&quot;</span> : &#123; <span class="attr">&quot;tags&quot;</span> : <span class="string">&quot;env1&quot;</span> &#125; &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;term&quot;</span> : &#123; <span class="attr">&quot;tags&quot;</span> : <span class="string">&quot;deployed&quot;</span> &#125; &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;minimum_should_match&quot;</span> : <span class="number">1</span>,</span><br><span class="line">      <span class="attr">&quot;boost&quot;</span> : <span class="number">1.0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="命名查询"><a href="#命名查询" class="headerlink" title="命名查询"></a>命名查询</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;bool&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;should&quot;</span>: [</span><br><span class="line">        &#123; <span class="attr">&quot;match&quot;</span>: &#123; <span class="attr">&quot;name.first&quot;</span>: &#123; <span class="attr">&quot;query&quot;</span>: <span class="string">&quot;shay&quot;</span>, <span class="attr">&quot;_name&quot;</span>: <span class="string">&quot;first&quot;</span> &#125; &#125; &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;match&quot;</span>: &#123; <span class="attr">&quot;name.last&quot;</span>: &#123; <span class="attr">&quot;query&quot;</span>: <span class="string">&quot;banon&quot;</span>, <span class="attr">&quot;_name&quot;</span>: <span class="string">&quot;last&quot;</span> &#125; &#125; &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;filter&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;terms&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;name.last&quot;</span>: [ <span class="string">&quot;banon&quot;</span>, <span class="string">&quot;kimchy&quot;</span> ],</span><br><span class="line">          <span class="attr">&quot;_name&quot;</span>: <span class="string">&quot;test&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="boosting查询"><a href="#boosting查询" class="headerlink" title="boosting查询"></a>boosting查询</h4><p>使用boosting查询以降级某些文档而不将其从搜索结果中排除.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;boosting&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;positive&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;term&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;apple&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;negative&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;term&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;pie tart fruit crumble tree&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;negative_boost&quot;</span>: <span class="number">0.5</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h5><p><code>positive</code><br>必需,查询对象,要运行的查询,任何返回的文档都必须与此查询匹配.</p>
<p><code>negative</code><br>必需,查询对象,用于减少相关核心匹配的文档.</p>
<p><code>negative_boost</code><br>必需,浮点,介于0-1,用来减少相关性得分与negative得分.</p>
<h4 id="constant-score查询"><a href="#constant-score查询" class="headerlink" title="constant_score查询"></a>constant_score查询</h4><p>包装另一个查询,返回每个匹配文档相关性得分等于boost参数值.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;constant_score&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;filter&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;term&quot;</span>: &#123; <span class="attr">&quot;user.id&quot;</span>: <span class="string">&quot;kimchy&quot;</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;boost&quot;</span>: <span class="number">1.2</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="参数-1"><a href="#参数-1" class="headerlink" title="参数"></a>参数</h5><p><code>filter</code><br>必需,查询对象,任何返回的文档都必须与此查询匹配.</p>
<p><code>boost</code><br>可选,浮点,用作常量的浮点数相关性得分,默认为1.</p>
<h4 id="dis-max查询"><a href="#dis-max查询" class="headerlink" title="dis_max查询"></a>dis_max查询</h4><p>一种接受多个查询并返回与任何查询子句相匹配的任何文档的查询,bool查询合并来自所有匹配查询的分数,dis_max查询使用单个最佳匹配查询子句的分数.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;dis_max&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;queries&quot;</span>: [</span><br><span class="line">        &#123; <span class="attr">&quot;term&quot;</span>: &#123; <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;Quick pets&quot;</span> &#125; &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;term&quot;</span>: &#123; <span class="attr">&quot;body&quot;</span>: <span class="string">&quot;Quick pets&quot;</span> &#125; &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;tie_breaker&quot;</span>: <span class="number">0.7</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="参数-2"><a href="#参数-2" class="headerlink" title="参数"></a>参数</h5><p><code>queries</code><br>必需,查询对象数组,如果多个文档查询使用最高匹配.</p>
<p><code>tie_breaker</code><br>可选,浮点,介于0-1,用于增加相关性得分匹配多个查询子句的文档,默认为0.0</p>
<h4 id="function-score查询"><a href="#function-score查询" class="headerlink" title="function_score查询"></a>function_score查询</h4><p>使用函数修改主查询返回的分数.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;function_score&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;query&quot;</span>: &#123; <span class="attr">&quot;match_all&quot;</span>: &#123;&#125; &#125;,</span><br><span class="line">      <span class="attr">&quot;boost&quot;</span>: <span class="string">&quot;5&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;random_score&quot;</span>: &#123;&#125;, </span><br><span class="line">      <span class="attr">&quot;boost_mode&quot;</span>: <span class="string">&quot;multiply&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;function_score&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;query&quot;</span>: &#123; <span class="attr">&quot;match_all&quot;</span>: &#123;&#125; &#125;,</span><br><span class="line">      <span class="attr">&quot;boost&quot;</span>: <span class="string">&quot;5&quot;</span>, </span><br><span class="line">      <span class="attr">&quot;functions&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;filter&quot;</span>: &#123; <span class="attr">&quot;match&quot;</span>: &#123; <span class="attr">&quot;test&quot;</span>: <span class="string">&quot;bar&quot;</span> &#125; &#125;,</span><br><span class="line">          <span class="attr">&quot;random_score&quot;</span>: &#123;&#125;, </span><br><span class="line">          <span class="attr">&quot;weight&quot;</span>: <span class="number">23</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;filter&quot;</span>: &#123; <span class="attr">&quot;match&quot;</span>: &#123; <span class="attr">&quot;test&quot;</span>: <span class="string">&quot;cat&quot;</span> &#125; &#125;,</span><br><span class="line">          <span class="attr">&quot;weight&quot;</span>: <span class="number">42</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;max_boost&quot;</span>: <span class="number">42</span>,</span><br><span class="line">      <span class="attr">&quot;score_mode&quot;</span>: <span class="string">&quot;max&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;boost_mode&quot;</span>: <span class="string">&quot;multiply&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;min_score&quot;</span>: <span class="number">42</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="score-mode"><a href="#score-mode" class="headerlink" title="score_mode"></a>score_mode</h5><p>multiply(默认)/sum/avg/first/max/min.</p>
<h5 id="boost-mode"><a href="#boost-mode" class="headerlink" title="boost_mode"></a>boost_mode</h5><p>multiply(默认)/replace/sum/avg/max/min.</p>
<h3 id="全文查询"><a href="#全文查询" class="headerlink" title="全文查询"></a>全文查询</h3><p>全文查询能够搜索分析过的文本字段,例如电子邮件正文.</p>
<h4 id="区间查询"><a href="#区间查询" class="headerlink" title="区间查询"></a>区间查询</h4><p>根据匹配项的顺序和接近程度返回文档.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;intervals&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;my_text&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;all_of&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;ordered&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">&quot;intervals&quot;</span> : [</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="attr">&quot;match&quot;</span> : &#123;</span><br><span class="line">                <span class="attr">&quot;query&quot;</span> : <span class="string">&quot;my favorite food&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;max_gaps&quot;</span> : <span class="number">0</span>,</span><br><span class="line">                <span class="attr">&quot;ordered&quot;</span> : <span class="literal">true</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="attr">&quot;any_of&quot;</span> : &#123;</span><br><span class="line">                <span class="attr">&quot;intervals&quot;</span> : [</span><br><span class="line">                  &#123; <span class="attr">&quot;match&quot;</span> : &#123; <span class="attr">&quot;query&quot;</span> : <span class="string">&quot;hot water&quot;</span> &#125; &#125;,</span><br><span class="line">                  &#123; <span class="attr">&quot;match&quot;</span> : &#123; <span class="attr">&quot;query&quot;</span> : <span class="string">&quot;cold porridge&quot;</span> &#125; &#125;</span><br><span class="line">                ]</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="match"><a href="#match" class="headerlink" title="match"></a>match</h4><p>用于执行全文查询的标准查询,包括模糊匹配和短语或邻近查询.<br>接受text/numeric/date/boolean,text在匹配前分析.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;message&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;query&quot;</span>: <span class="string">&quot;this is a test&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="简化匹配查询语法"><a href="#简化匹配查询语法" class="headerlink" title="简化匹配查询语法"></a>简化匹配查询语法</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;this is a test&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="参数-3"><a href="#参数-3" class="headerlink" title="参数"></a>参数</h5><p><code>query</code><br>必需,text/number/boolean/date,需要查找的字段值.</p>
<p><code>analyzer</code><br><code>auto_generate_synonyms_phrase_query</code><br>可选,boolean,默认为true,表示为多术语同义词自动创建匹配短语查询.</p>
<p><code>fuzziness</code><br><code>max_expansions</code><br><code>prefix_length</code><br><code>fuzzy_transpositions</code><br>可选,boolean,默认为true,表示模糊匹配的编辑包括两个相邻字符的换位(ab -&gt; ba).</p>
<p><code>fuzzy_rewrite</code><br><code>lenient</code><br>true,表示忽略由数据类型不匹配导致的异常,例如尝试使用文本字符串查询数值字段,默认为false.</p>
<p><code>operator</code><br>用于解释query值中文本的布尔逻辑.</p>
<p><code>minimum_should_match</code><br><code>zero_terms_query</code></p>
<h5 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h5><p>match查询类型boolean,这意味着对提供的文本进行分析,分析过程根据提供的文本构造一个布尔查询.<br>该operator参数可以设置为or/and来控制布尔子句(默认为or).<br>should可以使用<code>minimum_should_match</code>参数设置要匹配的可选子句的最小数量.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;message&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;query&quot;</span>: <span class="string">&quot;this is a test&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;operator&quot;</span>: <span class="string">&quot;and&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="匹配查询中的模糊性"><a href="#匹配查询中的模糊性" class="headerlink" title="匹配查询中的模糊性"></a>匹配查询中的模糊性</h5><p>fuzziness允许基于被查询的字段类型进行模糊匹配.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;message&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;query&quot;</span>: <span class="string">&quot;this is a testt&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;fuzziness&quot;</span>: <span class="string">&quot;AUTO&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="同义词"><a href="#同义词" class="headerlink" title="同义词"></a>同义词</h5><p>解析器会为每个多术语同义词创建短语查询,例如以下同义词,ny(new york).</p>
<p>(ny OR (new AND york)) city</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">       <span class="attr">&quot;match&quot;</span> : &#123;</span><br><span class="line">           <span class="attr">&quot;message&quot;</span>: &#123;</span><br><span class="line">               <span class="attr">&quot;query&quot;</span> : <span class="string">&quot;ny city&quot;</span>,</span><br><span class="line">               <span class="attr">&quot;auto_generate_synonyms_phrase_query&quot;</span> : <span class="literal">false</span></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="match-bool-prefix"><a href="#match-bool-prefix" class="headerlink" title="match_bool_prefix"></a>match_bool_prefix</h4><p>创建一个bool匹配每个词作为term查询的查询,除了作为prefix查询,匹配的最后一个词.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match_bool_prefix&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;message&quot;</span> : <span class="string">&quot;quick brown f&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="匹配短语查询"><a href="#匹配短语查询" class="headerlink" title="匹配短语查询"></a>匹配短语查询</h4><p>类似于match查询,但用于匹配精确的短语或单词接近匹配.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match_phrase&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;this is a test&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="匹配短语前缀查询"><a href="#匹配短语前缀查询" class="headerlink" title="匹配短语前缀查询"></a>匹配短语前缀查询</h4><p>对最后一个单词执行通配符搜索.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match_phrase_prefix&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;message&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;query&quot;</span>: <span class="string">&quot;quick brown f&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="多匹配查询"><a href="#多匹配查询" class="headerlink" title="多匹配查询"></a>多匹配查询</h4><p>多字段版本match查询.<br>可以使用通配符指定字段.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;multi_match&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;query&quot;</span>:    <span class="string">&quot;this is a test&quot;</span>, </span><br><span class="line">      <span class="attr">&quot;fields&quot;</span>: [ <span class="string">&quot;subject&quot;</span>, <span class="string">&quot;message&quot;</span> ] </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="combined-fields"><a href="#combined-fields" class="headerlink" title="combined_fields"></a>combined_fields</h4><p>匹配多个字段,就好像它们已被索引到一个组合字段中一样.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;combined_fields&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;query&quot;</span>:      <span class="string">&quot;database systems&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;fields&quot;</span>:     [ <span class="string">&quot;title&quot;</span>, <span class="string">&quot;abstract&quot;</span>, <span class="string">&quot;body&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;operator&quot;</span>:   <span class="string">&quot;and&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="查询字符串查询"><a href="#查询字符串查询" class="headerlink" title="查询字符串查询"></a>查询字符串查询</h4><p>同uri查询,语法较复杂,允许在单个查询字符串中指定<code>AND|OR|NOT</code>条件和多字段搜索.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;query_string&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;query&quot;</span>: <span class="string">&quot;(new york city) OR (big apple)&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;default_field&quot;</span>: <span class="string">&quot;content&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h5><h6 id="字段"><a href="#字段" class="headerlink" title="字段"></a>字段</h6><p><code>status:active</code><br>status字段包含active.</p>
<p><code>title:(quick OR brown)</code><br>title字段包含quick或brown.</p>
<p><code>author:&quot;John Smith&quot;</code><br>author字段包含确切短语.</p>
<p><code>first\ name:Alice</code><br>first name字段包含,转义空格.</p>
<p><code>book.\*:(quick OR brown)</code><br>任何字段(book.title,book.content等)包含,转义.</p>
<p><code>_exists_:title</code><br>title字段是否有非空值.</p>
<h6 id="通配符"><a href="#通配符" class="headerlink" title="通配符"></a>通配符</h6><p><code>qu?ck bro*</code><br><code>?</code>替换单个,<code>*</code>替换0或多个.</p>
<p><code>field:*</code><br>匹配任何非空.</p>
<h6 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h6><p><code>name:/joh?n(ath[oa]n)/</code></p>
<h6 id="模糊"><a href="#模糊" class="headerlink" title="模糊"></a>模糊</h6><p><code>quikc~ brwn~ foks~</code></p>
<h6 id="邻近搜索"><a href="#邻近搜索" class="headerlink" title="邻近搜索"></a>邻近搜索</h6><p><code>&quot;fox quick&quot;~5</code></p>
<h6 id="范围"><a href="#范围" class="headerlink" title="范围"></a>范围</h6><p>可以为日期/数字/字符串字段指定范围,包含范围用方括号指定<code>[min TO max]</code>,不包含范围用大括号指定<code>&#123;min TO max&#125;</code>.</p>
<p><code>date:[2012-01-01 TO 2012-12-31]</code><br>2012所有天.</p>
<p><code>count:[1 TO 5&#125;</code><br><code>count:[1 TO 5]</code><br>数字1到5</p>
<p><code>tag:&#123;alpha TO omega&#125;</code><br><code>count:[10 TO *]</code><br><code>date:&#123;* TO 2012-01-01&#125;</code><br>2012年以前</p>
<p><code>age:&gt;10</code><br><code>age:&gt;=10</code><br><code>age:&lt;10</code><br><code>age:&lt;=10</code><br><code>age:(&gt;=10 AND &lt;20)</code><br><code>age:(+&gt;=10 +&lt;20)</code></p>
<h6 id="Boosting"><a href="#Boosting" class="headerlink" title="Boosting"></a>Boosting</h6><p><code>quick^2 fox</code><br><code>&quot;john smith&quot;^2</code><br><code>(foo bar)^4</code></p>
<h6 id="布尔运算符"><a href="#布尔运算符" class="headerlink" title="布尔运算符"></a>布尔运算符</h6><p><code>((quick AND fox) OR (brown AND fox) OR fox) AND NOT news</code><br><code>quick brown +fox -news</code><br><code>+</code>表示包含,<code>-</code>表示排除.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;bool&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;must&quot;</span>:     &#123; <span class="attr">&quot;match&quot;</span>: <span class="string">&quot;fox&quot;</span>         &#125;,</span><br><span class="line">        <span class="attr">&quot;should&quot;</span>:   &#123; <span class="attr">&quot;match&quot;</span>: <span class="string">&quot;quick brown&quot;</span> &#125;,</span><br><span class="line">        <span class="attr">&quot;must_not&quot;</span>: &#123; <span class="attr">&quot;match&quot;</span>: <span class="string">&quot;news&quot;</span>        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h6><p><code>(quick OR brown) AND fox</code><br><code>status:(active OR pending) title:(full text search)^2</code></p>
<h6 id="保留字符"><a href="#保留字符" class="headerlink" title="保留字符"></a>保留字符</h6><p>保留字段,<code>+ - = &amp;&amp; || &gt; &lt; ! ( ) &#123; &#125; [ ] ^ &quot; ~ * ? : \ /</code>,使用<code>\\</code>转义</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;query_string&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;query&quot;</span> : <span class="string">&quot;kimchy\\!&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;fields&quot;</span>  : [<span class="string">&quot;user.id&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h6 id="空格-空查询"><a href="#空格-空查询" class="headerlink" title="空格/空查询"></a>空格/空查询</h6><h6 id="多字段"><a href="#多字段" class="headerlink" title="多字段"></a>多字段</h6><h4 id="简单查询字符串查询"><a href="#简单查询字符串查询" class="headerlink" title="简单查询字符串查询"></a>简单查询字符串查询</h4><p>更简单/更健壮的版本.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;simple_query_string&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;query&quot;</span>: <span class="string">&quot;\&quot;fried eggs\&quot; +(eggplant | potato) -frittata&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;fields&quot;</span>: [<span class="string">&quot;title^5&quot;</span>, <span class="string">&quot;body&quot;</span>],</span><br><span class="line">        <span class="attr">&quot;default_operator&quot;</span>: <span class="string">&quot;and&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="地理查询"><a href="#地理查询" class="headerlink" title="地理查询"></a>地理查询</h3><h4 id="GeoShape-Query"><a href="#GeoShape-Query" class="headerlink" title="GeoShape Query"></a>GeoShape Query</h4><h4 id="Geo-Bounding-Box-Query"><a href="#Geo-Bounding-Box-Query" class="headerlink" title="Geo Bounding Box Query"></a>Geo Bounding Box Query</h4><h4 id="Geo-Distance-Query"><a href="#Geo-Distance-Query" class="headerlink" title="Geo Distance Query"></a>Geo Distance Query</h4><h4 id="Geo-Polygon-Query"><a href="#Geo-Polygon-Query" class="headerlink" title="Geo Polygon Query"></a>Geo Polygon Query</h4><h3 id="匹配所有查询"><a href="#匹配所有查询" class="headerlink" title="匹配所有查询"></a>匹配所有查询</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>无匹配查询,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match_none&quot;</span>: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="范围查询"><a href="#范围查询" class="headerlink" title="范围查询"></a>范围查询</h3><h4 id="span-containing"><a href="#span-containing" class="headerlink" title="span_containing"></a>span_containing</h4><h4 id="Span-Term-Query"><a href="#Span-Term-Query" class="headerlink" title="Span Term Query"></a>Span Term Query</h4><h4 id="Span-Multi-Term-Query"><a href="#Span-Multi-Term-Query" class="headerlink" title="Span Multi Term Query"></a>Span Multi Term Query</h4><h4 id="Span-First-Query"><a href="#Span-First-Query" class="headerlink" title="Span First Query"></a>Span First Query</h4><h4 id="Span-Near-Query"><a href="#Span-Near-Query" class="headerlink" title="Span Near Query"></a>Span Near Query</h4><h4 id="Span-Or-Query"><a href="#Span-Or-Query" class="headerlink" title="Span Or Query"></a>Span Or Query</h4><h4 id="Span-Not-Query"><a href="#Span-Not-Query" class="headerlink" title="Span Not Query"></a>Span Not Query</h4><h4 id="Span-Within-Query"><a href="#Span-Within-Query" class="headerlink" title="Span Within Query"></a>Span Within Query</h4><h4 id="Span-Field-Masking-Query"><a href="#Span-Field-Masking-Query" class="headerlink" title="Span Field Masking Query"></a>Span Field Masking Query</h4><h3 id="专用查询"><a href="#专用查询" class="headerlink" title="专用查询"></a>专用查询</h3><h4 id="距离特征查询"><a href="#距离特征查询" class="headerlink" title="距离特征查询"></a>距离特征查询</h4><p>查找某个位置的最近邻居,要使用distance_feature查询,索引必须包含date/date_nanos/geo_point字段.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/items?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;production_date&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;date&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;location&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;geo_point&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/items/_doc/1?refresh&amp;pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span> : <span class="string">&quot;chocolate&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;production_date&quot;</span>: <span class="string">&quot;2018-02-01&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;location&quot;</span>: [<span class="number">-71.34</span>, <span class="number">41.12</span>]</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/items/_doc/2?refresh&amp;pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span> : <span class="string">&quot;chocolate&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;production_date&quot;</span>: <span class="string">&quot;2018-01-01&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;location&quot;</span>: [<span class="number">-71.3</span>, <span class="number">41.15</span>]</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/items/_doc/3?refresh&amp;pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span> : <span class="string">&quot;chocolate&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;production_date&quot;</span>: <span class="string">&quot;2017-12-01&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;location&quot;</span>: [<span class="number">-71.3</span>, <span class="number">41.12</span>]</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/items/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;bool&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;must&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;chocolate&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;should&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;distance_feature&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;production_date&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;pivot&quot;</span>: <span class="string">&quot;7d&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;origin&quot;</span>: <span class="string">&quot;now&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/items/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;bool&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;must&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;chocolate&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;should&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;distance_feature&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;location&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;pivot&quot;</span>: <span class="string">&quot;1000m&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;origin&quot;</span>: [<span class="number">-71.3</span>, <span class="number">41.15</span>]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="参数-4"><a href="#参数-4" class="headerlink" title="参数"></a>参数</h5><p><code>field</code><br>必需,用于计算距离的字段名称.</p>
<p><code>origin</code><br>必需,字符串,用于计算距离的日期或原点.<br>如果field为date/date_nanos字段,则origin必须为date,支持日期函数,如now-1h.</p>
<p><code>pivot</code><br>必须,时间/距离单位,1h/10d,1km/12m.</p>
<p><code>boost</code></p>
<h4 id="more-like-this"><a href="#more-like-this" class="headerlink" title="more_like_this"></a>more_like_this</h4><p>查找与给定文档集&quot;相似&quot;的文档.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;more_like_this&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;fields&quot;</span> : [<span class="string">&quot;title&quot;</span>, <span class="string">&quot;description&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;like&quot;</span> : <span class="string">&quot;Once upon a time&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;min_term_freq&quot;</span> : <span class="number">1</span>,</span><br><span class="line">      <span class="attr">&quot;max_query_terms&quot;</span> : <span class="number">12</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;more_like_this&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;fields&quot;</span>: [ <span class="string">&quot;title&quot;</span>, <span class="string">&quot;description&quot;</span> ],</span><br><span class="line">      <span class="attr">&quot;like&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;_index&quot;</span>: <span class="string">&quot;imdb&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;_id&quot;</span>: <span class="string">&quot;1&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;_index&quot;</span>: <span class="string">&quot;imdb&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;_id&quot;</span>: <span class="string">&quot;2&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;and potentially some more text here as well&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;min_term_freq&quot;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">&quot;max_query_terms&quot;</span>: <span class="number">12</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;more_like_this&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;fields&quot;</span>: [ <span class="string">&quot;name.first&quot;</span>, <span class="string">&quot;name.last&quot;</span> ],</span><br><span class="line">      <span class="attr">&quot;like&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;_index&quot;</span>: <span class="string">&quot;marvel&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;doc&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;name&quot;</span>: &#123;</span><br><span class="line">              <span class="attr">&quot;first&quot;</span>: <span class="string">&quot;Ben&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;last&quot;</span>: <span class="string">&quot;Grimm&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;_doc&quot;</span>: <span class="string">&quot;You got no idea what I\u0027d... what I\u0027d give to be invisible.&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;_index&quot;</span>: <span class="string">&quot;marvel&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;_id&quot;</span>: <span class="string">&quot;2&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;min_term_freq&quot;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">&quot;max_query_terms&quot;</span>: <span class="number">12</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="percolate"><a href="#percolate" class="headerlink" title="percolate"></a>percolate</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-00001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;message&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;percolator&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-00001/_doc/1?refresh&amp;pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;bonsai tree&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/my-index-00001/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;percolate&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;query&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;document&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;A new bonsai tree in the office&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="rank-feature"><a href="#rank-feature" class="headerlink" title="rank_feature"></a>rank_feature</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/test?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;pagerank&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;rank_feature&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;url_length&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;rank_feature&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;positive_score_impact&quot;</span>: <span class="literal">false</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;topics&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;rank_features&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/test/_doc/1?refresh&amp;pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;https://en.wikipedia.org/wiki/2016_Summer_Olympics&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;content&quot;</span>: <span class="string">&quot;Rio 2016&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;pagerank&quot;</span>: <span class="number">50.3</span>,</span><br><span class="line">  <span class="attr">&quot;url_length&quot;</span>: <span class="number">42</span>,</span><br><span class="line">  <span class="attr">&quot;topics&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;sports&quot;</span>: <span class="number">50</span>,</span><br><span class="line">    <span class="attr">&quot;brazil&quot;</span>: <span class="number">30</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/test/_doc/2?refresh&amp;pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;https://en.wikipedia.org/wiki/2016_Brazilian_Grand_Prix&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;content&quot;</span>: <span class="string">&quot;Formula One motor race held on 13 November 2016&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;pagerank&quot;</span>: <span class="number">50.3</span>,</span><br><span class="line">  <span class="attr">&quot;url_length&quot;</span>: <span class="number">47</span>,</span><br><span class="line">  <span class="attr">&quot;topics&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;sports&quot;</span>: <span class="number">35</span>,</span><br><span class="line">    <span class="attr">&quot;formula one&quot;</span>: <span class="number">65</span>,</span><br><span class="line">    <span class="attr">&quot;brazil&quot;</span>: <span class="number">20</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/test/_doc/3?refresh&amp;pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;https://en.wikipedia.org/wiki/Deadpool_(film)&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;content&quot;</span>: <span class="string">&quot;Deadpool is a 2016 American superhero film&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;pagerank&quot;</span>: <span class="number">50.3</span>,</span><br><span class="line">  <span class="attr">&quot;url_length&quot;</span>: <span class="number">37</span>,</span><br><span class="line">  <span class="attr">&quot;topics&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;movies&quot;</span>: <span class="number">60</span>,</span><br><span class="line">    <span class="attr">&quot;super hero&quot;</span>: <span class="number">65</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/test/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;bool&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;must&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;content&quot;</span>: <span class="string">&quot;2016&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;should&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;rank_feature&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;pagerank&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;rank_feature&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;url_length&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;boost&quot;</span>: <span class="number">0.1</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;rank_feature&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;topics.sports&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;boost&quot;</span>: <span class="number">0.4</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="script"><a href="#script" class="headerlink" title="script"></a>script</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;bool&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;filter&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;script&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;script&quot;</span>: <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">            double amount = doc[&#x27;amount&#x27;].value;</span></span><br><span class="line"><span class="string">            if (doc[&#x27;type&#x27;].value == &#x27;expense&#x27;) &#123;</span></span><br><span class="line"><span class="string">              amount *= -1;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            return amount &lt; 10;</span></span><br><span class="line"><span class="string">          &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;runtime_mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;amount.signed&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;double&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;script&quot;</span>: <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        double amount = doc[&#x27;amount&#x27;].value;</span></span><br><span class="line"><span class="string">        if (doc[&#x27;type&#x27;].value == &#x27;expense&#x27;) &#123;</span></span><br><span class="line"><span class="string">          amount *= -1;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        emit(amount);</span></span><br><span class="line"><span class="string">      &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;bool&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;filter&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;range&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;amount.signed&quot;</span>: &#123; <span class="attr">&quot;lt&quot;</span>: <span class="number">10</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;fields&quot;</span>: [&#123;<span class="attr">&quot;field&quot;</span>: <span class="string">&quot;amount.signed&quot;</span>&#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;bool&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;filter&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;script&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;script&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;source&quot;</span>: <span class="string">&quot;doc[&#x27;num1&#x27;].value &gt; params.param1&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;lang&quot;</span>: <span class="string">&quot;painless&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;params&quot;</span>: &#123;</span><br><span class="line">              <span class="attr">&quot;param1&quot;</span>: <span class="number">5</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="script-score"><a href="#script-score" class="headerlink" title="script_score"></a>script_score</h4><h4 id="wrapper"><a href="#wrapper" class="headerlink" title="wrapper"></a>wrapper</h4><p>base64 encoded string.<br><code>Base64 encoded string: &#123;&quot;term&quot; : &#123; &quot;user.id&quot; : &quot;kimchy&quot; &#125;&#125;</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;wrapper&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;query&quot;</span>: <span class="string">&quot;eyJ0ZXJtIiA6IHsgInVzZXIuaWQiIDogImtpbWNoeSIgfX0=&quot;</span> </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="pinned"><a href="#pinned" class="headerlink" title="pinned"></a>pinned</h4><h3 id="术语级查询"><a href="#术语级查询" class="headerlink" title="术语级查询"></a>术语级查询</h3><p>使用术语级查询根据结构化数据中的精确值查找文档.<br>结构化数据的示例包括日期范围/IP地址/价格/产品ID.</p>
<blockquote>
<p>与全文查询不同,词级查询不分析搜索词.<br>相反,术语级别的查询与存储在字段中的<code>确切术语相匹配</code>.</p>
</blockquote>
<h4 id="Exists"><a href="#Exists" class="headerlink" title="Exists"></a>Exists</h4><p>返回包含字段的任何索引值的文档.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;exists&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;user&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>查找缺少索引值的文档,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;bool&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;must_not&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;exists&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;user.id&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="fuzzy"><a href="#fuzzy" class="headerlink" title="fuzzy"></a>fuzzy</h4><p>返回包含与搜索词相似的词的文档.<br><code>search.allow_expensive_queries</code>设置为false,则禁用模糊查询.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;fuzzy&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;user.id&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;value&quot;</span>: <span class="string">&quot;ki&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="Ids"><a href="#Ids" class="headerlink" title="Ids"></a>Ids</h4><p>根据文档ID返回文档.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;ids&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;values&quot;</span> : [<span class="string">&quot;1&quot;</span>, <span class="string">&quot;4&quot;</span>, <span class="string">&quot;100&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="Prefix"><a href="#Prefix" class="headerlink" title="Prefix"></a>Prefix</h4><p>返回在提供的字段中包含特定前缀的文档.<br><code>search.allow_expensive_queries</code>设置为false,则禁用.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;prefix&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;user.id&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;value&quot;</span>: <span class="string">&quot;ki&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>简化查询语法,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;prefix&quot;</span> : &#123; <span class="attr">&quot;user&quot;</span> : <span class="string">&quot;ki&quot;</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="Range-Query"><a href="#Range-Query" class="headerlink" title="Range Query"></a>Range Query</h4><p>返回包含提供范围内的术语的文档.<br><code>search.allow_expensive_queries</code>设置为false,则禁用text/keyword字段.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;range&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;age&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;gte&quot;</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="attr">&quot;lte&quot;</span>: <span class="number">20</span>,</span><br><span class="line">        <span class="attr">&quot;boost&quot;</span>: <span class="number">2.0</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="参数-5"><a href="#参数-5" class="headerlink" title="参数"></a>参数</h5><p><code>gt</code><br><code>gte</code><br><code>lt</code><br><code>lte</code><br><code>format</code><br><code>relation</code><br><code>time_zone</code><br><code>boost</code></p>
<h5 id="date字段"><a href="#date字段" class="headerlink" title="date字段"></a>date字段</h5><p>可使用日期函数.<br>day (01), hour (23), minute (59), second (59), and nanosecond (999_999_999).</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;range&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;timestamp&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;gte&quot;</span>: <span class="string">&quot;now-1d/d&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;lt&quot;</span>: <span class="string">&quot;now/d&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;range&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;timestamp&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;time_zone&quot;</span>: <span class="string">&quot;+01:00&quot;</span>,        </span><br><span class="line">        <span class="attr">&quot;gte&quot;</span>: <span class="string">&quot;2020-01-01T00:00:00&quot;</span>, </span><br><span class="line">        <span class="attr">&quot;lte&quot;</span>: <span class="string">&quot;now&quot;</span>                  </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="Regexp"><a href="#Regexp" class="headerlink" title="Regexp"></a>Regexp</h4><p>返回包含与正则表达式匹配的术语的文档.<br><code>search.allow_expensive_queries</code>设置为false,则禁用.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;regexp&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;user.id&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;value&quot;</span>: <span class="string">&quot;k.*y&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;flags&quot;</span>: <span class="string">&quot;ALL&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;case_insensitive&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">&quot;max_determinized_states&quot;</span>: <span class="number">10000</span>,</span><br><span class="line">        <span class="attr">&quot;rewrite&quot;</span>: <span class="string">&quot;constant_score&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>不支持<code>^$</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">匹配任何字符</span><br><span class="line">ab.     # matches &#39;aba&#39;, &#39;abb&#39;, &#39;abz&#39;, etc.</span><br><span class="line"></span><br><span class="line">重复前面的字符0&#x2F;1次</span><br><span class="line">abc?     # matches &#39;ab&#39; and &#39;abc&#39;</span><br><span class="line"></span><br><span class="line">重复前面的字符一次或多次</span><br><span class="line">ab+     # matches &#39;ab&#39;, &#39;abb&#39;, &#39;abbb&#39;, etc.</span><br><span class="line"></span><br><span class="line">重复前面的字符零次或多次</span><br><span class="line">ab*     # matches &#39;a&#39;, &#39;ab&#39;, &#39;abb&#39;, &#39;abbb&#39;, etc.</span><br><span class="line"></span><br><span class="line">前一个字符可以重复的最小和最大次数</span><br><span class="line">a&#123;2&#125;    # matches &#39;aa&#39;</span><br><span class="line">a&#123;2,4&#125;  # matches &#39;aa&#39;, &#39;aaa&#39;, and &#39;aaaa&#39;</span><br><span class="line">a&#123;2,&#125;   # matches &#39;a&#96; repeated two or more times</span><br><span class="line"></span><br><span class="line">或运算符</span><br><span class="line">abc|xyz  # matches &#39;abc&#39; and &#39;xyz&#39;</span><br><span class="line"></span><br><span class="line">使用组将部分表达式视为单个字符</span><br><span class="line">abc(def)?  # matches &#39;abc&#39; and &#39;abcdef&#39; but not &#39;abcd&#39;</span><br><span class="line"></span><br><span class="line">匹配括号中的字符之一</span><br><span class="line">[abc]   # matches &#39;a&#39;, &#39;b&#39;, &#39;c&#39;</span><br><span class="line"></span><br><span class="line">[a-c]   # matches &#39;a&#39;, &#39;b&#39;, or &#39;c&#39;</span><br><span class="line">[-abc]  # &#39;-&#39; is first character. Matches &#39;-&#39;, &#39;a&#39;, &#39;b&#39;, or &#39;c&#39;</span><br><span class="line">[abc\-] # Escapes &#39;-&#39;. Matches &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, or &#39;-&#39;</span><br><span class="line">[^abc]      # matches any character except &#39;a&#39;, &#39;b&#39;, or &#39;c&#39;</span><br><span class="line">[^a-c]      # matches any character except &#39;a&#39;, &#39;b&#39;, or &#39;c&#39;</span><br><span class="line">[^-abc]     # matches any character except &#39;-&#39;, &#39;a&#39;, &#39;b&#39;, or &#39;c&#39;</span><br><span class="line">[^abc\-]    # matches any character except &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, or &#39;-&#39;</span><br><span class="line"></span><br><span class="line">a~bc   # matches &#39;adc&#39; and &#39;aec&#39; but not &#39;abc&#39;</span><br><span class="line"></span><br><span class="line">foo&lt;1-100&gt;      # matches &#39;foo1&#39;, &#39;foo2&#39; ... &#39;foo99&#39;, &#39;foo100&#39;</span><br><span class="line">foo&lt;01-100&gt;     # matches &#39;foo01&#39;, &#39;foo02&#39; ... &#39;foo99&#39;, &#39;foo100&#39;</span><br><span class="line"></span><br><span class="line">aaa.+&amp;.+bbb  # matches &#39;aaabbb&#39;</span><br><span class="line"></span><br><span class="line">@&amp;~(abc.+)  # matches everything except terms beginning with &#39;abc&#39;</span><br></pre></td></tr></table></figure>

<h4 id="术语查询"><a href="#术语查询" class="headerlink" title="术语查询"></a>术语查询</h4><p>返回在提供的字段中包含确切术语的文档.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;term&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;user.id&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;value&quot;</span>: <span class="string">&quot;kimchy&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;boost&quot;</span>: <span class="number">1.0</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>避免使用term查询text字段</p>
</blockquote>
<p>创建text字段的索引,填充数据,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;full_text&quot;</span>: &#123; <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line"></span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;full_text&quot;</span>:   <span class="string">&quot;Quick Brown Foxes!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>text字段被分词,使用term查询时将无结果返回,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_search?pretty&amp;pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;term&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;full_text&quot;</span>: <span class="string">&quot;Quick Brown Foxes!&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>需要使用match查询,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_search?pretty&amp;pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;full_text&quot;</span>: <span class="string">&quot;Quick Brown Foxes!&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="Terms-Query"><a href="#Terms-Query" class="headerlink" title="Terms Query"></a>Terms Query</h4><p>和term查询类似,返回在提供的字段中包含一个或多个精确术语的文档.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;terms&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;user.id&quot;</span>: [ <span class="string">&quot;kimchy&quot;</span>, <span class="string">&quot;elkbee&quot;</span> ],</span><br><span class="line">      <span class="attr">&quot;boost&quot;</span>: <span class="number">1.0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="terms-lookup"><a href="#terms-lookup" class="headerlink" title="terms lookup"></a>terms lookup</h5><p><code>index</code><br>从中获取字段值的索引的名称.</p>
<p><code>id</code><br>从中获取字段值的文档的ID.</p>
<p><code>path</code><br>从中获取字段值的字段的名称,Elasticsearch使用这些值作为查询的搜索词.</p>
<p><code>routing</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;color&quot;</span>: &#123; <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line"></span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;color&quot;</span>:   [<span class="string">&quot;blue&quot;</span>, <span class="string">&quot;green&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line"></span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/2?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;color&quot;</span>:   <span class="string">&quot;blue&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>使用terms带有词条查找参数的查询来查找包含一个或多个与文档2相同的词条的文档,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_search?pretty&amp;pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;terms&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;color&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;index&quot;</span> : <span class="string">&quot;my-index-000001&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;id&quot;</span> : <span class="string">&quot;2&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;path&quot;</span> : <span class="string">&quot;color&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="Terms-Set-Query"><a href="#Terms-Set-Query" class="headerlink" title="Terms Set Query"></a>Terms Set Query</h4><p>返回在提供的字段中包含最少数量的精确术语的文档,使用字段或脚本定义匹配术语的最小数量.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/job-candidates?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;programming_languages&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;required_matches&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line"></span><br><span class="line">curl -X PUT &quot;localhost:9200/job-candidates/_doc/1?refresh&amp;pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Jane Smith&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;programming_languages&quot;</span>: [ <span class="string">&quot;c++&quot;</span>, <span class="string">&quot;java&quot;</span> ],</span><br><span class="line">  <span class="attr">&quot;required_matches&quot;</span>: <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line"></span><br><span class="line">curl -X PUT &quot;localhost:9200/job-candidates/_doc/2?refresh&amp;pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Jason Response&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;programming_languages&quot;</span>: [ <span class="string">&quot;java&quot;</span>, <span class="string">&quot;php&quot;</span> ],</span><br><span class="line">  <span class="attr">&quot;required_matches&quot;</span>: <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>查询,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/job-candidates/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;terms_set&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;programming_languages&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;terms&quot;</span>: [ <span class="string">&quot;c++&quot;</span>, <span class="string">&quot;java&quot;</span>, <span class="string">&quot;php&quot;</span> ],</span><br><span class="line">        <span class="attr">&quot;minimum_should_match_field&quot;</span>: <span class="string">&quot;required_matches&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET /job-candidates/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;terms_set&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;programming_languages&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;terms&quot;</span>: [ <span class="string">&quot;c++&quot;</span>, <span class="string">&quot;java&quot;</span>, <span class="string">&quot;php&quot;</span> ],</span><br><span class="line">        <span class="attr">&quot;minimum_should_match_script&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;source&quot;</span>: <span class="string">&quot;Math.min(params.num_terms, doc[&#x27;required_matches&#x27;].value)&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;boost&quot;</span>: <span class="number">1.0</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="通配符查询"><a href="#通配符查询" class="headerlink" title="通配符查询"></a>通配符查询</h4><p>返回包含匹配通配符模式的术语的文档.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;wildcard&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;user.id&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;value&quot;</span>: <span class="string">&quot;ki*y&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;boost&quot;</span>: <span class="number">1.0</span>,</span><br><span class="line">        <span class="attr">&quot;rewrite&quot;</span>: <span class="string">&quot;constant_score&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="Type"><a href="#Type" class="headerlink" title="Type"></a>Type</h4><p>返回指定类型的文档.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;type&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;value&quot;</span>: <span class="string">&quot;_doc&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/elasticsearch/" rel="tag"># elasticsearch</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/11/24/elasticsearch-%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2/" rel="prev" title="elasticsearch-连接查询">
                  <i class="fa fa-chevron-left"></i> elasticsearch-连接查询
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/12/02/elasticsearch-mapping%20&%20text%20analysis/" rel="next" title="elasticsearch-mapping & text analysis">
                  elasticsearch-mapping & text analysis <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>







<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">maoeryu</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  






  





</body>
</html>
