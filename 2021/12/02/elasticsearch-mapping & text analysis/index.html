<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"maoeryu.github.io","root":"/","images":"/images","scheme":"Pisces","version":"8.2.1","exturl":false,"sidebar":{"position":"left","width":200,"display":"post","padding":7,"offset":5},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}};
  </script>
<meta name="description" content="elasticsearch mapping&#x2F;text analysis.elasticsearch7版本以上不再接受默认映射类型.elasticsearch版本7.10">
<meta property="og:type" content="article">
<meta property="og:title" content="elasticsearch-mapping &amp; text analysis">
<meta property="og:url" content="https://maoeryu.github.io/2021/12/02/elasticsearch-mapping%20&%20text%20analysis/index.html">
<meta property="og:site_name" content="FlyingPig">
<meta property="og:description" content="elasticsearch mapping&#x2F;text analysis.elasticsearch7版本以上不再接受默认映射类型.elasticsearch版本7.10">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-12-01T16:00:00.000Z">
<meta property="article:modified_time" content="2022-07-26T02:50:46.074Z">
<meta property="article:author" content="maoeryu">
<meta property="article:tag" content="elasticsearch">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://maoeryu.github.io/2021/12/02/elasticsearch-mapping%20&%20text%20analysis/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>
<title>elasticsearch-mapping & text analysis | FlyingPig</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">FlyingPig</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#mapping"><span class="nav-number">1.</span> <span class="nav-text">mapping</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E6%98%A0%E5%B0%84"><span class="nav-number">1.1.</span> <span class="nav-text">动态映射</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E5%AD%97%E6%AE%B5%E6%98%A0%E5%B0%84"><span class="nav-number">1.1.1.</span> <span class="nav-text">动态字段映射</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%97%A5%E6%9C%9F%E6%A3%80%E6%B5%8B"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">日期检测</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%A6%81%E7%94%A8%E6%97%A5%E6%9C%9F%E6%A3%80%E6%B5%8B"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">禁用日期检测</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%97%A5%E6%9C%9F%E6%A0%BC%E5%BC%8F"><span class="nav-number">1.1.1.3.</span> <span class="nav-text">自定义日期格式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%95%B0%E5%80%BC%E6%A3%80%E6%B5%8B"><span class="nav-number">1.1.1.4.</span> <span class="nav-text">数值检测</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E6%A8%A1%E6%9D%BF"><span class="nav-number">1.1.2.</span> <span class="nav-text">动态模板</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#match-mapping-type"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">match_mapping_type</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#match-unmatch"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">match&#x2F;unmatch</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#match-pattern"><span class="nav-number">1.1.2.3.</span> <span class="nav-text">match_pattern</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#path-match-path-unmatch"><span class="nav-number">1.1.2.4.</span> <span class="nav-text">path_match&#x2F;path_unmatch</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E5%8F%98%E9%87%8F"><span class="nav-number">1.1.2.5.</span> <span class="nav-text">模板变量</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E6%A8%A1%E6%9D%BF%E7%A4%BA%E4%BE%8B"><span class="nav-number">1.1.2.6.</span> <span class="nav-text">动态模板示例</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%BB%93%E6%9E%84%E5%8C%96%E6%90%9C%E7%B4%A2"><span class="nav-number">1.1.2.6.1.</span> <span class="nav-text">结构化搜索</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#text-%E4%BB%85%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%98%A0%E5%B0%84"><span class="nav-number">1.1.2.6.2.</span> <span class="nav-text">text-仅字符串映射</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%A6%81%E7%94%A8norms"><span class="nav-number">1.1.2.6.3.</span> <span class="nav-text">禁用norms</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97"><span class="nav-number">1.1.2.6.4.</span> <span class="nav-text">时间序列</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%98%BE%E5%BC%8F%E6%98%A0%E5%B0%84"><span class="nav-number">1.2.</span> <span class="nav-text">显式映射</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%98%BE%E5%BC%8F%E6%98%A0%E5%B0%84%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="nav-number">1.2.1.</span> <span class="nav-text">使用显式映射创建索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E6%96%B0%E5%AD%97%E6%AE%B5"><span class="nav-number">1.2.2.</span> <span class="nav-text">添加新字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E5%AD%97%E6%AE%B5%E6%98%A0%E5%B0%84"><span class="nav-number">1.2.3.</span> <span class="nav-text">更新字段映射</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E7%B4%A2%E5%BC%95%E6%98%A0%E5%B0%84"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">查看索引映射</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E7%89%B9%E5%AE%9A%E5%AD%97%E6%AE%B5%E6%98%A0%E5%B0%84"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">查看特定字段映射</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E6%AE%B5%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.3.</span> <span class="nav-text">字段数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.3.1.</span> <span class="nav-text">常见类型</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#binary"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">binary</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#boolean"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">boolean</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Keywords"><span class="nav-number">1.3.1.3.</span> <span class="nav-text">Keywords</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#constant-keyword"><span class="nav-number">1.3.1.3.1.</span> <span class="nav-text">constant_keyword</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#wildcard"><span class="nav-number">1.3.1.3.2.</span> <span class="nav-text">wildcard</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Numbers"><span class="nav-number">1.3.1.4.</span> <span class="nav-text">Numbers</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Unsigned-long"><span class="nav-number">1.3.1.5.</span> <span class="nav-text">Unsigned long</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Dates"><span class="nav-number">1.3.1.6.</span> <span class="nav-text">Dates</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#date"><span class="nav-number">1.3.1.6.1.</span> <span class="nav-text">date</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#date-nanoseconds"><span class="nav-number">1.3.1.6.2.</span> <span class="nav-text">date nanoseconds</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#alias"><span class="nav-number">1.3.1.7.</span> <span class="nav-text">alias</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%B9%E8%B1%A1%E5%92%8C%E5%85%B3%E7%B3%BB%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.3.2.</span> <span class="nav-text">对象和关系类型</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#object"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">object</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#flattened"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">flattened</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#nested"><span class="nav-number">1.3.2.3.</span> <span class="nav-text">nested</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#join"><span class="nav-number">1.3.2.4.</span> <span class="nav-text">join</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%85%A8%E5%B1%80%E5%BA%8F%E6%95%B0"><span class="nav-number">1.3.2.4.1.</span> <span class="nav-text">全局序数</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E5%A4%9A%E4%B8%AA%E5%AD%90%E7%BA%A7"><span class="nav-number">1.3.2.4.2.</span> <span class="nav-text">定义多个子级</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.3.3.</span> <span class="nav-text">结构化数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Range"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">Range</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ip"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">ip</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#version"><span class="nav-number">1.3.3.3.</span> <span class="nav-text">version</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%81%9A%E5%90%88%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.3.4.</span> <span class="nav-text">聚合数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#histogram"><span class="nav-number">1.3.4.1.</span> <span class="nav-text">histogram</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%87%E6%9C%AC%E6%90%9C%E7%B4%A2%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.3.5.</span> <span class="nav-text">文本搜索类型</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#text"><span class="nav-number">1.3.5.1.</span> <span class="nav-text">text</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#fielddata"><span class="nav-number">1.3.5.1.1.</span> <span class="nav-text">fielddata</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#annotated-text"><span class="nav-number">1.3.5.2.</span> <span class="nav-text">annotated-text</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#completion"><span class="nav-number">1.3.5.3.</span> <span class="nav-text">completion</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#search-as-you-type"><span class="nav-number">1.3.5.4.</span> <span class="nav-text">search_as_you_type</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#token-count"><span class="nav-number">1.3.5.5.</span> <span class="nav-text">token_count</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%87%E6%A1%A3%E6%8E%92%E5%BA%8F%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.3.6.</span> <span class="nav-text">文档排序类型</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#dense-vector"><span class="nav-number">1.3.6.1.</span> <span class="nav-text">dense_vector</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#sparse-vector"><span class="nav-number">1.3.6.2.</span> <span class="nav-text">sparse_vector</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#rank-feature"><span class="nav-number">1.3.6.3.</span> <span class="nav-text">rank_feature</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#rank-features"><span class="nav-number">1.3.6.4.</span> <span class="nav-text">rank_features</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A9%BA%E9%97%B4%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.3.7.</span> <span class="nav-text">空间数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#geo-point"><span class="nav-number">1.3.7.1.</span> <span class="nav-text">geo_point</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#geo-shape"><span class="nav-number">1.3.7.2.</span> <span class="nav-text">geo_shape</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#point"><span class="nav-number">1.3.7.3.</span> <span class="nav-text">point</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#shape"><span class="nav-number">1.3.7.4.</span> <span class="nav-text">shape</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.3.8.</span> <span class="nav-text">其他类型</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#percolator"><span class="nav-number">1.3.8.1.</span> <span class="nav-text">percolator</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Arrays"><span class="nav-number">1.3.9.</span> <span class="nav-text">Arrays</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%83%E6%95%B0%E6%8D%AE%E5%AD%97%E6%AE%B5"><span class="nav-number">1.4.</span> <span class="nav-text">元数据字段</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BA%AB%E4%BB%BD%E5%85%83%E6%95%B0%E6%8D%AE"><span class="nav-number">1.4.1.</span> <span class="nav-text">身份元数据</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#index"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">_index</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#type"><span class="nav-number">1.4.1.2.</span> <span class="nav-text">_type</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#id"><span class="nav-number">1.4.1.3.</span> <span class="nav-text">_id</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%87%E6%A1%A3%E6%BA%90%E5%85%83%E6%95%B0%E6%8D%AE"><span class="nav-number">1.4.2.</span> <span class="nav-text">文档源元数据</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#source"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">_source</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%A6%81%E7%94%A8source%E5%AD%97%E6%AE%B5"><span class="nav-number">1.4.2.1.1.</span> <span class="nav-text">禁用source字段</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#include-exclude"><span class="nav-number">1.4.2.1.2.</span> <span class="nav-text">include&#x2F;exclude</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E5%85%83%E6%95%B0%E6%8D%AE"><span class="nav-number">1.4.3.</span> <span class="nav-text">索引元数据</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#field-names"><span class="nav-number">1.4.3.1.</span> <span class="nav-text">_field_names</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ignored"><span class="nav-number">1.4.3.2.</span> <span class="nav-text">_ignored</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E5%85%83%E6%95%B0%E6%8D%AE"><span class="nav-number">1.4.4.</span> <span class="nav-text">路由元数据</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#routing"><span class="nav-number">1.4.4.1.</span> <span class="nav-text">_routing</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E5%88%B0%E7%B4%A2%E5%BC%95%E5%88%86%E5%8C%BA"><span class="nav-number">1.4.4.1.1.</span> <span class="nav-text">路由到索引分区</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B6%E5%AE%83%E5%85%83%E6%95%B0%E6%8D%AE"><span class="nav-number">1.4.5.</span> <span class="nav-text">其它元数据</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#meta"><span class="nav-number">1.4.5.1.</span> <span class="nav-text">_meta</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%98%A0%E5%B0%84%E5%8F%82%E6%95%B0"><span class="nav-number">1.5.</span> <span class="nav-text">映射参数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#analyzer"><span class="nav-number">1.5.1.</span> <span class="nav-text">analyzer</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#boost"><span class="nav-number">1.5.2.</span> <span class="nav-text">boost</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#coerce"><span class="nav-number">1.5.3.</span> <span class="nav-text">coerce</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#copy-to"><span class="nav-number">1.5.4.</span> <span class="nav-text">copy_to</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#doc-values"><span class="nav-number">1.5.5.</span> <span class="nav-text">doc_values</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#dynamic"><span class="nav-number">1.5.6.</span> <span class="nav-text">dynamic</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#eager-global-ordinals"><span class="nav-number">1.5.7.</span> <span class="nav-text">eager_global_ordinals</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#enabled"><span class="nav-number">1.5.8.</span> <span class="nav-text">enabled</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#format"><span class="nav-number">1.5.9.</span> <span class="nav-text">format</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ignore-above"><span class="nav-number">1.5.10.</span> <span class="nav-text">ignore_above</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ignore-malformed"><span class="nav-number">1.5.11.</span> <span class="nav-text">ignore_malformed</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#index-1"><span class="nav-number">1.5.12.</span> <span class="nav-text">index</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#index-options"><span class="nav-number">1.5.13.</span> <span class="nav-text">index_options</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#index-phrases"><span class="nav-number">1.5.14.</span> <span class="nav-text">index_phrases</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#index-prefixes"><span class="nav-number">1.5.15.</span> <span class="nav-text">index_prefixes</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#meta-1"><span class="nav-number">1.5.16.</span> <span class="nav-text">meta</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#fields"><span class="nav-number">1.5.17.</span> <span class="nav-text">fields</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#normalizer"><span class="nav-number">1.5.18.</span> <span class="nav-text">normalizer</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#norms"><span class="nav-number">1.5.19.</span> <span class="nav-text">norms</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#null-value"><span class="nav-number">1.5.20.</span> <span class="nav-text">null_value</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#position-increment-gap"><span class="nav-number">1.5.21.</span> <span class="nav-text">position_increment_gap</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#properties"><span class="nav-number">1.5.22.</span> <span class="nav-text">properties</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#search-analyzer"><span class="nav-number">1.5.23.</span> <span class="nav-text">search_analyzer</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#similarity"><span class="nav-number">1.5.24.</span> <span class="nav-text">similarity</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#store"><span class="nav-number">1.5.25.</span> <span class="nav-text">store</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#term-vector"><span class="nav-number">1.5.26.</span> <span class="nav-text">term_vector</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#text-analysis"><span class="nav-number">2.</span> <span class="nav-text">text analysis</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E6%96%87%E6%9C%AC%E5%88%86%E6%9E%90"><span class="nav-number">2.1.</span> <span class="nav-text">测试文本分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%88%86%E6%9E%90"><span class="nav-number">2.2.</span> <span class="nav-text">配置分析</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">maoeryu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">221</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">50</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://maoeryu.github.io/2021/12/02/elasticsearch-mapping%20&%20text%20analysis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="maoeryu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FlyingPig">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          elasticsearch-mapping & text analysis
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-12-02 00:00:00" itemprop="dateCreated datePublished" datetime="2021-12-02T00:00:00+08:00">2021-12-02</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-07-26 10:50:46" itemprop="dateModified" datetime="2022-07-26T10:50:46+08:00">2022-07-26</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>elasticsearch mapping/text analysis.<br>elasticsearch7版本以上不再接受默认映射类型.<br>elasticsearch版本7.10</p>
<span id="more"></span>

<h2 id="mapping"><a href="#mapping" class="headerlink" title="mapping"></a>mapping</h2><p>定义文档及其包含的字段如何存储和索引的过程.每个文档都是字段的集合,每个字段都有自己的数据类型.<br>使用动态映射(dynamic)和显式映射(explicit)来定义您的数据.</p>
<blockquote>
<p>防止映射爆炸设置</p>
<p>在索引中定义太多字段会导致映射爆炸,从而导致内存不足错误和难以恢复的情况.<br>考虑插入的每个新文档都会引入新字段的情况,例如使用动态映射,每个新字段都会添加到索引映射中,随着映射的增长,这可能会成为一个问题.<br>使用以下设置来限制字段映射的数量(手动或动态创建)并防止文档导致映射爆炸.</p>
</blockquote>
<p><code>index.mapping.total_fields.limit</code><br>索引中的最大字段数.<br>字段和对象映射以及字段别名计入此限制.<br>默认值为1000.</p>
<p><code>indices.query.bool.max_clause_count</code><br>限制查询中布尔子句的最大数量.</p>
<p><code>index.mapping.depth.limit</code><br>字段的最大深度,以内部对象的数量来衡量.<br>例如,如果所有字段都在根对象级别定义,则深度为1.<br>如果有一个对象映射,则深度为2等.<br>默认为20.</p>
<p><code>index.mapping.nested_fields.limit</code><br>nested索引中不同映射的最大数量.<br>该nested类型只应在特殊情况下使用,当需要相互独立地查询对象数组时.<br>为了防止设计不佳的映射,此设置限制了nested每个索引的唯一类型的数量.<br>默认为50.</p>
<p><code>index.mapping.nested_objects.limit</code><br>单个文档可以包含的所有nested类型的嵌套JSON对象的最大数量.<br>当文档包含太多嵌套对象时,此限制有助于防止出现内存不足错误.<br>默认为10000.</p>
<p><code>index.mapping.field_name_length.limit</code><br>设置字段名称的最大长度.<br>此设置并不是真正解决映射爆炸的问题,但如果想限制字段长度,它可能仍然有用,通常不需要设置此设置.<br>除非开始添加大量名称非常长的字段,否则默认值是可以的.<br>默认为Long.MAX_VALUE(无限制).</p>
<h3 id="动态映射"><a href="#动态映射" class="headerlink" title="动态映射"></a>动态映射</h3><p>自动添加新字段,只需索引文档即可.使用动态模板来定义根据匹配条件应用于动态添加的字段的自定义映射.</p>
<h4 id="动态字段映射"><a href="#动态字段映射" class="headerlink" title="动态字段映射"></a>动态字段映射</h4><p>可以将<code>dynamic</code>设置为false(忽略新字段)/strict(在遇到未知字段时抛出异常),默认开启动态字段映射.<br>以下为elasticsearch动态检测的字段数据类型,其他类型需显式映射.</p>
<table>
<thead>
<tr>
<th align="left">JSON数据类型</th>
<th align="left">&quot;dynamic&quot;:&quot;true&quot;</th>
<th align="left">&quot;dynamic&quot;:&quot;runtime&quot;</th>
</tr>
</thead>
<tbody><tr>
<td align="left">null</td>
<td align="left">未添加字段</td>
<td align="left">未添加字段</td>
</tr>
<tr>
<td align="left">true/false</td>
<td align="left">boolean</td>
<td align="left">boolean</td>
</tr>
<tr>
<td align="left">double</td>
<td align="left">float</td>
<td align="left">double</td>
</tr>
<tr>
<td align="left">integer</td>
<td align="left">long</td>
<td align="left">long</td>
</tr>
<tr>
<td align="left">object</td>
<td align="left">object</td>
<td align="left">No field added</td>
</tr>
<tr>
<td align="left">array</td>
<td align="left">取决于null数组中的第一个非值</td>
<td align="left">取决于null数组中的第一个非值</td>
</tr>
<tr>
<td align="left">string通过date检测</td>
<td align="left">date</td>
<td align="left">date</td>
</tr>
<tr>
<td align="left">string通过numeric检测</td>
<td align="left">float/long</td>
<td align="left">double/long</td>
</tr>
<tr>
<td align="left">string未通过date/numeric检测</td>
<td align="left">text带有.keyword子字段</td>
<td align="left">keyword</td>
</tr>
</tbody></table>
<h5 id="日期检测"><a href="#日期检测" class="headerlink" title="日期检测"></a>日期检测</h5><p>如果<code>date_detection</code>为启用(默认),则检查新的字符串字段以查看其内容是否与<code>dynamic_date_formats</code>中指定的任何日期模式匹配.<br><code>dynamic_date_formats</code>默认值为<code>[ &quot;strict_date_optional_time&quot;,&quot;yyyy/MM/dd HH:mm:ss Z||yyyy/MM/dd Z&quot; ]</code>.</p>
<blockquote>
<p>example</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;create_date&quot;</span>: <span class="string">&quot;2015/09/02&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_mapping?pretty&quot;</span><br></pre></td></tr></table></figure>

<p>响应,<code>create_date</code>字段已映射为date类型字段.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;my-index-000001&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;properties&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;create_date&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;date&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;format&quot;</span> : <span class="string">&quot;yyyy/MM/dd HH:mm:ss||yyyy/MM/dd||epoch_millis&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="禁用日期检测"><a href="#禁用日期检测" class="headerlink" title="禁用日期检测"></a>禁用日期检测</h5><p>设置<code>date_detection</code>为false.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;date_detection&quot;</span>: <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>重新put数据后,查看映射,字段已被映射为text数据类型.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;my-index-000001&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;date_detection&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">&quot;properties&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;create_date&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;fields&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;keyword&quot;</span> : &#123;</span><br><span class="line">              <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;ignore_above&quot;</span> : <span class="number">256</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="自定义日期格式"><a href="#自定义日期格式" class="headerlink" title="自定义日期格式"></a>自定义日期格式</h5><p><code>dynamic_date_formats</code>可以自定义以支持日期格式.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;dynamic_date_formats&quot;</span>: [<span class="string">&quot;MM/dd/yyyy&quot;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;create_date&quot;</span>: <span class="string">&quot;09/25/2015&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;my-index-000001&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;dynamic_date_formats&quot;</span> : [</span><br><span class="line">        <span class="string">&quot;MM/dd/yyyy&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;properties&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;create_date&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;date&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;format&quot;</span> : <span class="string">&quot;MM/dd/yyyy&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="数值检测"><a href="#数值检测" class="headerlink" title="数值检测"></a>数值检测</h5><p>虽然JSON支持原生浮点和整数数据类型,但某些应用程序或语言有时可能会将数字呈现为字符串.<br>通常正确的解决方案是显式映射这些字段,但可以启用数字检测(<code>默认情况下禁用</code>)以自动执行此操作.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;numeric_detection&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;my_float&quot;</span>:   <span class="string">&quot;1.0&quot;</span>, </span><br><span class="line">  <span class="attr">&quot;my_integer&quot;</span>: <span class="string">&quot;1&quot;</span> </span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>如果不启用,则映射为<code>text</code>数据类型.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;my-index-000001&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;numeric_detection&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">&quot;properties&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;my_float&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;float&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;my_integer&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;long&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="动态模板"><a href="#动态模板" class="headerlink" title="动态模板"></a>动态模板</h4><p>动态模板允许在默认动态字段映射规则之外更好地控制映射数据.<br>使用动态模板来定义自定义映射,这些映射可以根据以下匹配条件应用于动态添加的字段.<br>1.<code>match_mapping_type</code>,对检测到的数据类型进行操作.<br>2.<code>match/ unmatch/match_pattern</code>,使用模式匹配字段名称.<br>3.<code>path_match/path_unmatch</code>,该字段的完整路径.<br>4.如果动态模板未定义以上,则不匹配任何字段.</p>
<p>模板名称可以是任何字符串,匹配条件包括以上,mapping是具体映射.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&quot;dynamic_templates&quot;: [</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;my_template_name&quot;: &#123; </span><br><span class="line">      ... match conditions ... </span><br><span class="line">      &quot;mapping&quot;: &#123; ... &#125; </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>模板按顺序应用,通过更新mapping设置新的动态模板.</p>
<h5 id="match-mapping-type"><a href="#match-mapping-type" class="headerlink" title="match_mapping_type"></a>match_mapping_type</h5><p>由JSON解析器检测到的数据类型,因为JSON不区分long/integer/double/float,所以它总是选择更广泛的数据类型(long整数和double浮点数).<br>使用通配符<code>*</code>匹配所有数据类型.</p>
<p>将所有整数字段映射为integer而不是long,并且所有string字段都映射为text/keyword,则可以使用以下模板,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;dynamic_templates&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;integers&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;match_mapping_type&quot;</span>: <span class="string">&quot;long&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;mapping&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;integer&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;strings&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;match_mapping_type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;mapping&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;fields&quot;</span>: &#123;</span><br><span class="line">              <span class="attr">&quot;raw&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;type&quot;</span>:  <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;ignore_above&quot;</span>: <span class="number">256</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;my_integer&quot;</span>: <span class="number">5</span>, </span><br><span class="line">  <span class="attr">&quot;my_string&quot;</span>: <span class="string">&quot;Some string&quot;</span> </span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>my_integer字段被映射为integer,my_string字段被映射为text/keyword.</p>
<h5 id="match-unmatch"><a href="#match-unmatch" class="headerlink" title="match/unmatch"></a>match/unmatch</h5><p>match参数使用模式匹配字段名称,unmatch使用模式排除匹配的字段.</p>
<p>以下示例匹配所有string字段(名称以long_开头,排除以_text结尾),并将它们映射为long字段,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;dynamic_templates&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;longs_as_strings&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;match_mapping_type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;match&quot;</span>:   <span class="string">&quot;long_*&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;unmatch&quot;</span>: <span class="string">&quot;*_text&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;mapping&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;long_num&quot;</span>: <span class="string">&quot;5&quot;</span>, </span><br><span class="line">  <span class="attr">&quot;long_text&quot;</span>: <span class="string">&quot;foo&quot;</span> </span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line"></span><br><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_mapping?pretty&quot;</span><br></pre></td></tr></table></figure>

<p>long_num字段被映射为long,long_text字段使用默认string映射.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;my-index-000001&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;dynamic_templates&quot;</span> : [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;longs_as_strings&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;match&quot;</span> : <span class="string">&quot;long_*&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;unmatch&quot;</span> : <span class="string">&quot;*_text&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;match_mapping_type&quot;</span> : <span class="string">&quot;string&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;mapping&quot;</span> : &#123;</span><br><span class="line">              <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;long&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;properties&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;long_num&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;long&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;long_text&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;fields&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;keyword&quot;</span> : &#123;</span><br><span class="line">              <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;ignore_above&quot;</span> : <span class="number">256</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="match-pattern"><a href="#match-pattern" class="headerlink" title="match_pattern"></a>match_pattern</h5><p>match_pattern参数,match以支持完整的Java正则表达式匹配字段名称而不是简单的通配符.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;match_pattern&quot;: &quot;regex&quot;,</span><br><span class="line">&quot;match&quot;: &quot;^profit_\d+$&quot;</span><br></pre></td></tr></table></figure>

<h5 id="path-match-path-unmatch"><a href="#path-match-path-unmatch" class="headerlink" title="path_match/path_unmatch"></a>path_match/path_unmatch</h5><p>本示例将name对象中任何字段的值复制到顶级full_name字段(middle字段除外).</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;dynamic_templates&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;full_name&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;path_match&quot;</span>: <span class="string">&quot;name.*&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;path_unmatch&quot;</span>: <span class="string">&quot;*.middle&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;mapping&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;copy_to&quot;</span>: <span class="string">&quot;full_name&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;first&quot;</span>:  <span class="string">&quot;John&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;middle&quot;</span>: <span class="string">&quot;Winston&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;last&quot;</span>:   <span class="string">&quot;Lennon&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;my-index-000001&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;dynamic_templates&quot;</span> : [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;full_name&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;path_match&quot;</span> : <span class="string">&quot;name.*&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;path_unmatch&quot;</span> : <span class="string">&quot;*.middle&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;mapping&quot;</span> : &#123;</span><br><span class="line">              <span class="attr">&quot;copy_to&quot;</span> : <span class="string">&quot;full_name&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;properties&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;full_name&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;fields&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;keyword&quot;</span> : &#123;</span><br><span class="line">              <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;ignore_above&quot;</span> : <span class="number">256</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;properties&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;first&quot;</span> : &#123;</span><br><span class="line">              <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;copy_to&quot;</span> : [</span><br><span class="line">                <span class="string">&quot;full_name&quot;</span></span><br><span class="line">              ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;last&quot;</span> : &#123;</span><br><span class="line">              <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;copy_to&quot;</span> : [</span><br><span class="line">                <span class="string">&quot;full_name&quot;</span></span><br><span class="line">              ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;middle&quot;</span> : &#123;</span><br><span class="line">              <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;fields&quot;</span> : &#123;</span><br><span class="line">                <span class="attr">&quot;keyword&quot;</span> : &#123;</span><br><span class="line">                  <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">                  <span class="attr">&quot;ignore_above&quot;</span> : <span class="number">256</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>除了叶字段之外,path_match/path_unmatch参数还匹配对象路径.<br>例如,索引以下文档将导致错误,因为该path_match设置还匹配对象字段<code>name.title</code>,该字段无法映射为文本,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/2?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;first&quot;</span>:  <span class="string">&quot;Paul&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;last&quot;</span>:   <span class="string">&quot;McCartney&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;title&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;value&quot;</span>: <span class="string">&quot;Sir&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;category&quot;</span>: <span class="string">&quot;order of chivalry&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="模板变量"><a href="#模板变量" class="headerlink" title="模板变量"></a>模板变量</h5><p><code>&#123;name&#125;/&#123;dynamic_type&#125;</code>占位符被替换为在mapping 与字段名称和检测到的动态类型.<br>以下示例将所有字符串字段设置为使用analyzer与该字段同名的字段,并禁用doc_values所有非字符串字段,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;dynamic_templates&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;named_analyzers&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;match_mapping_type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;match&quot;</span>: <span class="string">&quot;*&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;mapping&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;&#123;name&#125;&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;no_doc_values&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;match_mapping_type&quot;</span>:<span class="string">&quot;*&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;mapping&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;&#123;dynamic_type&#125;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;doc_values&quot;</span>: <span class="literal">false</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;english&quot;</span>: <span class="string">&quot;Some English text&quot;</span>, </span><br><span class="line">  <span class="attr">&quot;count&quot;</span>:   <span class="number">5</span> </span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line"></span><br><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_mapping?pretty&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;my-index-000001&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;dynamic_templates&quot;</span> : [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;named_analyzers&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;match&quot;</span> : <span class="string">&quot;*&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;match_mapping_type&quot;</span> : <span class="string">&quot;string&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;mapping&quot;</span> : &#123;</span><br><span class="line">              <span class="attr">&quot;analyzer&quot;</span> : <span class="string">&quot;&#123;name&#125;&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;no_doc_values&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;match_mapping_type&quot;</span> : <span class="string">&quot;*&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;mapping&quot;</span> : &#123;</span><br><span class="line">              <span class="attr">&quot;doc_values&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">              <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;&#123;dynamic_type&#125;&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;properties&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;count&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;long&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;doc_values&quot;</span> : <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;english&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;analyzer&quot;</span> : <span class="string">&quot;english&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="动态模板示例"><a href="#动态模板示例" class="headerlink" title="动态模板示例"></a>动态模板示例</h5><h6 id="结构化搜索"><a href="#结构化搜索" class="headerlink" title="结构化搜索"></a>结构化搜索</h6><p>当设置<code>&quot;dynamic&quot;:&quot;true&quot;</code>,Elasticsearch会将字符串字段映射为text带有keyword子字段的字段.<br>如果只对结构化内容进行索引而不对全文搜索感兴趣,可以让Elasticsearch将字段仅映射为keyword字段.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;dynamic_templates&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;strings_as_keywords&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;match_mapping_type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;mapping&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h6 id="text-仅字符串映射"><a href="#text-仅字符串映射" class="headerlink" title="text-仅字符串映射"></a>text-仅字符串映射</h6><p>与前面的示例相反,如果只关心字符串字段的全文搜索并且不打算运行聚合/排序或精确搜索,可以将字符串映射为text.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;dynamic_templates&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;strings_as_text&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;match_mapping_type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;mapping&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h6 id="禁用norms"><a href="#禁用norms" class="headerlink" title="禁用norms"></a>禁用norms</h6><p>norms是索引时间评分因素,如果不关心评分(例如从不按评分对文档进行排序),可以禁用索引中这些评分因素的存储并节省一些空间.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;dynamic_templates&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;strings_as_keywords&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;match_mapping_type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;mapping&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;norms&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;fields&quot;</span>: &#123;</span><br><span class="line">              <span class="attr">&quot;keyword&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;ignore_above&quot;</span>: <span class="number">256</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h6 id="时间序列"><a href="#时间序列" class="headerlink" title="时间序列"></a>时间序列</h6><p>使用Elasticsearch进行时间序列分析时,通常会有许多数字字段,经常会根据这些字段进行聚合但从不进行过滤.<br>在这种情况下,可以禁用对这些字段的索引以节省磁盘空间,并且还可以获得一些索引速度.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;dynamic_templates&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;unindexed_longs&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;match_mapping_type&quot;</span>: <span class="string">&quot;long&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;mapping&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;index&quot;</span>: <span class="literal">false</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;unindexed_doubles&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;match_mapping_type&quot;</span>: <span class="string">&quot;double&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;mapping&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;float&quot;</span>, </span><br><span class="line">            <span class="attr">&quot;index&quot;</span>: <span class="literal">false</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="显式映射"><a href="#显式映射" class="headerlink" title="显式映射"></a>显式映射</h3><p>精确选择如何定义映射.</p>
<h4 id="使用显式映射创建索引"><a href="#使用显式映射创建索引" class="headerlink" title="使用显式映射创建索引"></a>使用显式映射创建索引</h4><p>使用create index API显式映射创建新索引.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;age&quot;</span>:    &#123; <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;integer&quot;</span> &#125;,  </span><br><span class="line">      <span class="attr">&quot;email&quot;</span>:  &#123; <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span>  &#125;, </span><br><span class="line">      <span class="attr">&quot;name&quot;</span>:   &#123; <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>  &#125;     </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line"></span><br><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_mapping?pretty&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;my-index-000001&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;properties&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;age&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;integer&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;email&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="添加新字段"><a href="#添加新字段" class="headerlink" title="添加新字段"></a>添加新字段</h4><p>使用put mapping API向现有索引添加一个或多个新字段.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_mapping?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;employee-id&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;index&quot;</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line"></span><br><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_mapping?pretty&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;my-index-000001&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;properties&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;age&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;integer&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;email&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;employee-id&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;index&quot;</span> : <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="更新字段映射"><a href="#更新字段映射" class="headerlink" title="更新字段映射"></a>更新字段映射</h4><p>除了支持的映射参数之外,无法更改现有字段的映射/字段类型(会使已编入索引的数据无效).<br>如需更改其他索引的字段的映射,创建具有正确映射一个新的索引和重新索引的数据转换.</p>
<p>重命名字段会使已在旧字段名称下索引的数据无效.相反,添加一个alias字段以创建备用字段名称.</p>
<h5 id="查看索引映射"><a href="#查看索引映射" class="headerlink" title="查看索引映射"></a>查看索引映射</h5><p>使用get mapping API查看现有索引的映射.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_mapping?pretty&quot;</span><br></pre></td></tr></table></figure>

<h5 id="查看特定字段映射"><a href="#查看特定字段映射" class="headerlink" title="查看特定字段映射"></a>查看特定字段映射</h5><p>如果只想查看一个或多个特定字段的映射,可以使用get field mapping API,如果不需要索引的完整映射或索引包含大量字段,这将非常有用.<br>以下请求检索employee-id字段的映射,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_mapping/field/employee-id?pretty&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;my-index-000001&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;employee-id&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;full_name&quot;</span> : <span class="string">&quot;employee-id&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;mapping&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;employee-id&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;index&quot;</span> : <span class="literal">false</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="字段数据类型"><a href="#字段数据类型" class="headerlink" title="字段数据类型"></a>字段数据类型</h3><p>每个字段都有一个字段数据类型或字段类型,此类型指示字段包含的数据类型(例如字符串或布尔值)及其预期用途.<br>例如,可以将字符串索引到text和keyword字段,<code>text字段值被分析用于全文搜索,而keyword字符串则保持原样用于过滤和排序</code>.</p>
<h4 id="常见类型"><a href="#常见类型" class="headerlink" title="常见类型"></a>常见类型</h4><h5 id="binary"><a href="#binary" class="headerlink" title="binary"></a>binary</h5><p>编码为Base64字符串的二进制值,该字段默认不存储且不可搜索.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;blob&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;binary&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Some binary blob&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;blob&quot;</span>: <span class="string">&quot;U29tZSBiaW5hcnkgYmxvYg==&quot;</span> </span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p><code>doc_values</code><br>该字段是否应该以列步长方式存储在磁盘上,以便以后可以用于排序/聚合/脚本编写,默认false.</p>
<p><code>store</code><br>字段值是否应与<code>_source</code>字段分开存储和检索,默认false.</p>
<h5 id="boolean"><a href="#boolean" class="headerlink" title="boolean"></a>boolean</h5><p>接受以下表示法,<br><code>false, &quot;false&quot;, &quot;&quot; (empty string)</code><br><code>true, &quot;true&quot;</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;is_published&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;boolean&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X POST &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;is_published&quot;</span>: <span class="string">&quot;true&quot;</span> </span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;term&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;is_published&quot;</span>: <span class="literal">true</span> </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>在脚本中使用的布尔字段,返回1和0.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">POST my-index-000001/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;is_published&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST my-index-000001/_doc/2</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;is_published&quot;</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET my-index-000001/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;publish_state&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;terms&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;is_published&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;script_fields&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;is_published&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;script&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;lang&quot;</span>: <span class="string">&quot;painless&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;source&quot;</span>: <span class="string">&quot;doc[&#x27;is_published&#x27;].value&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>响应,</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;took&quot;</span> : <span class="number">976</span>,</span><br><span class="line">  <span class="attr">&quot;timed_out&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;total&quot;</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;skipped&quot;</span> : <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> : <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;hits&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;total&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;value&quot;</span> : <span class="number">2</span>,</span><br><span class="line">      <span class="attr">&quot;relation&quot;</span> : <span class="string">&quot;eq&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;max_score&quot;</span> : <span class="number">1.0</span>,</span><br><span class="line">    <span class="attr">&quot;hits&quot;</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;_index&quot;</span> : <span class="string">&quot;my-index-000001&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_type&quot;</span> : <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_id&quot;</span> : <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_score&quot;</span> : <span class="number">1.0</span>,</span><br><span class="line">        <span class="attr">&quot;fields&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;is_published&quot;</span> : [</span><br><span class="line">            <span class="literal">true</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;_index&quot;</span> : <span class="string">&quot;my-index-000001&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_type&quot;</span> : <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_id&quot;</span> : <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_score&quot;</span> : <span class="number">1.0</span>,</span><br><span class="line">        <span class="attr">&quot;fields&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;is_published&quot;</span> : [</span><br><span class="line">            <span class="literal">false</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;aggregations&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;publish_state&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;doc_count_error_upper_bound&quot;</span> : <span class="number">0</span>,</span><br><span class="line">      <span class="attr">&quot;sum_other_doc_count&quot;</span> : <span class="number">0</span>,</span><br><span class="line">      <span class="attr">&quot;buckets&quot;</span> : [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;key&quot;</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">&quot;key_as_string&quot;</span> : <span class="string">&quot;false&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;doc_count&quot;</span> : <span class="number">1</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;key&quot;</span> : <span class="number">1</span>,</span><br><span class="line">          <span class="attr">&quot;key_as_string&quot;</span> : <span class="string">&quot;true&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;doc_count&quot;</span> : <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>boost</code><br>映射字段级查询时间提升,接受浮点数,默认为1.0.</p>
<p><code>doc_values</code><br>该字段是否应该以列步长方式存储在磁盘上,以便以后可以用于排序/聚合/脚本编写,默认true.</p>
<p><code>index</code><br>该字段应该是可搜索,默认true.</p>
<p><code>null_value</code><br>接受上面列出的任何真值或假值.该值将替换任何显式null值.默认为null,这意味着该字段被视为缺失.</p>
<p><code>store</code><br>字段值是否应与<code>_source</code>字段分开存储和检索,默认false.</p>
<p><code>meta</code><br>有关该字段的元数据.</p>
<h5 id="Keywords"><a href="#Keywords" class="headerlink" title="Keywords"></a>Keywords</h5><p>关键字族包括以下字段类型,<br>1.<code>keyword</code>,用于结构化内容,例如ID/电子邮件地址/主机名/状态代码/邮政编码/标签.<br>2.<code>constant_keyword</code>,对于始终包含相同值的关键字字段.<br>3.<code>wildcard</code>,为类似grep的通配符查询优化了日志行和类似的关键字值.<br>关键字字段通常用于排序/聚合/术语级别的查询,例如term,<code>避免使用关键字字段进行全文搜索,请改用text字段类型</code>.</p>
<p><code>boost</code><br><code>doc_values</code><br><code>eager_global_ordinals</code><br><code>fields</code><br>多字段允许为不同目的以多种方式索引相同的字符串值,例如一个字段用于搜索,一个多字段用于排序和聚合.</p>
<p><code>ignore_above</code><br><code>index</code><br><code>index_options</code><br><code>norms</code><br><code>null_value</code><br><code>store</code><br><code>similarity</code><br><code>normalizer</code><br>如何在索引之前预处理关键字.默认为null,这意味着关键字保持原样.</p>
<p><code>split_queries_on_whitespace</code><br>在为此字段构建查询时,全文查询是否应在空格上拆分输入,默认false.</p>
<p><code>meta</code></p>
<h6 id="constant-keyword"><a href="#constant-keyword" class="headerlink" title="constant_keyword"></a>constant_keyword</h6><p>常量关键字是该keyword字段的特化,用于索引中所有文档具有相同值的情况,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/logs-debug?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;@timestamp&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;date&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;message&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;level&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;constant_keyword&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;value&quot;</span>: <span class="string">&quot;debug&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>允许提交没有字段值或值等于映射中配置的值的文档,不允许提供与映射中配置的值不同的值,以下两个索引请求是等效的,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST &quot;localhost:9200/logs-debug/_doc?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;date&quot;</span>: <span class="string">&quot;2019-12-12&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;Starting up Elasticsearch&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;level&quot;</span>: <span class="string">&quot;debug&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X POST &quot;localhost:9200/logs-debug/_doc?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;date&quot;</span>: <span class="string">&quot;2019-12-12&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;Starting up Elasticsearch&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p><code>meta</code><br><code>value</code></p>
<h6 id="wildcard"><a href="#wildcard" class="headerlink" title="wildcard"></a>wildcard</h6><p>wildcard字段像关键字字段一样未标记化,因此不支持依赖词位置的查询,例如短语查询.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;my_wildcard&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;wildcard&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;my_wildcard&quot;</span> : <span class="string">&quot;This string can be quite lengthy&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;wildcard&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;my_wildcard&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;value&quot;</span>: <span class="string">&quot;*quite*lengthy&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p><code>null_value</code><br><code>ignore_above</code></p>
<h5 id="Numbers"><a href="#Numbers" class="headerlink" title="Numbers"></a>Numbers</h5><p>long(64)/integer(32)/short(16)/byte(8)/double/float/half_float/scaled_float/unsigned_long.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;number_of_bytes&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;integer&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;time_in_seconds&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;float&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;price&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;scaled_float&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;scaling_factor&quot;</span>: <span class="number">100</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p><code>coerce</code><br><code>boost</code><br><code>doc_values</code><br><code>ignore_malformed</code><br><code>index</code><br><code>null_value</code><br><code>store</code><br><code>meta</code></p>
<h5 id="Unsigned-long"><a href="#Unsigned-long" class="headerlink" title="Unsigned long"></a>Unsigned long</h5><h5 id="Dates"><a href="#Dates" class="headerlink" title="Dates"></a>Dates</h5><h6 id="date"><a href="#date" class="headerlink" title="date"></a>date</h6><p>JSON没有日期数据类型,因此Elasticsearch中的日期可以是,<br>1.包含格式化日期的字符串,例如&quot;2015-01-01&quot;或&quot;2015/01/01 12:10:30&quot;.<br>2.一个很长的数字,表示自纪元以来的毫秒数.<br>3.一个整数,表示自纪元以来的秒数.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;date&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;date&quot;</span> </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123; <span class="attr">&quot;date&quot;</span>: <span class="string">&quot;2015-01-01&quot;</span> &#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/2?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123; <span class="attr">&quot;date&quot;</span>: <span class="string">&quot;2015-01-01T12:10:30Z&quot;</span> &#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/3?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123; <span class="attr">&quot;date&quot;</span>: <span class="number">1420070400001</span> &#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;sort&quot;</span>: &#123; <span class="attr">&quot;date&quot;</span>: <span class="string">&quot;asc&quot;</span>&#125; </span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>响应,sort返回的值都是以毫秒为单位的.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;took&quot;</span> : <span class="number">11</span>,</span><br><span class="line">  <span class="attr">&quot;timed_out&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;total&quot;</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;skipped&quot;</span> : <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> : <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;hits&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;total&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;value&quot;</span> : <span class="number">3</span>,</span><br><span class="line">      <span class="attr">&quot;relation&quot;</span> : <span class="string">&quot;eq&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;max_score&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;hits&quot;</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;_index&quot;</span> : <span class="string">&quot;my-index-000001&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_type&quot;</span> : <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_id&quot;</span> : <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_score&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;_source&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;date&quot;</span> : <span class="string">&quot;2015-01-01&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;sort&quot;</span> : [</span><br><span class="line">          <span class="number">1420070400000</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;_index&quot;</span> : <span class="string">&quot;my-index-000001&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_type&quot;</span> : <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_id&quot;</span> : <span class="string">&quot;3&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_score&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;_source&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;date&quot;</span> : <span class="number">1420070400001</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;sort&quot;</span> : [</span><br><span class="line">          <span class="number">1420070400001</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;_index&quot;</span> : <span class="string">&quot;my-index-000001&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_type&quot;</span> : <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_id&quot;</span> : <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_score&quot;</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;_source&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;date&quot;</span> : <span class="string">&quot;2015-01-01T12:10:30Z&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;sort&quot;</span> : [</span><br><span class="line">          <span class="number">1420114230000</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>多种日期格式</p>
<p>可以通过||使用分隔符将它们分开来指定多种格式.<br>将依次尝试每种格式,直到找到匹配的格式.<br>第一种格式将用于将自纪元以来的毫秒值转换回字符串.</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;date&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>:   <span class="string">&quot;date&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;format&quot;</span>: <span class="string">&quot;yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p><code>boost</code><br>映射字段级查询时间提升.接受浮点数,默认为1.0.</p>
<p><code>doc_values</code><br>该字段是否应该以列步长方式存储在磁盘上,以便以后可以用于排序/聚合/脚本编写,默认false.</p>
<p><code>format</code><br>可以解析的日期格式,默认为<code>strict_date_optional_time||epoch_millis</code>.</p>
<p><code>locale</code><br>从月份开始解析日期时使用的语言环境在所有语言中都没有相同的名称/缩写,默认是ROOT语言环境.</p>
<p><code>ignore_malformed</code><br>如果true,则忽略格式错误的数字.默认false,格式错误的数字会引发异常并拒绝整个文档.</p>
<p><code>index</code><br>该字段是否可搜索,默认true.</p>
<p><code>null_value</code><br>接受配置format中的日期值作为字段,该字段替换任何显式null值.默认为null,这意味着该字段被视为缺失.</p>
<p><code>store</code><br>字段值是否应与<code>_source</code>字段分开存储和检索,默认false.</p>
<p><code>meta</code><br>有关该字段的元数据.</p>
<h6 id="date-nanoseconds"><a href="#date-nanoseconds" class="headerlink" title="date nanoseconds"></a>date nanoseconds</h6><p>默认format,<code>strict_date_optional_time||epoch_millis</code>.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?include_type_name=true&amp;pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;_doc&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;date&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;date_nanos&quot;</span> </span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123; <span class="attr">&quot;date&quot;</span>: <span class="string">&quot;2015-01-01&quot;</span> &#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/2?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123; <span class="attr">&quot;date&quot;</span>: <span class="string">&quot;2015-01-01T12:10:30.123456789Z&quot;</span> &#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/3?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123; <span class="attr">&quot;date&quot;</span>: <span class="number">1420070400</span> &#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;sort&quot;</span>: &#123; <span class="attr">&quot;date&quot;</span>: <span class="string">&quot;asc&quot;</span>&#125; </span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;script_fields&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;my_field&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;script&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;lang&quot;</span> : <span class="string">&quot;painless&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;source&quot;</span> : <span class="string">&quot;doc[\u0027date\u0027].value.nano&quot;</span> </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;docvalue_fields&quot;</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;field&quot;</span> : <span class="string">&quot;date&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;format&quot;</span>: <span class="string">&quot;strict_date_time&quot;</span> </span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="alias"><a href="#alias" class="headerlink" title="alias"></a>alias</h5><p>为现有字段定义别名.</p>
<p><code>path</code><br>目标字段的完整路径,包括任何父对象(xxx.xxx.xxx).</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/trips?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;distance&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;route_length_miles&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;alias&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;distance&quot;</span> </span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;transit_mode&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;range&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;route_length_miles&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;gte&quot;</span> : <span class="number">39</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>在搜索请求的某些部分和请求字段功能时,可以提供字段通配符模式.在这些情况下,除了具体字段外,通配符模式还将匹配字段别名.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/trips/_field_caps?fields=route_*,transit_mode&amp;pretty&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>别名目标限制</p>
<p>目标必须是具体的字段,而不是对象或其他字段别名.<br>目标字段在创建别名时必须存在.<br>如果定义了嵌套对象,则字段别名必须与其目标具有相同的嵌套范围.<br>一个字段别名只能有一个目标,这意味着不可能使用字段别名在单个子句中查询多个目标字段.</p>
</blockquote>
<p>可以通过映射更新,更改别名以引用新目标.一个已知的限制是,如果任何存储的过滤器查询包含字段别名,它们仍将引用其原始目标.</p>
<blockquote>
<p>不支持写入字段别名</p>
<p>尝试在索引或更新请求中使用别名将导致失败.<br>同样,别名不能用作copy_to多字段的目标或在多字段中使用.因为文档源中不存在别名,所以在执行源过滤时不能使用别名.</p>
</blockquote>
<p>以下请求将返回空结果,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;_source&quot;</span>: <span class="string">&quot;route_length_miles&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="对象和关系类型"><a href="#对象和关系类型" class="headerlink" title="对象和关系类型"></a>对象和关系类型</h4><h5 id="object"><a href="#object" class="headerlink" title="object"></a>object</h5><p>一个JSON对象,JSON文档本质上是分层的:文档可能包含内部对象,而内部对象又可能包含内部对象本身.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123; </span><br><span class="line">      <span class="attr">&quot;region&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;manager&quot;</span>: &#123; </span><br><span class="line">        <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;age&quot;</span>:  &#123; <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;integer&quot;</span> &#125;,</span><br><span class="line">          <span class="attr">&quot;name&quot;</span>: &#123; </span><br><span class="line">            <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">              <span class="attr">&quot;first&quot;</span>: &#123; <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span> &#125;,</span><br><span class="line">              <span class="attr">&quot;last&quot;</span>:  &#123; <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span> &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123; </span><br><span class="line">  <span class="attr">&quot;region&quot;</span>: <span class="string">&quot;US&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;manager&quot;</span>: &#123; </span><br><span class="line">    <span class="attr">&quot;age&quot;</span>:     <span class="number">30</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: &#123; </span><br><span class="line">      <span class="attr">&quot;first&quot;</span>: <span class="string">&quot;John&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;last&quot;</span>:  <span class="string">&quot;Smith&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p><code>dynamic</code><br>是否properties应将new动态添加到现有对象中,true(默认)/false/strict.</p>
<p><code>enabled</code><br>为对象字段提供的JSON值是应该被解析和索引(true,默认),还是完全忽略(false).</p>
<p><code>properties</code><br>对象内的字段,可以是任何数据类型,包括object,可以将新属性添加到现有对象.</p>
<h5 id="flattened"><a href="#flattened" class="headerlink" title="flattened"></a>flattened</h5><p>扁平化,整个JSON对象作为单个字段值.扁平化对象字段可用于以下查询类型,<br>term, terms, 和terms_set<br>prefix<br>range<br>match 和 multi_match<br>query_string 和 simple_query_string<br>exists</p>
<p>查询时,无法使用通配符引用字段键,如<code>&#123; &quot;term&quot;: &#123;&quot;labels.time*&quot;: 1541457010&#125;&#125;</code>.<br>所有查询(包括range)都将值视为字符串关键字,flattened字段不支持突出显示.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/bug_reports?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;title&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;labels&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;flattened&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X POST &quot;localhost:9200/bug_reports/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;Results are not sorted correctly.&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;labels&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;priority&quot;</span>: <span class="string">&quot;urgent&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;release&quot;</span>: [<span class="string">&quot;v1.2.5&quot;</span>, <span class="string">&quot;v1.3.0&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;timestamp&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;created&quot;</span>: <span class="number">1541458026</span>,</span><br><span class="line">      <span class="attr">&quot;closed&quot;</span>: <span class="number">1541457010</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>在索引期间,为JSON对象中的每个叶值创建令牌.这些值被索引为字符串关键字,无需对数字或日期进行分析或特殊处理.<br>查询顶级flattened字段会搜索对象中的所有叶值.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST &quot;localhost:9200/bug_reports/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;term&quot;</span>: &#123;<span class="attr">&quot;labels&quot;</span>: <span class="string">&quot;urgent&quot;</span>&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>要查询扁平对象中的特定键,请使用对象点表示法.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST &quot;localhost:9200/bug_reports/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;term&quot;</span>: &#123;<span class="attr">&quot;labels.release&quot;</span>: <span class="string">&quot;v1.3.0&quot;</span>&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p><code>boost</code><br>映射字段级查询时间提升.接受浮点数,默认为1.0.</p>
<p><code>depth_limit</code><br>就嵌套内部对象而言,展平对象字段的最大允许深度.如果扁平对象字段超过此限制,则会引发错误.默认为20. depth_limit可以通过映射API动态更新.</p>
<p><code>doc_values</code><br>该字段是否应该以列步长方式存储在磁盘上,默认true.</p>
<p><code>eager_global_ordinals</code><br>是否应该在刷新时急切地加载全局序数,默认false.</p>
<p><code>ignore_above</code><br>超过此限制的叶值将不会被索引.默认情况下,没有限制,所有值都将被索引.此限制适用于展平对象字段内的叶值,而不是整个字段的长度.</p>
<p><code>index</code><br>确定该字段是否应可搜索,默认true.</p>
<p><code>index_options</code><br>出于评分目的,应该在索引中存储哪些信息,默认为docs但也可以设置为freqs在计算分数时考虑词频.</p>
<p><code>null_value</code><br>一个字符串值,用于替换展null平对象字段中的任何显式值,默认为null,这意味着空域被视为缺失.</p>
<p><code>similarity</code><br>应该使用哪种评分算法或相似性,默认为BM25.</p>
<p><code>split_queries_on_whitespace</code><br>在为此字段构建查询时,全文查询是否应在空格上拆分输入,默认false.</p>
<h5 id="nested"><a href="#nested" class="headerlink" title="nested"></a>nested</h5><p>一个JSON对象,保留其子字段之间的关系.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;user&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;nested&quot;</span> </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;group&quot;</span> : <span class="string">&quot;fans&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;user&quot;</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;first&quot;</span> : <span class="string">&quot;John&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;last&quot;</span> :  <span class="string">&quot;Smith&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;first&quot;</span> : <span class="string">&quot;Alice&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;last&quot;</span> :  <span class="string">&quot;White&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;nested&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;bool&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;must&quot;</span>: [</span><br><span class="line">            &#123; <span class="attr">&quot;match&quot;</span>: &#123; <span class="attr">&quot;user.first&quot;</span>: <span class="string">&quot;Alice&quot;</span> &#125;&#125;,</span><br><span class="line">            &#123; <span class="attr">&quot;match&quot;</span>: &#123; <span class="attr">&quot;user.last&quot;</span>:  <span class="string">&quot;Smith&quot;</span> &#125;&#125; </span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;nested&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;bool&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;must&quot;</span>: [</span><br><span class="line">            &#123; <span class="attr">&quot;match&quot;</span>: &#123; <span class="attr">&quot;user.first&quot;</span>: <span class="string">&quot;Alice&quot;</span> &#125;&#125;,</span><br><span class="line">            &#123; <span class="attr">&quot;match&quot;</span>: &#123; <span class="attr">&quot;user.last&quot;</span>:  <span class="string">&quot;White&quot;</span> &#125;&#125; </span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;inner_hits&quot;</span>: &#123; </span><br><span class="line">        <span class="attr">&quot;highlight&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;fields&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;user.first&quot;</span>: &#123;&#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p><code>dynamic</code><br>(可选,字符串)是否properties应将new动态添加到现有嵌套对象中,true(默认)/false/strict.</p>
<p><code>properties</code><br>(可选,对象)嵌套对象中的字段,可以是任何数据类型,包括nested.可以将新属性添加到现有的嵌套对象.</p>
<p><code>include_in_parent</code><br>(可选,布尔值)如果true,嵌套对象中的所有字段也作为标准(平面)字段添加到父文档中,默认为false.</p>
<p><code>include_in_root</code><br>(可选,布尔值)如果true,嵌套对象中的所有字段也作为标准(平面)字段添加到根文档中,默认为false.</p>
<h5 id="join"><a href="#join" class="headerlink" title="join"></a>join</h5><p>为同一索引中的文档定义父/子关系.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;my_id&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;my_join_field&quot;</span>: &#123; </span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;join&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;relations&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;question&quot;</span>: <span class="string">&quot;answer&quot;</span> </span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p><code>my_join_field</code>,字段名称.<br><code>&quot;question&quot;: &quot;answer&quot;</code>,定义单个关系,question是answer的父级.</p>
<p>索引父文档,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?refresh&amp;pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;my_id&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;This is a question&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;my_join_field&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;question&quot;</span> </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/2?refresh&amp;pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;my_id&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;This is another question&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;my_join_field&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;question&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>索引父文档简单表示法,使用关系名称,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?refresh&amp;pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;my_id&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;This is a question&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;my_join_field&quot;</span>: <span class="string">&quot;question&quot;</span> </span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/2?refresh&amp;pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;my_id&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;This is another question&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;my_join_field&quot;</span>: <span class="string">&quot;question&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>索引子项时,关系名称以及文档的父ID必须添加到<code>_source</code>.<br>需要在同一个分片中索引父文档的谱系,因此必须始终使用子文档的更大父ID路由子文档.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/3?routing=1&amp;refresh&amp;pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;my_id&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;This is an answer&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;my_join_field&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;answer&quot;</span>, </span><br><span class="line">    <span class="attr">&quot;parent&quot;</span>: <span class="string">&quot;1&quot;</span> </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/4?routing=1&amp;refresh&amp;pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;my_id&quot;</span>: <span class="string">&quot;4&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;This is another answer&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;my_join_field&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;answer&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;parent&quot;</span>: <span class="string">&quot;1&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p><code>routing</code>,路由值是强制性的,因为父文档和子文档必须在同一个分片上建立索引.<br><code>&quot;name&quot;: &quot;answer&quot;</code>,是此文档的联接名称.<br><code>&quot;parent&quot;: &quot;1&quot; </code>,此子文档的父ID.</p>
<h6 id="全局序数"><a href="#全局序数" class="headerlink" title="全局序数"></a>全局序数</h6><p>当该join字段不经常使用且写入频繁发生时,禁用预先加载.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;my_join_field&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;join&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;relations&quot;</span>: &#123;</span><br><span class="line">           <span class="attr">&quot;question&quot;</span>: <span class="string">&quot;answer&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;eager_global_ordinals&quot;</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>检查每个父关系使用的全局序数使用的堆量,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Per-index</span><br><span class="line">curl -X GET &quot;localhost:9200/_stats/fielddata?human&amp;fields=my_join_field#question&amp;pretty&quot;</span><br><span class="line"># Per-node per-index</span><br><span class="line">curl -X GET &quot;localhost:9200/_nodes/stats/indices/fielddata?human&amp;fields=my_join_field#question&amp;pretty&quot;</span><br></pre></td></tr></table></figure>

<h6 id="定义多个子级"><a href="#定义多个子级" class="headerlink" title="定义多个子级"></a>定义多个子级</h6><p>question是answer和comment的父级.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;my_join_field&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;join&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;relations&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;question&quot;</span>: [<span class="string">&quot;answer&quot;</span>, <span class="string">&quot;comment&quot;</span>]  </span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>question是answer和comment的父级,answer是vote的父级.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;my_join_field&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;join&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;relations&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;question&quot;</span>: [<span class="string">&quot;answer&quot;</span>, <span class="string">&quot;comment&quot;</span>],  </span><br><span class="line">          <span class="attr">&quot;answer&quot;</span>: <span class="string">&quot;vote&quot;</span> </span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>索引孙文档需要routing值等于祖父,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/3?routing=1&amp;refresh&amp;pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;This is a vote&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;my_join_field&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;vote&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;parent&quot;</span>: <span class="string">&quot;2&quot;</span> </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p><code>routing</code>,此子文档必须与其祖父文档和父文档位于同一分片上.<br><code>parent</code>,这个文档的父id(必须指向一个answer文档).</p>
<h4 id="结构化数据类型"><a href="#结构化数据类型" class="headerlink" title="结构化数据类型"></a>结构化数据类型</h4><h5 id="Range"><a href="#Range" class="headerlink" title="Range"></a>Range</h5><p>范围类型,例如long_range,double_range, date_range,和ip_range.</p>
<h5 id="ip"><a href="#ip" class="headerlink" title="ip"></a>ip</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;ip_addr&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;ip&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;ip_addr&quot;</span>: <span class="string">&quot;192.168.1.1&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;term&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;ip_addr&quot;</span>: <span class="string">&quot;192.168.0.0/16&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="version"><a href="#version" class="headerlink" title="version"></a>version</h5><h4 id="聚合数据类型"><a href="#聚合数据类型" class="headerlink" title="聚合数据类型"></a>聚合数据类型</h4><h5 id="histogram"><a href="#histogram" class="headerlink" title="histogram"></a>histogram</h5><p>预先聚合的数值,直方图.</p>
<h4 id="文本搜索类型"><a href="#文本搜索类型" class="headerlink" title="文本搜索类型"></a>文本搜索类型</h4><h5 id="text"><a href="#text" class="headerlink" title="text"></a>text</h5><p>用于索引全文值的字段,例如电子邮件正文或产品描述.<br>这些字段是analyzed,也就是说,它们在被索引之前通过分析器将字符串转换为单个术语列表,分析过程允许Elasticsearch在每个全文字段中搜索单个词,文本字段不用于排序,也很少用于聚合.</p>
<p>如果需要索引结构化内容,例如电子邮件地址/主机名/状态代码/标签,应该使用keyword字段.<br>有时同时拥有同一字段的全文(text)/关键字(keyword)版本很有用:一个用于全文搜索,另一个用于聚合和排序,这可以通过多字段来实现.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;full_name&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>:  <span class="string">&quot;text&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p><code>analyzer</code><br>应该在索引时和搜索时用于该字段的分析器text(除非被覆盖search_analyzer).默认为默认索引分析器,或standard分析器.</p>
<p><code>boost</code><br>映射字段级查询时间提升.接受浮点数,默认为1.0.</p>
<p><code>eager_global_ordinals</code><br>是否应该在刷新时急切地加载全局序数?接受true或false(默认).</p>
<p><code>fielddata</code><br>该字段是否可以使用内存中的字段数据进行排序/聚合/脚本编写,接受true或false(默认).</p>
<p><code>fielddata_frequency_filter</code><br>允许决定在fielddata启用时将哪些值加载到内存中的专家设置.默认情况下加载所有值.</p>
<p><code>fields</code><br>多字段允许以多种方式为不同的目的对相同的字符串值进行索引,例如一个字段用于搜索和一个多字段用于排序和聚合,或者由不同的分析器分析相同的字符串值.</p>
<p><code>index</code><br>该字段应该是可搜索的吗?接受true(默认)或false.</p>
<p><code>index_options</code><br>什么信息应该存储在索引中,用于搜索和突出显示的目的.默认为positions.</p>
<p><code>index_prefixes</code><br>如果启用,2到5个字符之间的术语前缀将被索引到一个单独的字段中.这允许前缀搜索以更大的索引为代价更有效地运行.</p>
<p><code>index_phrases</code><br>如果启用,两个词组合(shingles)将被索引到一个单独的字段中.这允许以更大的索引为代价更有效地运行精确的短语查询(无溢出).<br>请注意,这在不删除停用词时效果最佳,因为包含停用词的短语将不使用辅助字段,并且会回退到标准短语查询.接受true或false(默认).</p>
<p><code>norms</code><br>对查询进行评分时是否应考虑字段长度.接受true(默认)或false.</p>
<p><code>position_increment_gap</code><br>应该在字符串数组的每个元素之间插入的假术语位置的数量.默认为position_increment_gap分析器上配置的默认为100.100被选中是因为它可以防止具有相当大的斜率(小于100)的短语查询跨字段值匹配术语.</p>
<p><code>store</code><br>字段值是否应与_source字段分开存储和检索.接受true或false(默认).</p>
<p><code>search_analyzer</code><br>本analyzer应该在对搜索时使用text领域.默认为analyzer设置.</p>
<p><code>search_quote_analyzer</code><br>本analyzer应在搜索时遇到一个短语时使用.默认为search_analyzer设置.</p>
<p><code>similarity</code><br>应该使用哪种评分算法或相似性.默认为BM25.</p>
<p><code>term_vector</code><br>是否应为字段存储术语向量.默认为no.</p>
<p><code>meta</code><br>有关该字段的元数据.</p>
<h6 id="fielddata"><a href="#fielddata" class="headerlink" title="fielddata"></a>fielddata</h6><p>在文本字段上启用fielddata通常没有意义,大多数想要对文本字段执行更多操作的用户都使用多字段映射,其中包含text用于全文搜索的keyword字段和用于聚合的未分析字段.</p>
<p>使用该<code>my_field</code>字段进行搜索,将该<code>my_field.keyword</code>字段用于聚合/排序/在脚本中.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;my_field&quot;</span>: &#123; </span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;fields&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;keyword&quot;</span>: &#123; </span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>启用fielddata.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_mapping?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;my_field&quot;</span>: &#123; </span><br><span class="line">      <span class="attr">&quot;type&quot;</span>:     <span class="string">&quot;text&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;fielddata&quot;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="annotated-text"><a href="#annotated-text" class="headerlink" title="annotated-text"></a>annotated-text</h5><p>包含特殊标记的文本.用于识别命名实体</p>
<h5 id="completion"><a href="#completion" class="headerlink" title="completion"></a>completion</h5><p>用于自动完成建议</p>
<h5 id="search-as-you-type"><a href="#search-as-you-type" class="headerlink" title="search_as_you_type"></a>search_as_you_type</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;my_field&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;search_as_you_type&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p><code>my_field</code><br>按照映射中的配置进行分析.如果未配置分析器,则使用索引的默认分析器.</p>
<p><code>my_field._2gram</code><br>使用<code>shinglemy_field</code>大小2的shingletoken过滤器包装分析器.</p>
<p><code>my_field._3gram</code><br>使用<code>shinglemy_field</code>大小3的shingletoken过滤器包裹分析器.</p>
<p><code>my_field._index_prefix</code><br><code>my_field._3gram</code>用边缘ngram标记过滤器包装分析器.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?refresh&amp;pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;my_field&quot;</span>: <span class="string">&quot;quick brown fox jump lazy dog&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;multi_match&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;query&quot;</span>: <span class="string">&quot;brown f&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;bool_prefix&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;fields&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;my_field&quot;</span>,</span><br><span class="line">        <span class="string">&quot;my_field._2gram&quot;</span>,</span><br><span class="line">        <span class="string">&quot;my_field._3gram&quot;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match_phrase_prefix&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;my_field&quot;</span>: <span class="string">&quot;brown f&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="token-count"><a href="#token-count" class="headerlink" title="token_count"></a>token_count</h5><p>文本中标记的计数.</p>
<h4 id="文档排序类型"><a href="#文档排序类型" class="headerlink" title="文档排序类型"></a>文档排序类型</h4><h5 id="dense-vector"><a href="#dense-vector" class="headerlink" title="dense_vector"></a>dense_vector</h5><p>记录浮点值的密集向量.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;my_vector&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;dense_vector&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;dims&quot;</span>: <span class="number">3</span>  </span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;my_text&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;my_text&quot;</span> : <span class="string">&quot;text1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;my_vector&quot;</span> : [<span class="number">0.5</span>, <span class="number">10</span>, <span class="number">6</span>]</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/2?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;my_text&quot;</span> : <span class="string">&quot;text2&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;my_vector&quot;</span> : [<span class="number">-0.5</span>, <span class="number">10</span>, <span class="number">10</span>]</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="sparse-vector"><a href="#sparse-vector" class="headerlink" title="sparse_vector"></a>sparse_vector</h5><p>记录浮点值的稀疏向量.</p>
<h5 id="rank-feature"><a href="#rank-feature" class="headerlink" title="rank_feature"></a>rank_feature</h5><p>记录数字特征以在查询时提高命中率.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;pagerank&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;rank_feature&quot;</span> </span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;url_length&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;rank_feature&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;positive_score_impact&quot;</span>: <span class="literal">false</span> </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;pagerank&quot;</span>: <span class="number">8</span>,</span><br><span class="line">  <span class="attr">&quot;url_length&quot;</span>: <span class="number">22</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;rank_feature&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;pagerank&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="rank-features"><a href="#rank-features" class="headerlink" title="rank_features"></a>rank_features</h5><p>记录数字特征以在查询时提高命中率.</p>
<h4 id="空间数据类型"><a href="#空间数据类型" class="headerlink" title="空间数据类型"></a>空间数据类型</h4><h5 id="geo-point"><a href="#geo-point" class="headerlink" title="geo_point"></a>geo_point</h5><p>纬度和经度点.</p>
<h5 id="geo-shape"><a href="#geo-shape" class="headerlink" title="geo_shape"></a>geo_shape</h5><p>复杂的形状,例如多边形.</p>
<h5 id="point"><a href="#point" class="headerlink" title="point"></a>point</h5><p>任意笛卡尔点.</p>
<h5 id="shape"><a href="#shape" class="headerlink" title="shape"></a>shape</h5><p>任意笛卡尔几何.</p>
<h4 id="其他类型"><a href="#其他类型" class="headerlink" title="其他类型"></a>其他类型</h4><h5 id="percolator"><a href="#percolator" class="headerlink" title="percolator"></a>percolator</h5><p>以Query DSL编写的索引查询.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/index?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;query&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;percolator&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;body&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X POST &quot;localhost:9200/_aliases?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;actions&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;add&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;index&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;alias&quot;</span>: <span class="string">&quot;queries&quot;</span> </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/queries/_doc/1?refresh&amp;pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;match&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;body&quot;</span> : <span class="string">&quot;quick brown fox&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="Arrays"><a href="#Arrays" class="headerlink" title="Arrays"></a>Arrays</h4><p>数组不需要专用的字段数据类型,默认情况下,任何字段都可以包含零个或多个值,但是数组中的所有值必须具有相同的字段类型.</p>
<p>字符串数组： [ &quot;one&quot;, &quot;two&quot;]<br>整数数组： [ 1, 2]<br>数组数组： [ 1, [ 2, 3]] 相当于 [ 1, 2, 3]<br>对象数组： [ { &quot;name&quot;: &quot;Mary&quot;, &quot;age&quot;: 12 }, { &quot;name&quot;: &quot;John&quot;, &quot;age&quot;: 10 }]</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;some arrays in this document...&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;tags&quot;</span>:  [ <span class="string">&quot;elasticsearch&quot;</span>, <span class="string">&quot;wow&quot;</span> ], </span><br><span class="line">  <span class="attr">&quot;lists&quot;</span>: [ </span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;prog_list&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;programming list&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;cool_list&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;cool stuff list&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/2?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;no arrays in this document...&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;tags&quot;</span>:  <span class="string">&quot;elasticsearch&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;lists&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;prog_list&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;programming list&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;tags&quot;</span>: <span class="string">&quot;elasticsearch&quot;</span> </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="元数据字段"><a href="#元数据字段" class="headerlink" title="元数据字段"></a>元数据字段</h3><p>每个文档都有与其关联的元数据,例如<code>_index/mapping _type/_idmetadata</code>字段.创建映射类型时,可以自定义其中一些元数据字段的行为.</p>
<h4 id="身份元数据"><a href="#身份元数据" class="headerlink" title="身份元数据"></a>身份元数据</h4><h5 id="index"><a href="#index" class="headerlink" title="_index"></a><code>_index</code></h5><h5 id="type"><a href="#type" class="headerlink" title="_type"></a><code>_type</code></h5><h5 id="id"><a href="#id" class="headerlink" title="_id"></a><code>_id</code></h5><h4 id="文档源元数据"><a href="#文档源元数据" class="headerlink" title="文档源元数据"></a>文档源元数据</h4><h5 id="source"><a href="#source" class="headerlink" title="_source"></a><code>_source</code></h5><p>包含在索引时传递的原始JSON文档正文.该<code>_source</code>字段本身没有索引(因此不可搜索),但它被存储起来以便在执行获取请求时可以返回它.</p>
<h6 id="禁用source字段"><a href="#禁用source字段" class="headerlink" title="禁用source字段"></a>禁用source字段</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;_source&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;enabled&quot;</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h6 id="include-exclude"><a href="#include-exclude" class="headerlink" title="include/exclude"></a>include/exclude</h6><p>修剪字段的内容.</p>
<p>仍然可以搜索这个字段,即使它不在存储的<code>_source</code>,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/logs?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;_source&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;includes&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;*.count&quot;</span>,</span><br><span class="line">        <span class="string">&quot;meta.*&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;excludes&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;meta.description&quot;</span>,</span><br><span class="line">        <span class="string">&quot;meta.other.*&quot;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/logs/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;requests&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;count&quot;</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="attr">&quot;foo&quot;</span>: <span class="string">&quot;bar&quot;</span> </span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;meta&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Some metric&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;Some metric description&quot;</span>, </span><br><span class="line">    <span class="attr">&quot;other&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;foo&quot;</span>: <span class="string">&quot;one&quot;</span>, </span><br><span class="line">      <span class="attr">&quot;baz&quot;</span>: <span class="string">&quot;two&quot;</span> </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X GET &quot;localhost:9200/logs/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;meta.other.foo&quot;</span>: <span class="string">&quot;one&quot;</span> </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="索引元数据"><a href="#索引元数据" class="headerlink" title="索引元数据"></a>索引元数据</h4><h5 id="field-names"><a href="#field-names" class="headerlink" title="_field_names"></a><code>_field_names</code></h5><p>用于索引文档中包含除null之外的任何值的每个字段的名称,exists查询使用此字段来查找null对特定字段具有或不具有任何非值的文档.<br>仅索引已禁用doc_values和已norms禁用的字段的名称.对于已启用doc_values或norm启用exists查询的字段,查询仍然可用,但不会使用该字段.</p>
<h5 id="ignored"><a href="#ignored" class="headerlink" title="_ignored"></a><code>_ignored</code></h5><p>索引并存储文档中每个字段的名称,这些字段因格式错误ignore_malformed并被打开而被忽略.<br>此字段可使用term/terms/exists查询进行搜索,并作为搜索命中的一部分返回.</p>
<p>查询匹配所有包含一个或多个字段被忽略的文档,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;exists&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;_ignored&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>以下查询查找@timestamp在索引时其字段被忽略的所有文档,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;term&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;_ignored&quot;</span>: <span class="string">&quot;@timestamp&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="路由元数据"><a href="#路由元数据" class="headerlink" title="路由元数据"></a>路由元数据</h4><h5 id="routing"><a href="#routing" class="headerlink" title="_routing"></a><code>_routing</code></h5><p><code>shard_num = hash(_routing) % num_primary_shards</code>,默认<code>_routing</code>为<code>_id</code>.</p>
<p>自定义路由参数,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?routing=user1&amp;refresh=true&amp;pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;This is a document&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_doc/1?routing=user1&amp;pretty&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;terms&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;_routing&quot;</span>: [ <span class="string">&quot;user1&quot;</span> ] </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>此时会抛出异常,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000002?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;_routing&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;required&quot;</span>: <span class="literal">true</span> </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000002/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;No routing value provided&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h6 id="路由到索引分区"><a href="#路由到索引分区" class="headerlink" title="路由到索引分区"></a>路由到索引分区</h6><p>可以配置索引,以便自定义路由值将转到分片的子集而不是单个分片.这有助于降低以不平衡集群告终的风险,同时仍然减少搜索的影响.</p>
<p>这是通过<code>index.routing_partition_size</code>,在创建索引时提供索引级别设置来完成的.<br>随着分区大小的增加,数据将变得越均匀,代价是每个请求必须搜索更多的分片.</p>
<p>当此设置存在时,计算分片的公式变为:<br><code>shard_num = (hash(_routing) + hash(_id) % routing_partition_size) % num_primary_shards</code><br>也就是说,该<code>_routing</code>字段用于计算索引中的一组分片,然后<code>_id</code>用于选择该组中的一个分片.</p>
<p>要启用此功能,<code>index.routing_partition_size</code>值应大于1且小于<code>index.number_of_shards</code>.</p>
<p>启用后,分区索引将具有以下限制:<br>1.无法在其中创建具有join字段关系的映射.<br>2.索引内的所有映射必须将<code>_routing</code>字段标记为必需.</p>
<h4 id="其它元数据"><a href="#其它元数据" class="headerlink" title="其它元数据"></a>其它元数据</h4><h5 id="meta"><a href="#meta" class="headerlink" title="_meta"></a><code>_meta</code></h5><p>自定义元数据.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;_meta&quot;</span>: &#123; </span><br><span class="line">      <span class="attr">&quot;class&quot;</span>: <span class="string">&quot;MyApp::User&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;version&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;min&quot;</span>: <span class="string">&quot;1.0&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;max&quot;</span>: <span class="string">&quot;1.3&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="映射参数"><a href="#映射参数" class="headerlink" title="映射参数"></a>映射参数</h3><h4 id="analyzer"><a href="#analyzer" class="headerlink" title="analyzer"></a>analyzer</h4><p>只有text字段支持analyzer映射参数,该analyzer参数指定索引或搜索字段时用于文本分析的分析器.</p>
<p><code>search_quote_analyzer</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">&quot;settings&quot;</span>:&#123;</span><br><span class="line">      <span class="attr">&quot;analysis&quot;</span>:&#123;</span><br><span class="line">         <span class="attr">&quot;analyzer&quot;</span>:&#123;</span><br><span class="line">            <span class="attr">&quot;my_analyzer&quot;</span>:&#123; </span><br><span class="line">               <span class="attr">&quot;type&quot;</span>:<span class="string">&quot;custom&quot;</span>,</span><br><span class="line">               <span class="attr">&quot;tokenizer&quot;</span>:<span class="string">&quot;standard&quot;</span>,</span><br><span class="line">               <span class="attr">&quot;filter&quot;</span>:[</span><br><span class="line">                  <span class="string">&quot;lowercase&quot;</span></span><br><span class="line">               ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;my_stop_analyzer&quot;</span>:&#123; </span><br><span class="line">               <span class="attr">&quot;type&quot;</span>:<span class="string">&quot;custom&quot;</span>,</span><br><span class="line">               <span class="attr">&quot;tokenizer&quot;</span>:<span class="string">&quot;standard&quot;</span>,</span><br><span class="line">               <span class="attr">&quot;filter&quot;</span>:[</span><br><span class="line">                  <span class="string">&quot;lowercase&quot;</span>,</span><br><span class="line">                  <span class="string">&quot;english_stop&quot;</span></span><br><span class="line">               ]</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="attr">&quot;filter&quot;</span>:&#123;</span><br><span class="line">            <span class="attr">&quot;english_stop&quot;</span>:&#123;</span><br><span class="line">               <span class="attr">&quot;type&quot;</span>:<span class="string">&quot;stop&quot;</span>,</span><br><span class="line">               <span class="attr">&quot;stopwords&quot;</span>:<span class="string">&quot;_english_&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">&quot;mappings&quot;</span>:&#123;</span><br><span class="line">       <span class="attr">&quot;properties&quot;</span>:&#123;</span><br><span class="line">          <span class="attr">&quot;title&quot;</span>: &#123;</span><br><span class="line">             <span class="attr">&quot;type&quot;</span>:<span class="string">&quot;text&quot;</span>,</span><br><span class="line">             <span class="attr">&quot;analyzer&quot;</span>:<span class="string">&quot;my_analyzer&quot;</span>, </span><br><span class="line">             <span class="attr">&quot;search_analyzer&quot;</span>:<span class="string">&quot;my_stop_analyzer&quot;</span>, </span><br><span class="line">             <span class="attr">&quot;search_quote_analyzer&quot;</span>:<span class="string">&quot;my_analyzer&quot;</span> </span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">&quot;title&quot;</span>:<span class="string">&quot;The Quick Brown Fox&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/2?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">&quot;title&quot;</span>:<span class="string">&quot;A Quick Brown Fox&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">&quot;query&quot;</span>:&#123;</span><br><span class="line">      <span class="attr">&quot;query_string&quot;</span>:&#123;</span><br><span class="line">         <span class="attr">&quot;query&quot;</span>:<span class="string">&quot;\&quot;the quick brown fox\&quot;&quot;</span> </span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>my_analyzer:分析器标记所有术语,包括停用词.<br>my_stop_analyzer:去除停用词的分析器.<br><code>&quot;analyzer&quot;:&quot;my_analyzer&quot;,</code>:将在索引时使用的分析器的设置.<br>search_analyzer:指向my_stop_analyzer和删除非短语查询的停用词的设置.<br>search_quote_analyzer:指向my_analyzer分析器并确保不会从短语查询中删除停用词的设置.</p>
<p>由于查询包含在引号中,因此它被检测为短语查询,因此search_quote_analyzer启动并确保不会从查询中删除停用词.<br>然后my_analyzer分析器将返回以下标记[ the, quick, brown, fox]这将匹配文档之一.<br>同时,将使用my_stop_analyzer分析器分析术语查询,过滤掉停用词.<br>因此,搜索其中一个The quick brown fox或A quick brown fox将返回两个文档,因为两个文档都包含以下标记[ quick, brown, fox].<br>没有search_quote_analyzer它就不可能对短语查询进行精确匹配,因为短语查询中的停用词将被删除,导致两个文档都匹配.</p>
<h4 id="boost"><a href="#boost" class="headerlink" title="boost"></a>boost</h4><p>单个字段可以在查询时自动提升,更多地计入相关性分数.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;title&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;boost&quot;</span>: <span class="number">2</span> </span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;content&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;title&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;query&quot;</span>: <span class="string">&quot;quick brown fox&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>可以通过在查询中直接使用boost参数来达到相同的效果,以上相当于,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST &quot;localhost:9200/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;title&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;query&quot;</span>: <span class="string">&quot;quick brown fox&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;boost&quot;</span>: <span class="number">2</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="coerce"><a href="#coerce" class="headerlink" title="coerce"></a>coerce</h4><p>强制尝试清理脏值以适应字段的数据类型,例如字符串将被强制转换为数字,对于整数值,浮点数将被截断.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;number_one&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;integer&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;number_two&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;integer&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;coerce&quot;</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;number_one&quot;</span>: <span class="string">&quot;10&quot;</span> </span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/2?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;number_two&quot;</span>: <span class="string">&quot;10&quot;</span> </span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>文档1中number_one字段将包含整数10,文档2将被拒绝.</p>
<p><code>index.mapping.coerce</code>可以在索引级别设置该设置以在所有映射类型中全局禁用强制.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;settings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index.mapping.coerce&quot;</span>: <span class="literal">false</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;number_one&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;integer&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;coerce&quot;</span>: <span class="literal">true</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;number_two&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;integer&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123; <span class="attr">&quot;number_one&quot;</span>: <span class="string">&quot;10&quot;</span> &#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/2?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123; <span class="attr">&quot;number_two&quot;</span>: <span class="string">&quot;10&quot;</span> &#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>文档1覆盖了设置,文档2将拒绝.</p>
<h4 id="copy-to"><a href="#copy-to" class="headerlink" title="copy_to"></a>copy_to</h4><p>允许将多个字段的值复制到一个组字段中,然后可以将其作为单个字段进行查询.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;first_name&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;copy_to&quot;</span>: <span class="string">&quot;full_name&quot;</span> </span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;last_name&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;copy_to&quot;</span>: <span class="string">&quot;full_name&quot;</span> </span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;full_name&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;first_name&quot;</span>: <span class="string">&quot;John&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;last_name&quot;</span>: <span class="string">&quot;Smith&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;full_name&quot;</span>: &#123; </span><br><span class="line">        <span class="attr">&quot;query&quot;</span>: <span class="string">&quot;John Smith&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;operator&quot;</span>: <span class="string">&quot;and&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>first_name和last_name字段的值被复制到full_name字段中.<br>该first_name和last_name字段仍可以分别查询了第一个名字和姓氏,但full_name可以查询两个姓和名.</p>
<blockquote>
<p>注意</p>
<p>复制的是字段值,而不是术语(由分析过程产生).<br><code>_source</code>不会修改原始字段以显示复制的值.<br>可以将相同的值复制到多个字段,使用&quot;copy_to&quot;: [ &quot;field_1&quot;, &quot;field_2&quot; ].<br>不能通过中间字段递归复制,而是使用copy_to直接复制到来自原始字段的多个字段.</p>
</blockquote>
<h4 id="doc-values"><a href="#doc-values" class="headerlink" title="doc_values"></a>doc_values</h4><p>默认情况下,大多数字段都被编入索引,这使得它们可以被搜索,如果不需要对字段进行排序或聚合,或从脚本访问字段值,可以禁用以节省磁盘空间.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;status_code&quot;</span>: &#123; </span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;session_id&quot;</span>: &#123; </span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;doc_values&quot;</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="dynamic"><a href="#dynamic" class="headerlink" title="dynamic"></a>dynamic</h4><p>默认情况下,字段可以动态添加到文档或文档中的内部对象,只需索引包含新字段的文档即可.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;johnsmith&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;first&quot;</span>: <span class="string">&quot;John&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;last&quot;</span>: <span class="string">&quot;Smith&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_mapping?pretty&quot;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/2?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;marywhite&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;email&quot;</span>: <span class="string">&quot;mary@white.com&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;first&quot;</span>: <span class="string">&quot;Mary&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;middle&quot;</span>: <span class="string">&quot;Alice&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;last&quot;</span>: <span class="string">&quot;White&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_mapping?pretty&quot;</span><br></pre></td></tr></table></figure>

<p><code>true</code><br>新检测到的字段将添加到映射中,默认.</p>
<p><code>false</code><br>新检测到的字段将被忽略,这些字段不会被编入索引,因此将不可搜索,但仍会出现在<code>_source</code>返回的命中字段中.<br>这些字段不会添加到映射中,必须显式添加新字段.</p>
<p><code>strict</code><br>如果检测到新字段,则会抛出异常并拒绝文档,新字段必须显式添加到映射中.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;dynamic&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;user&quot;</span>: &#123; </span><br><span class="line">        <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;name&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">&quot;social_networks&quot;</span>: &#123; </span><br><span class="line">            <span class="attr">&quot;dynamic&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">&quot;properties&quot;</span>: &#123;&#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="eager-global-ordinals"><a href="#eager-global-ordinals" class="headerlink" title="eager_global_ordinals"></a>eager_global_ordinals</h4><h4 id="enabled"><a href="#enabled" class="headerlink" title="enabled"></a>enabled</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;user_id&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>:  <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;last_updated&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;date&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;session_data&quot;</span>: &#123; </span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;object&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;enabled&quot;</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/session_1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;user_id&quot;</span>: <span class="string">&quot;kimchy&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;session_data&quot;</span>: &#123; </span><br><span class="line">    <span class="attr">&quot;arbitrary_object&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;some_array&quot;</span>: [ <span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span>, &#123; <span class="attr">&quot;baz&quot;</span>: <span class="number">2</span> &#125; ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;last_updated&quot;</span>: <span class="string">&quot;2015-12-06T18:20:22&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/session_2?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;user_id&quot;</span>: <span class="string">&quot;jpountz&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;session_data&quot;</span>: <span class="string">&quot;none&quot;</span>, </span><br><span class="line">  <span class="attr">&quot;last_updated&quot;</span>: <span class="string">&quot;2015-12-06T18:22:13&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;enabled&quot;</span>: <span class="literal">false</span> </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/session_1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;user_id&quot;</span>: <span class="string">&quot;kimchy&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;session_data&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;arbitrary_object&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;some_array&quot;</span>: [ <span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span>, &#123; <span class="attr">&quot;baz&quot;</span>: <span class="number">2</span> &#125; ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;last_updated&quot;</span>: <span class="string">&quot;2015-12-06T18:20:22&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_doc/session_1?pretty&quot;</span><br><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_mapping?pretty&quot;</span><br></pre></td></tr></table></figure>

<h4 id="format"><a href="#format" class="headerlink" title="format"></a>format</h4><p>格式化日期.</p>
<h4 id="ignore-above"><a href="#ignore-above" class="headerlink" title="ignore_above"></a>ignore_above</h4><p>长度超过ignore_above设置的字符串将不会被索引或存储.</p>
<h4 id="ignore-malformed"><a href="#ignore-malformed" class="headerlink" title="ignore_malformed"></a>ignore_malformed</h4><p>默认情况下,尝试将错误的数据类型索引到字段中会引发异常,并拒绝整个文档.<br>该ignore_malformed参数如果设置为true,则允许忽略异常.<br>格式错误的字段没有被索引,但是文档中的其他字段被正常处理.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;number_one&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;integer&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;ignore_malformed&quot;</span>: <span class="literal">true</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;number_two&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;integer&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;text&quot;</span>:       <span class="string">&quot;Some text value&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;number_one&quot;</span>: <span class="string">&quot;foo&quot;</span> </span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/2?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;text&quot;</span>:       <span class="string">&quot;Some text value&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;number_two&quot;</span>: <span class="string">&quot;foo&quot;</span> </span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="index-1"><a href="#index-1" class="headerlink" title="index"></a>index</h4><p>该index选项控制是否对字段值进行索引,它接受true/false,默认为true,未编入索引的字段不可查询.</p>
<h4 id="index-options"><a href="#index-options" class="headerlink" title="index_options"></a>index_options</h4><p>控制将哪些信息添加到倒排索引以进行搜索和突出显示,仅用于text字段.</p>
<p><code>docs</code><br>只有文档编号被索引.</p>
<p><code>freqs</code><br>文档编号和术语频率已编入索引,术语频率用于对重复术语的评分高于单个术语.</p>
<p><code>positions</code><br>默认,文档编号/术语频率/术语位置/顺序被编入索引,位置可用于邻近或短语查询.</p>
<p><code>offsets</code><br>文档编号/术语频率/位置/开始和结束字符偏移都被编入索引.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;text&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;index_options&quot;</span>: <span class="string">&quot;offsets&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;Quick brown fox&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;brown fox&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;highlight&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;fields&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;text&quot;</span>: &#123;&#125; </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="index-phrases"><a href="#index-phrases" class="headerlink" title="index_phrases"></a>index_phrases</h4><h4 id="index-prefixes"><a href="#index-prefixes" class="headerlink" title="index_prefixes"></a>index_prefixes</h4><p>启用对术语前缀的索引以加快前缀搜索.</p>
<p><code>min_chars</code><br>索引的最小前缀长度,必须大于0,默认为2,该值包含在内,</p>
<p><code>max_chars</code><br>索引的最大前缀长度,必须小于20,默认为5,该值包含在内.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;body_text&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;index_prefixes&quot;</span>: &#123; &#125;    </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>空的设置对象将使用默认值min_chars和max_chars设置.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;full_name&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;index_prefixes&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;min_chars&quot;</span> : <span class="number">1</span>,</span><br><span class="line">          <span class="attr">&quot;max_chars&quot;</span> : <span class="number">10</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="meta-1"><a href="#meta-1" class="headerlink" title="meta"></a>meta</h4><p>附加到字段的元数据,字段元数据可通过提交映射更新来更新,更新的元数据将覆盖现有字段的元数据.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;latency&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;meta&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;unit&quot;</span>: <span class="string">&quot;ms&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="fields"><a href="#fields" class="headerlink" title="fields"></a>fields</h4><p>一个string字段可以被映射为一个text用于全文搜索,以及一个keyword字段用于排序或聚合的字段.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;city&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;fields&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;raw&quot;</span>: &#123; </span><br><span class="line">            <span class="attr">&quot;type&quot;</span>:  <span class="string">&quot;keyword&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;city&quot;</span>: <span class="string">&quot;New York&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/2?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;city&quot;</span>: <span class="string">&quot;York&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;city&quot;</span>: <span class="string">&quot;york&quot;</span> </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;sort&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;city.raw&quot;</span>: <span class="string">&quot;asc&quot;</span> </span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;Cities&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;terms&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;city.raw&quot;</span> </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="normalizer"><a href="#normalizer" class="headerlink" title="normalizer"></a>normalizer</h4><h4 id="norms"><a href="#norms" class="headerlink" title="norms"></a>norms</h4><h4 id="null-value"><a href="#null-value" class="headerlink" title="null_value"></a>null_value</h4><p>一个null值不能被索引或搜索,当一个字段设置为null(一个空数组或一个null值数组)时,它被视为该字段没有值,该null_value参数允许用指定的值替换显式值,以便可以对其进行索引和搜索.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;status_code&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;null_value&quot;</span>: <span class="string">&quot;NULL&quot;</span> </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;status_code&quot;</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/2?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;status_code&quot;</span>: [] </span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;term&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;status_code&quot;</span>: <span class="string">&quot;NULL&quot;</span> </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>用null术语替换显式值NULL.<br>空数组不包含显式null,因此不会被替换为null_value.<br>查询NULL返回文档1,但不返回文档2.</p>
<h4 id="position-increment-gap"><a href="#position-increment-gap" class="headerlink" title="position_increment_gap"></a>position_increment_gap</h4><h4 id="properties"><a href="#properties" class="headerlink" title="properties"></a>properties</h4><p>类型映射/object字段/nested字段包含子字段,称为properties.<br>这些属性可以是任何数据类型,包括object和nested,可以添加属性.</p>
<p>通过在创建索引时明确定义它们.<br>通过在使用PUT映射API添加或更新映射类型时明确定义它们.<br>仅通过索引包含新字段的文档动态地进行.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123; </span><br><span class="line">      <span class="attr">&quot;manager&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;properties&quot;</span>: &#123; </span><br><span class="line">          <span class="attr">&quot;age&quot;</span>:  &#123; <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;integer&quot;</span> &#125;,</span><br><span class="line">          <span class="attr">&quot;name&quot;</span>: &#123; <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>  &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;employees&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;nested&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;properties&quot;</span>: &#123; </span><br><span class="line">          <span class="attr">&quot;age&quot;</span>:  &#123; <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;integer&quot;</span> &#125;,</span><br><span class="line">          <span class="attr">&quot;name&quot;</span>: &#123; <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>  &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;region&quot;</span>: <span class="string">&quot;US&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;manager&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Alice White&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;age&quot;</span>: <span class="number">30</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;employees&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;John Smith&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;age&quot;</span>: <span class="number">34</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Peter Brown&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;age&quot;</span>: <span class="number">26</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>内部字段可以在查询/聚合等中引用,使用点表示法.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;manager.name&quot;</span>: <span class="string">&quot;Alice White&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;Employees&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;nested&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;employees&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;Employee Ages&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;histogram&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;employees.age&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;interval&quot;</span>: <span class="number">5</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="search-analyzer"><a href="#search-analyzer" class="headerlink" title="search_analyzer"></a>search_analyzer</h4><h4 id="similarity"><a href="#similarity" class="headerlink" title="similarity"></a>similarity</h4><h4 id="store"><a href="#store" class="headerlink" title="store"></a>store</h4><p>title和date字段存储.<br>此请求将检索title和date字段的值.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;title&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;store&quot;</span>: <span class="literal">true</span> </span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;date&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;date&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;store&quot;</span>: <span class="literal">true</span> </span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;content&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001/_doc/1?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;title&quot;</span>:   <span class="string">&quot;Some short title&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;date&quot;</span>:    <span class="string">&quot;2015-01-01&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;content&quot;</span>: <span class="string">&quot;A very long content field...&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;stored_fields&quot;</span>: [ <span class="string">&quot;title&quot;</span>, <span class="string">&quot;date&quot;</span> ] </span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="term-vector"><a href="#term-vector" class="headerlink" title="term_vector"></a>term_vector</h4><h2 id="text-analysis"><a href="#text-analysis" class="headerlink" title="text analysis"></a>text analysis</h2><p>文本分析是将非结构化文本(例如电子邮件正文/产品说明)转换为针对搜索进行优化的结构化格式的过程.<br><code>在索引/搜索text字段</code>时执行文本分析.</p>
<p>文本分析使Elasticsearch能够执行全文搜索,其中搜索返回所有相关结果,而不仅仅是完全匹配.</p>
<h3 id="测试文本分析"><a href="#测试文本分析" class="headerlink" title="测试文本分析"></a>测试文本分析</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST &quot;localhost:9200/_analyze?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;whitespace&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;text&quot;</span>:     <span class="string">&quot;The quick brown fox.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>响应,</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;tokens&quot;</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;token&quot;</span> : <span class="string">&quot;The&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> : <span class="number">0</span>,</span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> : <span class="number">3</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;word&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;position&quot;</span> : <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;token&quot;</span> : <span class="string">&quot;quick&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> : <span class="number">4</span>,</span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> : <span class="number">9</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;word&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;position&quot;</span> : <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;token&quot;</span> : <span class="string">&quot;brown&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> : <span class="number">10</span>,</span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> : <span class="number">15</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;word&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;position&quot;</span> : <span class="number">2</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;token&quot;</span> : <span class="string">&quot;fox.&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> : <span class="number">16</span>,</span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> : <span class="number">20</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;word&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;position&quot;</span> : <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST &quot;localhost:9200/_analyze?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;tokenizer&quot;</span>: <span class="string">&quot;standard&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;filter&quot;</span>:  [ <span class="string">&quot;lowercase&quot;</span>, <span class="string">&quot;asciifolding&quot;</span> ],</span><br><span class="line">  <span class="attr">&quot;text&quot;</span>:      <span class="string">&quot;Is this déja vu?&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="配置分析"><a href="#配置分析" class="headerlink" title="配置分析"></a>配置分析</h3><p>指定字段分析,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;title&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;whitespace&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>指定索引分析,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &quot;localhost:9200/my-index-000001?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;settings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;analysis&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;analyzer&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;default&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;simple&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>指定查询分析,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &quot;localhost:9200/my-index-000001/_search?pretty&quot; -H &#x27;Content-Type: application/json&#x27; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;message&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;query&quot;</span>: <span class="string">&quot;Quick foxes&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;stop&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/elasticsearch/" rel="tag"># elasticsearch</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/11/26/elasticsearch-query%20dsl/" rel="prev" title="elasticsearch-query dsl">
                  <i class="fa fa-chevron-left"></i> elasticsearch-query dsl
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/12/15/vue-%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/" rel="next" title="vue-项目搭建">
                  vue-项目搭建 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>







<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">maoeryu</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  






  





</body>
</html>
