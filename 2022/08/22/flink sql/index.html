<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"maoeryu.github.io","root":"/","images":"/images","scheme":"Pisces","version":"8.2.1","exturl":false,"sidebar":{"position":"left","width":200,"display":"post","padding":7,"offset":5},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}};
  </script>
<meta name="description" content="模块模块允许用户扩展 Flink 的内置对象,例如定义行为类似于 Flink 内置函数的函数.它们是可插拔的,虽然 Flink 提供了一些预构建的模块,但用户可以自己编写. 例如,用户可以定义自己的地理函数,并将其作为内置函数插入 Flink,以在 Flink SQL 和 Table API 中使用.另一个例子是用户可以加载一个现成的 Hive 模块来使用 Hive 内置函数作为 Flink 内置">
<meta property="og:type" content="article">
<meta property="og:title" content="flink sql">
<meta property="og:url" content="https://maoeryu.github.io/2022/08/22/flink%20sql/index.html">
<meta property="og:site_name" content="FlyingPig">
<meta property="og:description" content="模块模块允许用户扩展 Flink 的内置对象,例如定义行为类似于 Flink 内置函数的函数.它们是可插拔的,虽然 Flink 提供了一些预构建的模块,但用户可以自己编写. 例如,用户可以定义自己的地理函数,并将其作为内置函数插入 Flink,以在 Flink SQL 和 Table API 中使用.另一个例子是用户可以加载一个现成的 Hive 模块来使用 Hive 内置函数作为 Flink 内置">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-08-21T16:00:00.000Z">
<meta property="article:modified_time" content="2022-12-02T06:09:40.401Z">
<meta property="article:author" content="maoeryu">
<meta property="article:tag" content="flink">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://maoeryu.github.io/2022/08/22/flink%20sql/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>
<title>flink sql | FlyingPig</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">FlyingPig</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97"><span class="nav-number">1.</span> <span class="nav-text">模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.1.</span> <span class="nav-text">模块类型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97"><span class="nav-number">1.1.1.</span> <span class="nav-text">核心模块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Hive%E6%A8%A1%E5%9D%97"><span class="nav-number">1.1.2.</span> <span class="nav-text">Hive模块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E5%AE%9A%E4%B9%89%E7%9A%84%E6%A8%A1%E5%9D%97"><span class="nav-number">1.1.3.</span> <span class="nav-text">用户定义的模块</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%92%8C%E8%A7%A3%E6%9E%90%E9%A1%BA%E5%BA%8F"><span class="nav-number">1.2.</span> <span class="nav-text">模块生命周期和解析顺序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="nav-number">1.3.</span> <span class="nav-text">命名空间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%8A%A0%E8%BD%BD-%E5%8D%B8%E8%BD%BD-%E4%BD%BF%E7%94%A8%E5%92%8C%E5%88%97%E5%87%BA%E6%A8%A1%E5%9D%97"><span class="nav-number">1.4.</span> <span class="nav-text">如何加载&#x2F;卸载&#x2F;使用和列出模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-SQL"><span class="nav-number">1.4.1.</span> <span class="nav-text">使用 SQL</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#java"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#sql"><span class="nav-number">1.4.1.2.</span> <span class="nav-text">sql</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8java"><span class="nav-number">1.4.2.</span> <span class="nav-text">使用java</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Catalogs"><span class="nav-number">2.</span> <span class="nav-text">Catalogs</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Catalog-%E7%B1%BB%E5%9E%8B"><span class="nav-number">2.1.</span> <span class="nav-text">Catalog 类型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#GenericInMemoryCatalog"><span class="nav-number">2.1.1.</span> <span class="nav-text">GenericInMemoryCatalog</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JdbcCatalog"><span class="nav-number">2.1.2.</span> <span class="nav-text">JdbcCatalog</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HiveCatalog"><span class="nav-number">2.1.3.</span> <span class="nav-text">HiveCatalog</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89-Catalog"><span class="nav-number">2.1.4.</span> <span class="nav-text">用户自定义 Catalog</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA-Flink-%E8%A1%A8%E5%B9%B6%E5%B0%86%E5%85%B6%E6%B3%A8%E5%86%8C%E5%88%B0-Catalog"><span class="nav-number">2.2.</span> <span class="nav-text">如何创建 Flink 表并将其注册到 Catalog</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-SQL-DDL"><span class="nav-number">2.2.1.</span> <span class="nav-text">使用 SQL DDL</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Java"><span class="nav-number">2.2.1.1.</span> <span class="nav-text">Java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#sql-1"><span class="nav-number">2.2.1.2.</span> <span class="nav-text">sql</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Java-Scala"><span class="nav-number">2.2.2.</span> <span class="nav-text">使用 Java&#x2F;Scala</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Catalog-API"><span class="nav-number">2.3.</span> <span class="nav-text">Catalog API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="nav-number">2.3.1.</span> <span class="nav-text">数据库操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="nav-number">2.3.2.</span> <span class="nav-text">表操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%86%E5%9B%BE%E6%93%8D%E4%BD%9C"><span class="nav-number">2.3.3.</span> <span class="nav-text">视图操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E5%8C%BA%E6%93%8D%E4%BD%9C"><span class="nav-number">2.3.4.</span> <span class="nav-text">分区操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E6%93%8D%E4%BD%9C"><span class="nav-number">2.3.5.</span> <span class="nav-text">函数操作</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E8%BF%87Table-API%E5%92%8CSQL-Client%E6%93%8D%E4%BD%9CCatalog"><span class="nav-number">2.4.</span> <span class="nav-text">通过Table API和SQL Client操作Catalog</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%A8%E5%86%8C-Catalog"><span class="nav-number">2.4.1.</span> <span class="nav-text">注册 Catalog</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E5%BD%93%E5%89%8D%E7%9A%84-Catalog-%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">2.4.2.</span> <span class="nav-text">修改当前的 Catalog 和数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%97%E5%87%BA%E5%8F%AF%E7%94%A8%E7%9A%84-Catalog"><span class="nav-number">2.4.3.</span> <span class="nav-text">列出可用的 Catalog</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%97%E5%87%BA%E5%8F%AF%E7%94%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">2.4.4.</span> <span class="nav-text">列出可用的数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%97%E5%87%BA%E5%8F%AF%E7%94%A8%E7%9A%84%E8%A1%A8"><span class="nav-number">2.4.5.</span> <span class="nav-text">列出可用的表</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SQL-%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-number">3.</span> <span class="nav-text">SQL 客户端</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%A5%E9%97%A8"><span class="nav-number">3.1.</span> <span class="nav-text">入门</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8-SQL-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%95%8C%E9%9D%A2"><span class="nav-number">3.1.1.</span> <span class="nav-text">启动 SQL 客户端命令行界面</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C-SQL-%E6%9F%A5%E8%AF%A2"><span class="nav-number">3.1.2.</span> <span class="nav-text">执行 SQL 查询</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configuration"><span class="nav-number">3.2.</span> <span class="nav-text">Configuration</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-Client-startup-options"><span class="nav-number">3.2.1.</span> <span class="nav-text">SQL Client startup options</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-Client-Configuration"><span class="nav-number">3.2.2.</span> <span class="nav-text">SQL Client Configuration</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-SQL-%E6%96%87%E4%BB%B6%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BC%9A%E8%AF%9D"><span class="nav-number">3.2.3.</span> <span class="nav-text">使用 SQL 文件初始化会话</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E9%A1%B9"><span class="nav-number">3.2.4.</span> <span class="nav-text">依赖项</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-SQL-%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%8F%90%E4%BA%A4%E4%BD%9C%E4%B8%9A"><span class="nav-number">3.3.</span> <span class="nav-text">使用 SQL 客户端提交作业</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%A4%E4%BA%92%E5%BC%8F%E5%91%BD%E4%BB%A4%E8%A1%8C"><span class="nav-number">3.3.1.</span> <span class="nav-text">交互式命令行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C-SQL-%E6%96%87%E4%BB%B6"><span class="nav-number">3.3.2.</span> <span class="nav-text">执行 SQL 文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C%E4%B8%80%E7%BB%84-SQL-%E8%AF%AD%E5%8F%A5"><span class="nav-number">3.3.3.</span> <span class="nav-text">执行一组 SQL 语句</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#SQL-CLI"><span class="nav-number">3.3.3.1.</span> <span class="nav-text">SQL CLI</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SQL-File"><span class="nav-number">3.3.3.2.</span> <span class="nav-text">SQL File</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C-DML-%E8%AF%AD%E5%8F%A5%E5%90%8C%E6%AD%A5-%E5%BC%82%E6%AD%A5"><span class="nav-number">3.3.4.</span> <span class="nav-text">执行 DML 语句同步&#x2F;异步</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%8E%E4%BF%9D%E5%AD%98%E7%82%B9%E5%90%AF%E5%8A%A8-SQL-%E4%BD%9C%E4%B8%9A"><span class="nav-number">3.3.5.</span> <span class="nav-text">从保存点启动 SQL 作业</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BD%9C%E4%B8%9A%E5%90%8D%E7%A7%B0"><span class="nav-number">3.3.6.</span> <span class="nav-text">定义自定义作业名称</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE"><span class="nav-number">4.</span> <span class="nav-text">配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A6%82%E8%A7%88"><span class="nav-number">4.1.</span> <span class="nav-text">概览</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Java-1"><span class="nav-number">4.1.1.</span> <span class="nav-text">Java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sql-2"><span class="nav-number">4.1.2.</span> <span class="nav-text">sql</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C%E9%85%8D%E7%BD%AE"><span class="nav-number">4.2.</span> <span class="nav-text">执行配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="nav-number">4.3.</span> <span class="nav-text">优化器配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Planner-%E9%85%8D%E7%BD%AE"><span class="nav-number">4.4.</span> <span class="nav-text">Planner 配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL-Client-%E9%85%8D%E7%BD%AE"><span class="nav-number">4.5.</span> <span class="nav-text">SQL Client 配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E5%AE%9A%E4%B9%89Sources-amp-Sinks"><span class="nav-number">5.</span> <span class="nav-text">用户定义Sources &amp; Sinks</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">maoeryu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">220</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">50</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://maoeryu.github.io/2022/08/22/flink%20sql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="maoeryu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FlyingPig">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          flink sql
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-08-22 00:00:00" itemprop="dateCreated datePublished" datetime="2022-08-22T00:00:00+08:00">2022-08-22</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-12-02 14:09:40" itemprop="dateModified" datetime="2022-12-02T14:09:40+08:00">2022-12-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8D%8F%E5%90%8C%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">协同框架</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h2><p>模块允许用户扩展 Flink 的内置对象,例如定义行为类似于 Flink 内置函数的函数.<br>它们是可插拔的,虽然 Flink 提供了一些预构建的模块,但用户可以自己编写.</p>
<p>例如,用户可以定义自己的地理函数,并将其作为内置函数插入 Flink,以在 Flink SQL 和 Table API 中使用.<br>另一个例子是用户可以加载一个现成的 Hive 模块来使用 Hive 内置函数作为 Flink 内置函数.</p>
<p>此外,一个模块可以提供内置的表源和接收器工厂,它们禁用 Flink 基于 Java 的服务提供者接口 (SPI) 的默认发现机制,或者影响在没有相应目录的情况下如何创建临时表的连接器.</p>
<span id="more"></span>
<h3 id="模块类型"><a href="#模块类型" class="headerlink" title="模块类型"></a>模块类型</h3><h4 id="核心模块"><a href="#核心模块" class="headerlink" title="核心模块"></a>核心模块</h4><p>CoreModule包含 Flink 的所有系统(内置)功能,默认加载并启用.</p>
<h4 id="Hive模块"><a href="#Hive模块" class="headerlink" title="Hive模块"></a>Hive模块</h4><p>将HiveModule Hive 内置函数作为 Flink 的系统函数提供给 SQL 和 Table API 用户.<br>Flink 的Hive 文档提供了有关设置模块的完整详细信息.</p>
<h4 id="用户定义的模块"><a href="#用户定义的模块" class="headerlink" title="用户定义的模块"></a>用户定义的模块</h4><p>用户可以通过实现Module接口来开发自定义模块.<br>ModuleFactory要在 SQL CLI 中使用自定义模块,用户应该通过实现接口来开发模块及其对应的模块工厂.</p>
<p>模块工厂定义了一组属性,用于在 SQL CLI 引导时配置模块.<br>属性被传递给发现服务,该服务尝试将属性与 a 匹配ModuleFactory并实例化相应的模块实例.</p>
<h3 id="模块生命周期和解析顺序"><a href="#模块生命周期和解析顺序" class="headerlink" title="模块生命周期和解析顺序"></a>模块生命周期和解析顺序</h3><p>可以加载/启用/禁用和卸载模块.<br>当 TableEnvironment 最初加载一个模块时,它默认启用该模块.<br>Flink 支持多个模块并跟踪加载顺序以解析元数据.<br>此外,Flink 只解析启用的模块之间的功能.<br>例如,当两个模块中存在两个同名函数时,将出现三个条件.</p>
<p>如果两个模块都启用,那么 Flink 会按照模块的解析顺序来解析函数.<br>如果其中之一被禁用,则 Flink 将该功能解析为启用的模块.<br>如果两个模块都被禁用,则 Flink 无法解析该功能.</p>
<p>用户可以通过以不同的声明顺序使用模块来更改解析顺序.<br>例如,用户可以指定 Flink 在 Hive 中首先查找函数USE MODULES hive, core.</p>
<p>此外,用户还可以通过不声明模块来禁用模块.<br>例如,用户可以通过指定 Flink 禁用核心模块USE MODULES hive(但强烈不建议禁用核心模块).<br>禁用一个模块不会卸载它,用户可以通过使用它再次启用它.<br>例如,用户可以带回核心模块并将其放在第一个USE MODULES core, hive.<br>一个模块只有在它已经被加载时才能被启用.<br>使用未加载的模块将引发异常.<br>最终,用户可以卸载模块.</p>
<p>禁用和卸载模块的区别在于 TableEnvironment 仍然保留禁用的模块,用户可以列出所有已加载的模块来查看禁用的模块.</p>
<h3 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h3><p>模块提供的对象被认为是 Flink 系统(内置)对象的一部分.因此,它们没有任何命名空间.</p>
<h3 id="如何加载-卸载-使用和列出模块"><a href="#如何加载-卸载-使用和列出模块" class="headerlink" title="如何加载/卸载/使用和列出模块"></a>如何加载/卸载/使用和列出模块</h3><h4 id="使用-SQL"><a href="#使用-SQL" class="headerlink" title="使用 SQL"></a>使用 SQL</h4><p>用户可以使用 SQL 在 Table API 和 SQL CLI 中加载/卸载/使用/列出模块.</p>
<h5 id="java"><a href="#java" class="headerlink" title="java"></a>java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">EnvironmentSettings settings = EnvironmentSettings.inStreamingMode();</span><br><span class="line">TableEnvironment tableEnv = TableEnvironment.create(settings);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Show initially loaded and enabled modules</span></span><br><span class="line">tableEnv.executeSql(<span class="string">&quot;SHOW MODULES&quot;</span>).print();</span><br><span class="line"><span class="comment">// +-------------+</span></span><br><span class="line"><span class="comment">// | module name |</span></span><br><span class="line"><span class="comment">// +-------------+</span></span><br><span class="line"><span class="comment">// |        core |</span></span><br><span class="line"><span class="comment">// +-------------+</span></span><br><span class="line">tableEnv.executeSql(<span class="string">&quot;SHOW FULL MODULES&quot;</span>).print();</span><br><span class="line"><span class="comment">// +-------------+------+</span></span><br><span class="line"><span class="comment">// | module name | used |</span></span><br><span class="line"><span class="comment">// +-------------+------+</span></span><br><span class="line"><span class="comment">// |        core | true |</span></span><br><span class="line"><span class="comment">// +-------------+------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Load a hive module</span></span><br><span class="line">tableEnv.executeSql(<span class="string">&quot;LOAD MODULE hive WITH (&#x27;hive-version&#x27; = &#x27;...&#x27;)&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Show all enabled modules</span></span><br><span class="line">tableEnv.executeSql(<span class="string">&quot;SHOW MODULES&quot;</span>).print();</span><br><span class="line"><span class="comment">// +-------------+</span></span><br><span class="line"><span class="comment">// | module name |</span></span><br><span class="line"><span class="comment">// +-------------+</span></span><br><span class="line"><span class="comment">// |        core |</span></span><br><span class="line"><span class="comment">// |        hive |</span></span><br><span class="line"><span class="comment">// +-------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Show all loaded modules with both name and use status</span></span><br><span class="line">tableEnv.executeSql(<span class="string">&quot;SHOW FULL MODULES&quot;</span>).print();</span><br><span class="line"><span class="comment">// +-------------+------+</span></span><br><span class="line"><span class="comment">// | module name | used |</span></span><br><span class="line"><span class="comment">// +-------------+------+</span></span><br><span class="line"><span class="comment">// |        core | true |</span></span><br><span class="line"><span class="comment">// |        hive | true |</span></span><br><span class="line"><span class="comment">// +-------------+------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Change resolution order</span></span><br><span class="line">tableEnv.executeSql(<span class="string">&quot;USE MODULES hive, core&quot;</span>);</span><br><span class="line">tableEnv.executeSql(<span class="string">&quot;SHOW MODULES&quot;</span>).print();</span><br><span class="line"><span class="comment">// +-------------+</span></span><br><span class="line"><span class="comment">// | module name |</span></span><br><span class="line"><span class="comment">// +-------------+</span></span><br><span class="line"><span class="comment">// |        hive |</span></span><br><span class="line"><span class="comment">// |        core |</span></span><br><span class="line"><span class="comment">// +-------------+</span></span><br><span class="line">tableEnv.executeSql(<span class="string">&quot;SHOW FULL MODULES&quot;</span>).print();</span><br><span class="line"><span class="comment">// +-------------+------+</span></span><br><span class="line"><span class="comment">// | module name | used |</span></span><br><span class="line"><span class="comment">// +-------------+------+</span></span><br><span class="line"><span class="comment">// |        hive | true |</span></span><br><span class="line"><span class="comment">// |        core | true |</span></span><br><span class="line"><span class="comment">// +-------------+------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Disable core module</span></span><br><span class="line">tableEnv.executeSql(<span class="string">&quot;USE MODULES hive&quot;</span>);</span><br><span class="line">tableEnv.executeSql(<span class="string">&quot;SHOW MODULES&quot;</span>).print();</span><br><span class="line"><span class="comment">// +-------------+</span></span><br><span class="line"><span class="comment">// | module name |</span></span><br><span class="line"><span class="comment">// +-------------+</span></span><br><span class="line"><span class="comment">// |        hive |</span></span><br><span class="line"><span class="comment">// +-------------+</span></span><br><span class="line">tableEnv.executeSql(<span class="string">&quot;SHOW FULL MODULES&quot;</span>).print();</span><br><span class="line"><span class="comment">// +-------------+-------+</span></span><br><span class="line"><span class="comment">// | module name |  used |</span></span><br><span class="line"><span class="comment">// +-------------+-------+</span></span><br><span class="line"><span class="comment">// |        hive |  true |</span></span><br><span class="line"><span class="comment">// |        core | false |</span></span><br><span class="line"><span class="comment">// +-------------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Unload hive module</span></span><br><span class="line">tableEnv.executeSql(<span class="string">&quot;UNLOAD MODULE hive&quot;</span>);</span><br><span class="line">tableEnv.executeSql(<span class="string">&quot;SHOW MODULES&quot;</span>).print();</span><br><span class="line"><span class="comment">// Empty set</span></span><br><span class="line">tableEnv.executeSql(<span class="string">&quot;SHOW FULL MODULES&quot;</span>).print();</span><br><span class="line"><span class="comment">// +-------------+-------+</span></span><br><span class="line"><span class="comment">// | module name |  used |</span></span><br><span class="line"><span class="comment">// +-------------+-------+</span></span><br><span class="line"><span class="comment">// |        hive | false |</span></span><br><span class="line"><span class="comment">// +-------------+-------+</span></span><br></pre></td></tr></table></figure>

<h5 id="sql"><a href="#sql" class="headerlink" title="sql"></a>sql</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Show initially loaded and enabled modules</span></span><br><span class="line"><span class="keyword">SHOW</span> MODULES;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">module</span> name <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="operator">|</span>        core <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">FULL</span> MODULES;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">module</span> name <span class="operator">|</span> used <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+------+</span></span><br><span class="line"><span class="operator">|</span>        core <span class="operator">|</span> <span class="literal">true</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Load a hive module</span></span><br><span class="line">LOAD <span class="keyword">MODULE</span> hive <span class="keyword">WITH</span> (<span class="string">&#x27;hive-version&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;...&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Show all enabled modules</span></span><br><span class="line"><span class="keyword">SHOW</span> MODULES;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">module</span> name <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="operator">|</span>        core <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        hive <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Show all loaded modules with both name and use status</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">FULL</span> MODULES;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">module</span> name <span class="operator">|</span> used <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+------+</span></span><br><span class="line"><span class="operator">|</span>        core <span class="operator">|</span> <span class="literal">true</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        hive <span class="operator">|</span> <span class="literal">true</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Change resolution order</span></span><br><span class="line">USE MODULES hive, core ;</span><br><span class="line"><span class="keyword">SHOW</span> MODULES;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">module</span> name <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="operator">|</span>        hive <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        core <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">FULL</span> MODULES;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">module</span> name <span class="operator">|</span> used <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+------+</span></span><br><span class="line"><span class="operator">|</span>        hive <span class="operator">|</span> <span class="literal">true</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        core <span class="operator">|</span> <span class="literal">true</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Unload hive module</span></span><br><span class="line">UNLOAD <span class="keyword">MODULE</span> hive;</span><br><span class="line"><span class="keyword">SHOW</span> MODULES;</span><br><span class="line"><span class="keyword">Empty</span> <span class="keyword">set</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">FULL</span> MODULES;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+-------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">module</span> name <span class="operator">|</span>  used <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+-------+</span></span><br><span class="line"><span class="operator">|</span>        hive <span class="operator">|</span> <span class="literal">false</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span></span><br></pre></td></tr></table></figure>

<p>使用 SQL 时,模块名称用于执行模块发现.<br>它被解析为一个简单的标识符并且区分大小写.</p>
<h4 id="使用java"><a href="#使用java" class="headerlink" title="使用java"></a>使用java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">EnvironmentSettings settings = EnvironmentSettings.inStreamingMode();</span><br><span class="line">TableEnvironment tableEnv = TableEnvironment.create(settings);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Show initially loaded and enabled modules</span></span><br><span class="line">tableEnv.listModules();</span><br><span class="line"><span class="comment">// +-------------+</span></span><br><span class="line"><span class="comment">// | module name |</span></span><br><span class="line"><span class="comment">// +-------------+</span></span><br><span class="line"><span class="comment">// |        core |</span></span><br><span class="line"><span class="comment">// +-------------+</span></span><br><span class="line">tableEnv.listFullModules();</span><br><span class="line"><span class="comment">// +-------------+------+</span></span><br><span class="line"><span class="comment">// | module name | used |</span></span><br><span class="line"><span class="comment">// +-------------+------+</span></span><br><span class="line"><span class="comment">// |        core | true |</span></span><br><span class="line"><span class="comment">// +-------------+------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Load a hive module</span></span><br><span class="line">tableEnv.loadModule(<span class="string">&quot;hive&quot;</span>, <span class="keyword">new</span> HiveModule());</span><br><span class="line"></span><br><span class="line"><span class="comment">// Show all enabled modules</span></span><br><span class="line">tableEnv.listModules();</span><br><span class="line"><span class="comment">// +-------------+</span></span><br><span class="line"><span class="comment">// | module name |</span></span><br><span class="line"><span class="comment">// +-------------+</span></span><br><span class="line"><span class="comment">// |        core |</span></span><br><span class="line"><span class="comment">// |        hive |</span></span><br><span class="line"><span class="comment">// +-------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Show all loaded modules with both name and use status</span></span><br><span class="line">tableEnv.listFullModules();</span><br><span class="line"><span class="comment">// +-------------+------+</span></span><br><span class="line"><span class="comment">// | module name | used |</span></span><br><span class="line"><span class="comment">// +-------------+------+</span></span><br><span class="line"><span class="comment">// |        core | true |</span></span><br><span class="line"><span class="comment">// |        hive | true |</span></span><br><span class="line"><span class="comment">// +-------------+------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Change resolution order</span></span><br><span class="line">tableEnv.useModules(<span class="string">&quot;hive&quot;</span>, <span class="string">&quot;core&quot;</span>);</span><br><span class="line">tableEnv.listModules();</span><br><span class="line"><span class="comment">// +-------------+</span></span><br><span class="line"><span class="comment">// | module name |</span></span><br><span class="line"><span class="comment">// +-------------+</span></span><br><span class="line"><span class="comment">// |        hive |</span></span><br><span class="line"><span class="comment">// |        core |</span></span><br><span class="line"><span class="comment">// +-------------+</span></span><br><span class="line">tableEnv.listFullModules();</span><br><span class="line"><span class="comment">// +-------------+------+</span></span><br><span class="line"><span class="comment">// | module name | used |</span></span><br><span class="line"><span class="comment">// +-------------+------+</span></span><br><span class="line"><span class="comment">// |        hive | true |</span></span><br><span class="line"><span class="comment">// |        core | true |</span></span><br><span class="line"><span class="comment">// +-------------+------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Disable core module</span></span><br><span class="line">tableEnv.useModules(<span class="string">&quot;hive&quot;</span>);</span><br><span class="line">tableEnv.listModules();</span><br><span class="line"><span class="comment">// +-------------+</span></span><br><span class="line"><span class="comment">// | module name |</span></span><br><span class="line"><span class="comment">// +-------------+</span></span><br><span class="line"><span class="comment">// |        hive |</span></span><br><span class="line"><span class="comment">// +-------------+</span></span><br><span class="line">tableEnv.listFullModules();</span><br><span class="line"><span class="comment">// +-------------+-------+</span></span><br><span class="line"><span class="comment">// | module name |  used |</span></span><br><span class="line"><span class="comment">// +-------------+-------+</span></span><br><span class="line"><span class="comment">// |        hive |  true |</span></span><br><span class="line"><span class="comment">// |        core | false |</span></span><br><span class="line"><span class="comment">// +-------------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Unload hive module</span></span><br><span class="line">tableEnv.unloadModule(<span class="string">&quot;hive&quot;</span>);</span><br><span class="line">tableEnv.listModules();</span><br><span class="line"><span class="comment">// Empty set</span></span><br><span class="line">tableEnv.listFullModules();</span><br><span class="line"><span class="comment">// +-------------+-------+</span></span><br><span class="line"><span class="comment">// | module name |  used |</span></span><br><span class="line"><span class="comment">// +-------------+-------+</span></span><br><span class="line"><span class="comment">// |        hive | false |</span></span><br><span class="line"><span class="comment">// +-------------+-------+</span></span><br></pre></td></tr></table></figure>

<h2 id="Catalogs"><a href="#Catalogs" class="headerlink" title="Catalogs"></a>Catalogs</h2><p>Catalog 提供了元数据信息,例如数据库/表/分区/视图以及数据库或其他外部系统中存储的函数和信息.</p>
<p>数据处理最关键的方面之一是管理元数据.<br>元数据可以是临时的,例如临时表/或者通过 TableEnvironment 注册的 UDF.<br>元数据也可以是持久化的,例如 Hive Metastore 中的元数据.<br>Catalog 提供了一个统一的API,用于管理元数据,并使其可以从 Table API 和 SQL 查询语句中来访问.</p>
<h3 id="Catalog-类型"><a href="#Catalog-类型" class="headerlink" title="Catalog 类型"></a>Catalog 类型</h3><h4 id="GenericInMemoryCatalog"><a href="#GenericInMemoryCatalog" class="headerlink" title="GenericInMemoryCatalog"></a>GenericInMemoryCatalog</h4><p>GenericInMemoryCatalog 是基于内存实现的 Catalog,所有元数据只在 session 的生命周期内可用.</p>
<h4 id="JdbcCatalog"><a href="#JdbcCatalog" class="headerlink" title="JdbcCatalog"></a>JdbcCatalog</h4><p>JdbcCatalog 使得用户可以将 Flink 通过 JDBC 协议连接到关系数据库.<br>Postgres Catalog 和 MySQL Catalog 是目前 JDBC Catalog 仅有的两种实现.<br>参考 JdbcCatalog 文档 获取关于配置 JDBC catalog 的详细信息.</p>
<h4 id="HiveCatalog"><a href="#HiveCatalog" class="headerlink" title="HiveCatalog"></a>HiveCatalog</h4><p>HiveCatalog 有两个用途:作为原生 Flink 元数据的持久化存储,以及作为读写现有 Hive 元数据的接口.<br>Flink 的 Hive 文档 提供了有关设置 HiveCatalog 以及访问现有 Hive 元数据的详细信息.</p>
<p>警告 Hive Metastore 以小写形式存储所有元数据对象名称.<br>而 GenericInMemoryCatalog 区分大小写.</p>
<h4 id="用户自定义-Catalog"><a href="#用户自定义-Catalog" class="headerlink" title="用户自定义 Catalog"></a>用户自定义 Catalog</h4><p>Catalog 是可扩展的,用户可以通过实现 Catalog 接口来开发自定义 Catalog.<br>想要在 SQL CLI 中使用自定义 Catalog,用户除了需要实现自定义的 Catalog 之外,还需要为这个 Catalog 实现对应的 CatalogFactory 接口.</p>
<p>CatalogFactory 定义了一组属性,用于 SQL CLI 启动时配置 Catalog.<br>这组属性集将传递给发现服务,在该服务中,服务会尝试将属性关联到 CatalogFactory 并初始化相应的 Catalog 实例.</p>
<h3 id="如何创建-Flink-表并将其注册到-Catalog"><a href="#如何创建-Flink-表并将其注册到-Catalog" class="headerlink" title="如何创建 Flink 表并将其注册到 Catalog"></a>如何创建 Flink 表并将其注册到 Catalog</h3><h4 id="使用-SQL-DDL"><a href="#使用-SQL-DDL" class="headerlink" title="使用 SQL DDL"></a>使用 SQL DDL</h4><p>用户可以使用 DDL 通过 Table API 或者 SQL Client 在 Catalog 中创建表.</p>
<h5 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">TableEnvironment tableEnv = ...;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a HiveCatalog </span></span><br><span class="line">Catalog catalog = <span class="keyword">new</span> HiveCatalog(<span class="string">&quot;myhive&quot;</span>, <span class="keyword">null</span>, <span class="string">&quot;&lt;path_of_hive_conf&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Register the catalog</span></span><br><span class="line">tableEnv.registerCatalog(<span class="string">&quot;myhive&quot;</span>, catalog);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a catalog database</span></span><br><span class="line">tableEnv.executeSql(<span class="string">&quot;CREATE DATABASE mydb WITH (...)&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a catalog table</span></span><br><span class="line">tableEnv.executeSql(<span class="string">&quot;CREATE TABLE mytable (name STRING, age INT) WITH (...)&quot;</span>);</span><br><span class="line"></span><br><span class="line">tableEnv.listTables(); <span class="comment">// should return the tables in current catalog and database.</span></span><br></pre></td></tr></table></figure>

<h5 id="sql-1"><a href="#sql-1" class="headerlink" title="sql"></a>sql</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> the catalog should have been registered via yaml file</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE mydb <span class="keyword">WITH</span> (...);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> mytable (name STRING, age <span class="type">INT</span>) <span class="keyword">WITH</span> (...);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SHOW</span> TABLES;</span><br><span class="line">mytable</span><br></pre></td></tr></table></figure>

<h4 id="使用-Java-Scala"><a href="#使用-Java-Scala" class="headerlink" title="使用 Java/Scala"></a>使用 Java/Scala</h4><p>用户可以用编程的方式使用Java 或者 Scala 来创建 Catalog 表.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.catalog.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.catalog.hive.HiveCatalog;</span><br><span class="line"></span><br><span class="line">TableEnvironment tableEnv = TableEnvironment.create(EnvironmentSettings.inStreamingMode());</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a HiveCatalog</span></span><br><span class="line">Catalog catalog = <span class="keyword">new</span> HiveCatalog(<span class="string">&quot;myhive&quot;</span>, <span class="keyword">null</span>, <span class="string">&quot;&lt;path_of_hive_conf&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Register the catalog</span></span><br><span class="line">tableEnv.registerCatalog(<span class="string">&quot;myhive&quot;</span>, catalog);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a catalog database</span></span><br><span class="line">catalog.createDatabase(<span class="string">&quot;mydb&quot;</span>, <span class="keyword">new</span> CatalogDatabaseImpl(...));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a catalog table</span></span><br><span class="line"><span class="keyword">final</span> Schema schema = Schema.newBuilder()</span><br><span class="line">  .column(<span class="string">&quot;name&quot;</span>, DataTypes.STRING())</span><br><span class="line">  .column(<span class="string">&quot;age&quot;</span>, DataTypes.INT())</span><br><span class="line">  .build();</span><br><span class="line"></span><br><span class="line">tableEnv.createTable(<span class="string">&quot;myhive.mydb.mytable&quot;</span>, TableDescriptor.forConnector(<span class="string">&quot;kafka&quot;</span>)</span><br><span class="line">  .schema(schema)</span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line">  .build());</span><br><span class="line"></span><br><span class="line">List&lt;String&gt; tables = catalog.listTables(<span class="string">&quot;mydb&quot;</span>); <span class="comment">// tables should contain &quot;mytable&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="Catalog-API"><a href="#Catalog-API" class="headerlink" title="Catalog API"></a>Catalog API</h3><p>注意:这里只列出了编程方式的 Catalog API,用户可以使用 SQL DDL 实现许多相同的功能.<br>关于 DDL 的详细信息请参考 SQL CREATE DDL.</p>
<h4 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create database</span></span><br><span class="line">catalog.createDatabase(<span class="string">&quot;mydb&quot;</span>, <span class="keyword">new</span> CatalogDatabaseImpl(...), <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// drop database</span></span><br><span class="line">catalog.dropDatabase(<span class="string">&quot;mydb&quot;</span>, <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// alter database</span></span><br><span class="line">catalog.alterDatabase(<span class="string">&quot;mydb&quot;</span>, <span class="keyword">new</span> CatalogDatabaseImpl(...), <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// get database</span></span><br><span class="line">catalog.getDatabase(<span class="string">&quot;mydb&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// check if a database exist</span></span><br><span class="line">catalog.databaseExists(<span class="string">&quot;mydb&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// list databases in a catalog</span></span><br><span class="line">catalog.listDatabases(<span class="string">&quot;mycatalog&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="表操作"><a href="#表操作" class="headerlink" title="表操作"></a>表操作</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create table</span></span><br><span class="line">catalog.createTable(<span class="keyword">new</span> ObjectPath(<span class="string">&quot;mydb&quot;</span>, <span class="string">&quot;mytable&quot;</span>), <span class="keyword">new</span> CatalogTableImpl(...), <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// drop table</span></span><br><span class="line">catalog.dropTable(<span class="keyword">new</span> ObjectPath(<span class="string">&quot;mydb&quot;</span>, <span class="string">&quot;mytable&quot;</span>), <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// alter table</span></span><br><span class="line">catalog.alterTable(<span class="keyword">new</span> ObjectPath(<span class="string">&quot;mydb&quot;</span>, <span class="string">&quot;mytable&quot;</span>), <span class="keyword">new</span> CatalogTableImpl(...), <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// rename table</span></span><br><span class="line">catalog.renameTable(<span class="keyword">new</span> ObjectPath(<span class="string">&quot;mydb&quot;</span>, <span class="string">&quot;mytable&quot;</span>), <span class="string">&quot;my_new_table&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// get table</span></span><br><span class="line">catalog.getTable(<span class="string">&quot;mytable&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// check if a table exist or not</span></span><br><span class="line">catalog.tableExists(<span class="string">&quot;mytable&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// list tables in a database</span></span><br><span class="line">catalog.listTables(<span class="string">&quot;mydb&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="视图操作"><a href="#视图操作" class="headerlink" title="视图操作"></a>视图操作</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create view</span></span><br><span class="line">catalog.createTable(<span class="keyword">new</span> ObjectPath(<span class="string">&quot;mydb&quot;</span>, <span class="string">&quot;myview&quot;</span>), <span class="keyword">new</span> CatalogViewImpl(...), <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// drop view</span></span><br><span class="line">catalog.dropTable(<span class="keyword">new</span> ObjectPath(<span class="string">&quot;mydb&quot;</span>, <span class="string">&quot;myview&quot;</span>), <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// alter view</span></span><br><span class="line">catalog.alterTable(<span class="keyword">new</span> ObjectPath(<span class="string">&quot;mydb&quot;</span>, <span class="string">&quot;mytable&quot;</span>), <span class="keyword">new</span> CatalogViewImpl(...), <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// rename view</span></span><br><span class="line">catalog.renameTable(<span class="keyword">new</span> ObjectPath(<span class="string">&quot;mydb&quot;</span>, <span class="string">&quot;myview&quot;</span>), <span class="string">&quot;my_new_view&quot;</span>, <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// get view</span></span><br><span class="line">catalog.getTable(<span class="string">&quot;myview&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// check if a view exist or not</span></span><br><span class="line">catalog.tableExists(<span class="string">&quot;mytable&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// list views in a database</span></span><br><span class="line">catalog.listViews(<span class="string">&quot;mydb&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="分区操作"><a href="#分区操作" class="headerlink" title="分区操作"></a>分区操作</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create view</span></span><br><span class="line">catalog.createPartition(</span><br><span class="line">  <span class="keyword">new</span> ObjectPath(<span class="string">&quot;mydb&quot;</span>, <span class="string">&quot;mytable&quot;</span>),</span><br><span class="line">  <span class="keyword">new</span> CatalogPartitionSpec(...),</span><br><span class="line">  <span class="keyword">new</span> CatalogPartitionImpl(...),</span><br><span class="line">  <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// drop partition</span></span><br><span class="line">catalog.dropPartition(<span class="keyword">new</span> ObjectPath(<span class="string">&quot;mydb&quot;</span>, <span class="string">&quot;mytable&quot;</span>), <span class="keyword">new</span> CatalogPartitionSpec(...), <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// alter partition</span></span><br><span class="line">catalog.alterPartition(</span><br><span class="line">  <span class="keyword">new</span> ObjectPath(<span class="string">&quot;mydb&quot;</span>, <span class="string">&quot;mytable&quot;</span>),</span><br><span class="line">  <span class="keyword">new</span> CatalogPartitionSpec(...),</span><br><span class="line">  <span class="keyword">new</span> CatalogPartitionImpl(...),</span><br><span class="line">  <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// get partition</span></span><br><span class="line">catalog.getPartition(<span class="keyword">new</span> ObjectPath(<span class="string">&quot;mydb&quot;</span>, <span class="string">&quot;mytable&quot;</span>), <span class="keyword">new</span> CatalogPartitionSpec(...));</span><br><span class="line"></span><br><span class="line"><span class="comment">// check if a partition exist or not</span></span><br><span class="line">catalog.partitionExists(<span class="keyword">new</span> ObjectPath(<span class="string">&quot;mydb&quot;</span>, <span class="string">&quot;mytable&quot;</span>), <span class="keyword">new</span> CatalogPartitionSpec(...));</span><br><span class="line"></span><br><span class="line"><span class="comment">// list partitions of a table</span></span><br><span class="line">catalog.listPartitions(<span class="keyword">new</span> ObjectPath(<span class="string">&quot;mydb&quot;</span>, <span class="string">&quot;mytable&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// list partitions of a table under a give partition spec</span></span><br><span class="line">catalog.listPartitions(<span class="keyword">new</span> ObjectPath(<span class="string">&quot;mydb&quot;</span>, <span class="string">&quot;mytable&quot;</span>), <span class="keyword">new</span> CatalogPartitionSpec(...));</span><br><span class="line"></span><br><span class="line"><span class="comment">// list partitions of a table by expression filter</span></span><br><span class="line">catalog.listPartitions(<span class="keyword">new</span> ObjectPath(<span class="string">&quot;mydb&quot;</span>, <span class="string">&quot;mytable&quot;</span>), Arrays.asList(epr1, ...));</span><br></pre></td></tr></table></figure>

<h4 id="函数操作"><a href="#函数操作" class="headerlink" title="函数操作"></a>函数操作</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create function</span></span><br><span class="line">catalog.createFunction(<span class="keyword">new</span> ObjectPath(<span class="string">&quot;mydb&quot;</span>, <span class="string">&quot;myfunc&quot;</span>), <span class="keyword">new</span> CatalogFunctionImpl(...), <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// drop function</span></span><br><span class="line">catalog.dropFunction(<span class="keyword">new</span> ObjectPath(<span class="string">&quot;mydb&quot;</span>, <span class="string">&quot;myfunc&quot;</span>), <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// alter function</span></span><br><span class="line">catalog.alterFunction(<span class="keyword">new</span> ObjectPath(<span class="string">&quot;mydb&quot;</span>, <span class="string">&quot;myfunc&quot;</span>), <span class="keyword">new</span> CatalogFunctionImpl(...), <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// get function</span></span><br><span class="line">catalog.getFunction(<span class="string">&quot;myfunc&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// check if a function exist or not</span></span><br><span class="line">catalog.functionExists(<span class="string">&quot;myfunc&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// list functions in a database</span></span><br><span class="line">catalog.listFunctions(<span class="string">&quot;mydb&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="通过Table-API和SQL-Client操作Catalog"><a href="#通过Table-API和SQL-Client操作Catalog" class="headerlink" title="通过Table API和SQL Client操作Catalog"></a>通过Table API和SQL Client操作Catalog</h3><h4 id="注册-Catalog"><a href="#注册-Catalog" class="headerlink" title="注册 Catalog"></a>注册 Catalog</h4><p>用户可以访问默认创建的内存 Catalog default_catalog,这个 Catalog 默认拥有一个默认数据库 default_database.<br>用户也可以注册其他的 Catalog 到现有的 Flink 会话中.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tableEnv.registerCatalog(<span class="keyword">new</span> CustomCatalog(<span class="string">&quot;myCatalog&quot;</span>));</span><br></pre></td></tr></table></figure>

<h4 id="修改当前的-Catalog-和数据库"><a href="#修改当前的-Catalog-和数据库" class="headerlink" title="修改当前的 Catalog 和数据库"></a>修改当前的 Catalog 和数据库</h4><p>Flink 始终在当前的 Catalog 和数据库中寻找表/视图和 UDF.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tableEnv.useCatalog(<span class="string">&quot;myCatalog&quot;</span>);</span><br><span class="line">tableEnv.useDatabase(<span class="string">&quot;myDb&quot;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">USE CATALOG myCatalog;</span><br><span class="line">USE myDB;</span><br></pre></td></tr></table></figure>

<p>通过提供全限定名 catalog.database.object 来访问不在当前 Catalog 中的元数据信息.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tableEnv.from(<span class="string">&quot;not_the_current_catalog.not_the_current_db.my_table&quot;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> not_the_current_catalog.not_the_current_db.my_table;</span><br></pre></td></tr></table></figure>

<h4 id="列出可用的-Catalog"><a href="#列出可用的-Catalog" class="headerlink" title="列出可用的 Catalog"></a>列出可用的 Catalog</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tableEnv.listCatalogs();</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> catalogs;</span><br></pre></td></tr></table></figure>

<h4 id="列出可用的数据库"><a href="#列出可用的数据库" class="headerlink" title="列出可用的数据库"></a>列出可用的数据库</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tableEnv.listDatabases();</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> databases;</span><br></pre></td></tr></table></figure>

<h4 id="列出可用的表"><a href="#列出可用的表" class="headerlink" title="列出可用的表"></a>列出可用的表</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tableEnv.listTables();</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> tables;</span><br></pre></td></tr></table></figure>

<h2 id="SQL-客户端"><a href="#SQL-客户端" class="headerlink" title="SQL 客户端"></a>SQL 客户端</h2><h3 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h3><p>本节介绍如何在命令行里启动(setup)和运行你的第一个 Flink SQL 程序.</p>
<p>SQL 客户端捆绑在常规 Flink 发行版中,因此可以直接运行.<br>它仅需要一个正在运行的 Flink 集群就可以在其中执行表程序.<br>有关设置 Flink 群集的更多信息,请参见集群和部署部分.<br>如果仅想试用 SQL 客户端,也可以使用以下命令启动本地集群:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/start-cluster.sh</span><br></pre></td></tr></table></figure>

<h4 id="启动-SQL-客户端命令行界面"><a href="#启动-SQL-客户端命令行界面" class="headerlink" title="启动 SQL 客户端命令行界面"></a>启动 SQL 客户端命令行界面</h4><p>SQL Client 脚本也位于 Flink 的 bin 目录中.<br>将来,用户可以通过启动嵌入式 standalone 进程或通过连接到远程 SQL 客户端网关来启动 SQL 客户端命令行界面.<br>目前仅支持 embedded,模式默认值embedded.<br>可以通过以下方式启动 CLI:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/sql-client.sh</span><br></pre></td></tr></table></figure>

<p>或者显式使用 embedded 模式:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/sql-client.sh embedded</span><br></pre></td></tr></table></figure>

<h4 id="执行-SQL-查询"><a href="#执行-SQL-查询" class="headerlink" title="执行 SQL 查询"></a>执行 SQL 查询</h4><p>命令行界面启动后,你可以使用 HELP 命令列出所有可用的 SQL 语句.<br>输入第一条 SQL 查询语句并按 Enter 键执行,可以验证你的设置及集群连接是否正确:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;Hello World&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>该查询不需要 table source,并且只产生一行结果.<br>CLI 将从集群中检索结果并将其可视化.<br>按 Q 键退出结果视图.</p>
<p>CLI 为维护和可视化结果提供三种模式.</p>
<ol>
<li><p>表格模式(table mode)在内存中实体化结果,并将结果用规则的分页表格可视化展示出来.<br>执行如下命令启用:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="string">&#x27;sql-client.execution.result-mode&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;table&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>变更日志模式(changelog mode)不会实体化和可视化结果,而是由插入(+)和撤销(-)组成的持续查询产生结果流.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="string">&#x27;sql-client.execution.result-mode&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;changelog&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Tableau模式(tableau mode)更接近传统的数据库,会将执行的结果以制表的形式直接打在屏幕之上.<br>具体显示的内容会取决于作业 执行模式的不同(execution.type):</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="string">&#x27;sql-client.execution.result-mode&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;tableau&#x27;</span>;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>注意当你使用这个模式运行一个流式查询的时候,Flink 会将结果持续的打印在当前的屏幕之上.<br>如果这个流式查询的输入是有限的数据集, 那么Flink在处理完所有的数据之后,会自动的停止作业,同时屏幕上的打印也会相应的停止.<br>如果你想提前结束这个查询,那么可以直接使用 CTRL-C 按键,这个会停掉作业同时停止屏幕上的打印.</p>
<p>你可以用如下查询来查看三种结果模式的运行情况:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> cnt <span class="keyword">FROM</span> (<span class="keyword">VALUES</span> (<span class="string">&#x27;Bob&#x27;</span>), (<span class="string">&#x27;Alice&#x27;</span>), (<span class="string">&#x27;Greg&#x27;</span>), (<span class="string">&#x27;Bob&#x27;</span>)) <span class="keyword">AS</span> NameTable(name) <span class="keyword">GROUP</span> <span class="keyword">BY</span> name;</span><br></pre></td></tr></table></figure>

<p>此查询执行一个有限字数示例:<br>变更日志模式 下,看到的结果应该类似于:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ Bob, 1</span><br><span class="line">+ Alice, 1</span><br><span class="line">+ Greg, 1</span><br><span class="line">- Bob, 1</span><br><span class="line">+ Bob, 2</span><br></pre></td></tr></table></figure>

<p>表格模式 下,可视化结果表将不断更新,直到表程序以如下内容结束:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Bob, 2</span><br><span class="line">Alice, 1</span><br><span class="line">Greg, 1</span><br></pre></td></tr></table></figure>

<p>Tableau模式 下,如果这个查询以流的方式执行,那么将显示以下内容:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+-----+----------------------+----------------------+</span><br><span class="line">| +&#x2F;- |                 name |                  cnt |</span><br><span class="line">+-----+----------------------+----------------------+</span><br><span class="line">|   + |                  Bob |                    1 |</span><br><span class="line">|   + |                Alice |                    1 |</span><br><span class="line">|   + |                 Greg |                    1 |</span><br><span class="line">|   - |                  Bob |                    1 |</span><br><span class="line">|   + |                  Bob |                    2 |</span><br><span class="line">+-----+----------------------+----------------------+</span><br><span class="line">Received a total of 5 rows</span><br></pre></td></tr></table></figure>

<p>如果这个查询以批的方式执行,显示的内容如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------+-----+</span><br><span class="line">|  name | cnt |</span><br><span class="line">+-------+-----+</span><br><span class="line">| Alice |   1 |</span><br><span class="line">|   Bob |   2 |</span><br><span class="line">|  Greg |   1 |</span><br><span class="line">+-------+-----+</span><br><span class="line">3 rows in set</span><br></pre></td></tr></table></figure>

<p>这几种结果模式在 SQL 查询的原型设计过程中都非常有用.<br>这些模式的结果都存储在 SQL 客户端 的 Java 堆内存中.<br>为了保持 CLI 界面及时响应,变更日志模式仅显示最近的 1000 个更改.<br>表格模式支持浏览更大的结果,这些结果仅受可用主内存和配置的最大行数(<code>sql-client.execution.max-table-result.rows</code>)的限制.</p>
<p>注意:在批处理环境下执行的查询只能用表格模式或者Tableau模式进行检索.</p>
<p>定义查询语句后,可以将其作为长时间运行的独立 Flink 作业提交给集群.<br>配置部分解释如何声明读取数据的 table source,写入数据的 sink 以及配置其他表程序属性的方法.</p>
<h3 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h3><h4 id="SQL-Client-startup-options"><a href="#SQL-Client-startup-options" class="headerlink" title="SQL Client startup options"></a>SQL Client startup options</h4><p><code>./bin/sql-client.sh --help</code><br>Mode &quot;embedded&quot; (default) submits Flink jobs from the local machine.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Syntax: [embedded] [OPTIONS]</span><br><span class="line">&quot;embedded&quot; mode options:</span><br><span class="line">-f,--file &lt;script file&gt;               应该被执行的脚本文件.在这种模式下,客户端不会打开交互式终端.</span><br><span class="line">-h,--help                             显示带有所有选项描述的帮助消息.</span><br><span class="line">-hist,--history &lt;History file path&gt;   要保存命令历史的文件.如果未指定,我们将在您用户的主目录下自动生成一个.</span><br><span class="line">-i,--init &lt;initialization file&gt;       用于初始化会话上下文的脚本文件.如果执行出错,sql客户端将退出.请注意,不允许在 init 文件中添加查询或插入.</span><br><span class="line">-i,--init &lt;initialization file&gt;       用于初始化会话上下文的脚本文件.如果执行出错,sql客户端将退出.请注意,不允许在 init 文件中添加查询或插入.</span><br><span class="line">-j,--jar &lt;JAR file&gt;                   要导入会话的JAR文件.该文件可能包含执行语句所需的用户定义类,例如函数&#x2F;表源&#x2F;接收器.可以多次使用.</span><br><span class="line">-l,--library &lt;JAR directory&gt;          一个JAR文件目录,用于初始化每个新会话.这些文件可能包含执行语句所需的用户定义类,例如函数&#x2F;表源&#x2F;接收器.可以多次使用.</span><br><span class="line">-s,--session &lt;session identifier&gt;     会话的标识符.&#39;default&#39; 是默认标识符.</span><br><span class="line">-u,--update &lt;SQL update statement&gt;    不推荐使用,实验性(仅用于测试)功能:指示SQL客户端在启动后立即执行给定的更新语句.在语句提交到集群并返回适当的返回码后,该进程将关闭.目前,此功能仅支持声明目标 sink 表的 INSERT INTO 语句.请使用选项 -f 提交更新语句.</span><br></pre></td></tr></table></figure>

<h4 id="SQL-Client-Configuration"><a href="#SQL-Client-Configuration" class="headerlink" title="SQL Client Configuration"></a>SQL Client Configuration</h4><p><code>sql-client.display.max-column-width</code><br>Streaming/30/Integer<br>打印查询结果时,此参数确定截断前屏幕上显示的字符数.<br>这仅适用于流模式下具有可变长度类型(例如 STRING)的列.<br>定长类型和批处理模式下的所有类型都使用打印确定的列宽.</p>
<p><code>sql-client.execution.max-table-result.rows</code><br>Batch Streaming/1000000/Integer<br>在表模式下要缓存的行数.<br>如果行数超过指定值,则以 FIFO 样式重试该行.</p>
<p><code>sql-client.execution.result-mode</code><br>Batch Streaming/TABLE/Enum<br>确定应如何显示查询结果.<br>可能的值:<br>&quot;TABLE&quot;:在内存中具体化结果,并以常规的分页表表示形式将它们可视化.<br>&quot;CHANGELOG&quot;:可视化由连续查询产生的结果流.<br>&quot;TABLEAU&quot;:以表格格式直接在屏幕上显示结果.</p>
<p><code>sql-client.verbose</code><br>Batch Streaming/false/Boolean<br>确定是否将详细输出输出到控制台.<br>如果将选项设置为 true,它将打印异常堆栈.<br>否则,它只输出原因.</p>
<h4 id="使用-SQL-文件初始化会话"><a href="#使用-SQL-文件初始化会话" class="headerlink" title="使用 SQL 文件初始化会话"></a>使用 SQL 文件初始化会话</h4><p>SQL 查询需要一个执行它的配置环境.<br>SQL Client 支持<code>-i</code> 启动选项以在启动 SQL Client 时执行初始化 SQL 文件来设置环境.<br>所谓初始化 SQL 文件,可以使用 DDL 来定义可用的目录/表源和汇/用户定义的函数以及执行和部署所需的其他属性.<br>下面介绍了此类文件的一个示例.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Define available catalogs</span></span><br><span class="line"><span class="keyword">CREATE</span> CATALOG MyCatalog</span><br><span class="line"> <span class="keyword">WITH</span> (</span><br><span class="line">  <span class="string">&#x27;type&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;hive&#x27;</span></span><br><span class="line"> );</span><br><span class="line"></span><br><span class="line">USE CATALOG MyCatalog;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Define available database</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE MyDatabase;</span><br><span class="line"></span><br><span class="line">USE MyDatabase;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Define TABLE</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> MyTable(</span><br><span class="line"> MyField1 <span class="type">INT</span>,</span><br><span class="line"> MyField2 STRING</span><br><span class="line">) <span class="keyword">WITH</span> (</span><br><span class="line"> <span class="string">&#x27;connector&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;filesystem&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;path&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;/path/to/something&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;format&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;csv&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Define VIEW</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> MyCustomView <span class="keyword">AS</span> <span class="keyword">SELECT</span> MyField2 <span class="keyword">FROM</span> MyTable;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Define user-defined functions here.</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> foo.bar.AggregateUDF <span class="keyword">AS</span> myUDF;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Properties that change the fundamental execution behavior of a table program.</span></span><br><span class="line"><span class="keyword">SET</span> <span class="string">&#x27;execution.runtime-mode&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;streaming&#x27;</span>; <span class="comment">-- execution mode either &#x27;batch&#x27; or &#x27;streaming&#x27;</span></span><br><span class="line"><span class="keyword">SET</span> <span class="string">&#x27;sql-client.execution.result-mode&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;table&#x27;</span>; <span class="comment">-- available values: &#x27;table&#x27;, &#x27;changelog&#x27; and &#x27;tableau&#x27;</span></span><br><span class="line"><span class="keyword">SET</span> <span class="string">&#x27;sql-client.execution.max-table-result.rows&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;10000&#x27;</span>; <span class="comment">-- optional: maximum number of maintained rows</span></span><br><span class="line"><span class="keyword">SET</span> <span class="string">&#x27;parallelism.default&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span>; <span class="comment">-- optional: Flink&#x27;s parallelism (1 by default)</span></span><br><span class="line"><span class="keyword">SET</span> <span class="string">&#x27;pipeline.auto-watermark-interval&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;200&#x27;</span>; <span class="comment">--optional: interval for periodic watermarks</span></span><br><span class="line"><span class="keyword">SET</span> <span class="string">&#x27;pipeline.max-parallelism&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;10&#x27;</span>; <span class="comment">-- optional: Flink&#x27;s maximum parallelism</span></span><br><span class="line"><span class="keyword">SET</span> <span class="string">&#x27;table.exec.state.ttl&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;1000&#x27;</span>; <span class="comment">-- optional: table program&#x27;s idle state time</span></span><br><span class="line"><span class="keyword">SET</span> <span class="string">&#x27;restart-strategy&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;fixed-delay&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Configuration options for adjusting and tuning table programs.</span></span><br><span class="line"><span class="keyword">SET</span> <span class="string">&#x27;table.optimizer.join-reorder-enabled&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;true&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="string">&#x27;table.exec.spill-compression.enabled&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;true&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="string">&#x27;table.exec.spill-compression.block-size&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;128kb&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>这个配置:</p>
<ol>
<li>连接到 Hive 目录并MyCatalog用作当前目录和目录MyDatabase的当前数据库.</li>
<li>定义一个MyTableSource可以从 CSV 文件中读取数据的表.</li>
<li>定义一个MyCustomView使用 SQL 查询声明虚拟表的视图.</li>
<li>myUDF定义一个可以使用类名实例化的用户定义函数.</li>
<li>使用流模式运行语句.并行度为 1.</li>
<li>在table结果模式下运行探索性查询.</li>
<li>并通过配置选项围绕连接重新排序和溢出进行一些规划器调整.</li>
</ol>
<p>使用-i &lt;init.sql&gt;选项初始化 SQL 客户端会话时,初始化 SQL 文件中允许使用以下语句:<br>DDL(CREATE/DROP/ALTER),<br>USE CATALOG/DATABASE,<br>LOAD/UNLOAD MODULE,<br>SET command,<br>RESET command.</p>
<p>执行查询或插入语句时,请进入交互模式或使用 -f 选项提交 SQL 语句.<br>注意:如果 SQL 客户端在初始化期间收到错误,SQL 客户端将退出并显示错误消息.</p>
<h4 id="依赖项"><a href="#依赖项" class="headerlink" title="依赖项"></a>依赖项</h4><p>SQL 客户端不需要使用 Maven/Gradle 或 sbt 设置 Java 项目.相反,您可以将依赖项作为提交到集群的常规 JAR 文件传递.您可以单独指定每个 JAR 文件(使用--jar)或定义整个库目录(使用--library).对于外部系统的连接器(如 Apache Kafka)和相应的数据格式(如 JSON),Flink 提供了现成的 JAR 包.可以从 Maven 中央存储库为每个版本下载这些 JAR 文件.</p>
<h3 id="使用-SQL-客户端提交作业"><a href="#使用-SQL-客户端提交作业" class="headerlink" title="使用 SQL 客户端提交作业"></a>使用 SQL 客户端提交作业</h3><p>SQL 客户端允许用户在交互式命令行中或使用<code>-f</code>选项来执行 sql 文件来提交作业.<br>在这两种模式下,SQL Client 都支持解析和执行 Flink 支持的所有类型的 SQL 语句.</p>
<h4 id="交互式命令行"><a href="#交互式命令行" class="headerlink" title="交互式命令行"></a>交互式命令行</h4><p>在交互式命令行中,SQL 客户端读取用户输入并执行以分号 (;) 结尾的语句.</p>
<p>如果语句执行成功,SQL 客户端将打印成功消息.当出现错误时,SQL Client 也会打印错误信息.默认情况下,错误消息只包含错误原因.<br>为了打印完整的异常堆栈以进行调试,请sql-client.verbose通过command将设置为true.<br>SET &#39;sql-client.verbose&#39; = &#39;true&#39;;.</p>
<h4 id="执行-SQL-文件"><a href="#执行-SQL-文件" class="headerlink" title="执行 SQL 文件"></a>执行 SQL 文件</h4><p>-fSQL 客户端支持使用该选项执行 SQL 脚本文件.SQL Client 会一一执行 SQL 脚本文件中的语句,并打印每个执行语句的执行消息.一旦语句失败,SQL 客户端将退出,并且所有剩余的语句都不会执行.</p>
<p>下面介绍了此类文件的一个示例.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> TEMPORARY <span class="keyword">TABLE</span> users (</span><br><span class="line"> user_id <span class="type">BIGINT</span>,</span><br><span class="line"> user_name STRING,</span><br><span class="line"> user_level STRING,</span><br><span class="line"> region STRING,</span><br><span class="line"> <span class="keyword">PRIMARY</span> KEY (user_id) <span class="keyword">NOT</span> ENFORCED</span><br><span class="line">) <span class="keyword">WITH</span> (</span><br><span class="line"> <span class="string">&#x27;connector&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;upsert-kafka&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;topic&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;users&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;properties.bootstrap.servers&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;...&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;key.format&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;csv&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;value.format&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;avro&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- set sync mode</span></span><br><span class="line"><span class="keyword">SET</span> <span class="string">&#x27;table.dml-sync&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;true&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- set the job name</span></span><br><span class="line"><span class="keyword">SET</span> <span class="string">&#x27;pipeline.name&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;SqlJob&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- set the queue that the job submit to</span></span><br><span class="line"><span class="keyword">SET</span> <span class="string">&#x27;yarn.application.queue&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- set the job parallelism</span></span><br><span class="line"><span class="keyword">SET</span> <span class="string">&#x27;parallelism.default&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;100&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- restore from the specific savepoint path</span></span><br><span class="line"><span class="keyword">SET</span> <span class="string">&#x27;execution.savepoint.path&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;/tmp/flink-savepoints/savepoint-cca7bc-bb1e257f0dab&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> pageviews_enriched</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> pageviews <span class="keyword">AS</span> p</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> users <span class="keyword">FOR</span> <span class="built_in">SYSTEM_TIME</span> <span class="keyword">AS</span> <span class="keyword">OF</span> p.proctime <span class="keyword">AS</span> u</span><br><span class="line"><span class="keyword">ON</span> p.user_id <span class="operator">=</span> u.user_id;</span><br></pre></td></tr></table></figure>

<p>这个配置:<br>定义users从 CSV 文件读取的时态表源,<br>设置属性,例如作业名称,<br>设置保存点路径,<br>提交从指定保存点路径加载保存点的 sql 作业.<br>注意与交互模式相比,SQL Client 在出现错误时会停止执行并退出.</p>
<h4 id="执行一组-SQL-语句"><a href="#执行一组-SQL-语句" class="headerlink" title="执行一组 SQL 语句"></a>执行一组 SQL 语句</h4><p>SQL 客户端将每个 INSERT INTO 语句作为单个 Flink 作业执行.<br>然而,这有时不是最优的,因为管道的某些部分可以重复使用.<br>SQL Client 支持 STATEMENT SET 语法来执行一组 SQL 语句.<br>这是 Table API 中 StatementSet 的等效功能.<br>STATEMENT SET语法包含一个或多个INSERT INTO语句.<br>块中的所有语句STATEMENT SET 都经过整体优化并作为单个 Flink 作业执行.<br>联合优化和执行允许重用公共中间结果,因此可以显着提高执行多个查询的效率.</p>
<blockquote>
<p>语法</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXECUTE</span> STATEMENT <span class="keyword">SET</span> </span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"> <span class="comment">-- one or more INSERT INTO statements</span></span><br><span class="line"> &#123; INSERT INTO|OVERWRITE &lt;select_statement&gt;; &#125;+</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<p>括在中的语句STATEMENT SET必须用分号 (;) 分隔.<br>旧语法BEGIN STATEMENT SET; ... END;已弃用,可能会在未来版本中删除.</p>
<h5 id="SQL-CLI"><a href="#SQL-CLI" class="headerlink" title="SQL CLI"></a>SQL CLI</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> pageviews (</span><br><span class="line">  user_id <span class="type">BIGINT</span>,</span><br><span class="line">  page_id <span class="type">BIGINT</span>,</span><br><span class="line">  viewtime <span class="type">TIMESTAMP</span>,</span><br><span class="line">  proctime <span class="keyword">AS</span> PROCTIME()</span><br><span class="line">) <span class="keyword">WITH</span> (</span><br><span class="line">  <span class="string">&#x27;connector&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;kafka&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;topic&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;pageviews&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;properties.bootstrap.servers&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;...&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;format&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;avro&#x27;</span></span><br><span class="line">);</span><br><span class="line">[INFO] <span class="keyword">Execute</span> statement succeed.</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> pageview (</span><br><span class="line">  page_id <span class="type">BIGINT</span>,</span><br><span class="line">  cnt <span class="type">BIGINT</span></span><br><span class="line">) <span class="keyword">WITH</span> (</span><br><span class="line">  <span class="string">&#x27;connector&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;jdbc&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;url&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;jdbc:mysql://localhost:3306/mydatabase&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;table-name&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;pageview&#x27;</span></span><br><span class="line">);</span><br><span class="line">[INFO] <span class="keyword">Execute</span> statement succeed.</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> uniqueview (</span><br><span class="line">  page_id <span class="type">BIGINT</span>,</span><br><span class="line">  cnt <span class="type">BIGINT</span></span><br><span class="line">) <span class="keyword">WITH</span> (</span><br><span class="line">  <span class="string">&#x27;connector&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;jdbc&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;url&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;jdbc:mysql://localhost:3306/mydatabase&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;table-name&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;uniqueview&#x27;</span></span><br><span class="line">);</span><br><span class="line">[INFO] <span class="keyword">Execute</span> statement succeed.</span><br><span class="line"></span><br><span class="line"><span class="keyword">EXECUTE</span> STATEMENT <span class="keyword">SET</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> pageview</span><br><span class="line"><span class="keyword">SELECT</span> page_id, <span class="built_in">count</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">FROM</span> pageviews</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> page_id;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> uniqueview</span><br><span class="line"><span class="keyword">SELECT</span> page_id, <span class="built_in">count</span>(<span class="keyword">distinct</span> user_id)</span><br><span class="line"><span class="keyword">FROM</span> pageviews</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> page_id;</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line">[INFO] Submitting <span class="keyword">SQL</span> update statement <span class="keyword">to</span> the cluster...</span><br><span class="line">[INFO] <span class="keyword">SQL</span> update statement has been successfully submitted <span class="keyword">to</span> the cluster:</span><br><span class="line">Job ID: <span class="number">6</span>b1af540c0c0bb3fcfcad50ac037c862</span><br></pre></td></tr></table></figure>

<h5 id="SQL-File"><a href="#SQL-File" class="headerlink" title="SQL File"></a>SQL File</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> pageviews (</span><br><span class="line">  user_id <span class="type">BIGINT</span>,</span><br><span class="line">  page_id <span class="type">BIGINT</span>,</span><br><span class="line">  viewtime <span class="type">TIMESTAMP</span>,</span><br><span class="line">  proctime <span class="keyword">AS</span> PROCTIME()</span><br><span class="line">) <span class="keyword">WITH</span> (</span><br><span class="line">  <span class="string">&#x27;connector&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;kafka&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;topic&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;pageviews&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;properties.bootstrap.servers&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;...&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;format&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;avro&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> pageview (</span><br><span class="line">  page_id <span class="type">BIGINT</span>,</span><br><span class="line">  cnt <span class="type">BIGINT</span></span><br><span class="line">) <span class="keyword">WITH</span> (</span><br><span class="line">  <span class="string">&#x27;connector&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;jdbc&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;url&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;jdbc:mysql://localhost:3306/mydatabase&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;table-name&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;pageview&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> uniqueview (</span><br><span class="line">  page_id <span class="type">BIGINT</span>,</span><br><span class="line">  cnt <span class="type">BIGINT</span></span><br><span class="line">) <span class="keyword">WITH</span> (</span><br><span class="line">  <span class="string">&#x27;connector&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;jdbc&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;url&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;jdbc:mysql://localhost:3306/mydatabase&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;table-name&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;uniqueview&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">EXECUTE</span> STATEMENT <span class="keyword">SET</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> pageview</span><br><span class="line"><span class="keyword">SELECT</span> page_id, <span class="built_in">count</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">FROM</span> pageviews</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> page_id;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> uniqueview</span><br><span class="line"><span class="keyword">SELECT</span> page_id, <span class="built_in">count</span>(<span class="keyword">distinct</span> user_id)</span><br><span class="line"><span class="keyword">FROM</span> pageviews</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> page_id;</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<h4 id="执行-DML-语句同步-异步"><a href="#执行-DML-语句同步-异步" class="headerlink" title="执行 DML 语句同步/异步"></a>执行 DML 语句同步/异步</h4><p>默认情况下,SQL 客户端异步执行 DML 语句.<br>这意味着,SQL Client 会将 DML 语句的作业提交到 Flink 集群,而不是等待作业完成.<br>所以 SQL Client 可以同时提交多个作业.<br>这对于通常长时间运行的流式作业很有用.</p>
<p>SQL Client 确保语句成功提交到集群.<br>提交语句后,CLI 将显示有关 Flink 作业的信息.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> MyTableSink <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> MyTableSource;</span><br><span class="line">[INFO] <span class="keyword">Table</span> update statement has been successfully submitted <span class="keyword">to</span> the cluster:</span><br><span class="line">Cluster ID: StandaloneClusterId</span><br><span class="line">Job ID: <span class="number">6</span>f922fe5cba87406ff23ae4a7bb79044</span><br></pre></td></tr></table></figure>

<p>SQL Client 在提交后不会跟踪正在运行的 Flink 作业的状态.<br>提交后可以关闭 CLI 进程,而不影响分离的查询.<br>Flinkrestart strategy负责容错.<br>可以使用 Flink 的 Web 界面/命令行或 REST API 取消查询.</p>
<p>但是,对于批处理用户来说,下一个 DML 语句需要等到前一个 DML 语句完成才更常见.<br>为了同步执行 DML 语句,您可以 在 SQL Client中设置table.dml-sync选项.<br>true.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="string">&#x27;table.dml-sync&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;true&#x27;</span>;</span><br><span class="line">[INFO] Session property has been set.</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> MyTableSink <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> MyTableSource;</span><br><span class="line">[INFO] Submitting <span class="keyword">SQL</span> update statement <span class="keyword">to</span> the cluster...</span><br><span class="line">[INFO] <span class="keyword">Execute</span> statement <span class="keyword">in</span> sync mode. Please wait <span class="keyword">for</span> the execution finish...</span><br><span class="line">[INFO] Complete execution <span class="keyword">of</span> the <span class="keyword">SQL</span> update statement.</span><br></pre></td></tr></table></figure>

<p>如果要终止作业,只需键入CTRL-C取消执行即可.</p>
<h4 id="从保存点启动-SQL-作业"><a href="#从保存点启动-SQL-作业" class="headerlink" title="从保存点启动 SQL 作业"></a>从保存点启动 SQL 作业</h4><p>Flink 支持使用指定的保存点启动作业.<br>在 SQL Client 中,允许使用SET命令指定保存点的路径.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="string">&#x27;execution.savepoint.path&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;/tmp/flink-savepoints/savepoint-cca7bc-bb1e257f0dab&#x27;</span>;</span><br><span class="line">[INFO] Session property has been set.</span><br><span class="line"></span><br><span class="line"><span class="comment">-- all the following DML statements will be restroed from the specified savepoint path</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> ...</span><br></pre></td></tr></table></figure>

<p>当指定保存点的路径时,Flink 将在执行以下所有 DML 语句时尝试从保存点恢复状态.<br>因为指定的保存点路径会影响后面的所有 DML 语句,您可以使用RESET命令重置此配置选项,即禁用从保存点恢复.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RESET execution.savepoint.path;</span><br><span class="line">[INFO] Session property has been reset.</span><br></pre></td></tr></table></figure>

<h4 id="定义自定义作业名称"><a href="#定义自定义作业名称" class="headerlink" title="定义自定义作业名称"></a>定义自定义作业名称</h4><p>SQL Client 支持通过SET命令定义查询和 DML 语句的作业名称.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="string">&#x27;pipeline.name&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;kafka-to-hive&#x27;</span>;</span><br><span class="line">[INFO] Session property has been set.</span><br><span class="line"></span><br><span class="line"><span class="comment">-- all the following DML statements will use the specified job name.</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> ...</span><br></pre></td></tr></table></figure>

<p>因为指定的作业名会影响后面所有的查询和DML语句,所以也可以使用RESET命令重置这个配置,即使用默认的作业名.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RESET pipeline.name;</span><br><span class="line">[INFO] Session property has been reset.</span><br></pre></td></tr></table></figure>

<p>如果pipeline.name未指定该选项,SQL 客户端将为提交的作业生成一个默认名称,例如insert-into_<code>&lt;sink_table_name&gt;</code>语句INSERT INTO.</p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>Table 和 SQL API 的默认配置能够确保结果准确,同时也提供可接受的性能.</p>
<p>根据 Table 程序的需求,可能需要调整特定的参数用于优化.<br>例如,无界流程序可能需要保证所需的状态是有限的(请参阅 流式概念).</p>
<h3 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h3><p>在每个 TableEnvironment 中,TableConfig 提供用于当前会话的配置项.<br>对于常见或者重要的配置项,TableConfig 提供带有详细注释的 getters 和 setters 方法.</p>
<p>对于更加高级的配置,用户可以直接访问底层的 key-value 配置项.<br>以下章节列举了所有可用于调整 Flink Table 和 SQL API 程序的配置项.</p>
<p>注意:因为配置项会在执行操作的不同时间点被读取,所以推荐在实例化 TableEnvironment 后尽早地设置配置项.</p>
<h4 id="Java-1"><a href="#Java-1" class="headerlink" title="Java"></a>Java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// instantiate table environment</span></span><br><span class="line">TableEnvironment tEnv = ...;</span><br><span class="line"></span><br><span class="line"><span class="comment">// access flink configuration</span></span><br><span class="line">TableConfig configuration = tEnv.getConfig();</span><br><span class="line"><span class="comment">// set low-level key-value options</span></span><br><span class="line">configuration.set(<span class="string">&quot;table.exec.mini-batch.enabled&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">configuration.set(<span class="string">&quot;table.exec.mini-batch.allow-latency&quot;</span>, <span class="string">&quot;5 s&quot;</span>);</span><br><span class="line">configuration.set(<span class="string">&quot;table.exec.mini-batch.size&quot;</span>, <span class="string">&quot;5000&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="sql-2"><a href="#sql-2" class="headerlink" title="sql"></a>sql</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="string">&#x27;table.exec.mini-batch.enabled&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;true&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="string">&#x27;table.exec.mini-batch.allow-latency&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;5s&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="string">&#x27;table.exec.mini-batch.size&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;5000&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="执行配置"><a href="#执行配置" class="headerlink" title="执行配置"></a>执行配置</h3><p>以下选项可用于优化查询执行的性能.</p>
<p><code>table.exec.async-lookup.buffer-capacity</code><br>Batch Streaming/100/Integer<br>异步查找连接可以触发的最大异步 i/o 操作数.</p>
<p><code>table.exec.async-lookup.timeout</code><br>Batch Streaming/3 min/Duration<br>异步操作完成的异步超时.</p>
<p><code>table.exec.deduplicate.insert-update-after-sensitive-enabled</code><br>Streaming/true/Boolean<br>设置作业(尤其是接收器)是否对 INSERT 消息和 UPDATE_AFTER 消息敏感.<br>如果为 false,Flink 有时(例如最后一行的重复数据删除)可能会为第一行发送 UPDATE_AFTER 而不是 INSERT.<br>如果为真,Flink 将保证为第一行发送 INSERT,在这种情况下会有额外的开销.<br>默认为真.</p>
<p><code>table.exec.deduplicate.mini-batch.compact-changes-enabled</code><br>Streaming/false/Boolean<br>设置是否压缩行时间小批量发送到下游的更改.<br>如果为 true,Flink 将压缩更改并仅将最新更改发送到下游.<br>请注意,如果下游需要版本化数据的详细信息,则无法应用此优化.<br>如果为 false,Flink 会将所有更改发送到下游,就像未启用小批量时一样.</p>
<p><code>table.exec.disabled-operators</code><br>Batch/(none)/String<br>主要用于测试.<br>逗号分隔的运算符名称列表,每个名称代表一种禁用的运算符.<br>可以禁用的运算符包括&quot;NestedLoopJoin&quot;/&quot;ShuffleHashJoin&quot;/&quot;BroadcastHashJoin&quot;/&quot;SortMergeJoin&quot;/&quot;HashAgg&quot;/&quot;SortAgg&quot;.<br>默认情况下,没有禁用任何运算符.</p>
<p><code>table.exec.legacy-cast-behaviour</code><br>Batch Streaming/DISABLED/Enum<br>确定 CAST 是遵循旧行为还是引入各种修复和改进的新行为.</p>
<p>可能的值:<br>&quot;ENABLED&quot;:CAST 将按照传统行为运行.<br>&quot;DISABLED&quot;:CAST 将按照新的正确行为运行.</p>
<p><code>table.exec.mini-batch.allow-latency</code><br>Streaming/0 ms/Duration<br>MiniBatch 可以使用最大延迟来缓冲输入记录.<br>MiniBatch 是缓冲输入记录以减少状态访问的优化.<br>MiniBatch 在允许的延迟间隔和达到最大缓冲记录数时触发.<br>注意:如果 table.exec.mini-batch.enabled 设置为 true,则其值必须大于0.</p>
<p><code>table.exec.mini-batch.enabled</code><br>Streaming/false/Boolean<br>指定是否启用 MiniBatch 优化.<br>MiniBatch 是缓冲输入记录以减少状态访问的优化.<br>默认情况下禁用此功能.<br>要启用此功能,用户应将此配置设置为 true.<br>注意:如果启用了小批量,则必须设置&quot;table.exec.mini-batch.allow-latency&quot;和&quot;table.exec.mini-batch.size&quot;.</p>
<p><code>table.exec.mini-batch.size</code><br>Streaming/-1/Long<br>MiniBatch 可以缓冲的最大输入记录数.<br>MiniBatch 是缓冲输入记录以减少状态访问的优化.<br>MiniBatch 在允许的延迟间隔和达到最大缓冲记录数时触发.<br>注意:MiniBatch 目前仅适用于非窗口聚合.<br>如果 table.exec.mini-batch.enabled 设置为 true,则其值必须为正.</p>
<p><code>table.exec.rank.topn-cache-size</code><br>Streaming/10000/Long<br>Rank 算子有一个缓存,它缓存部分状态内容以减少状态访问.<br>缓存大小是每个排名任务中的记录数.</p>
<p><code>table.exec.resource.default-parallelism</code><br>Batch Streaming/-1/Integer<br>为所有运算符(例如聚合/连接/过滤器)设置默认并行度,以与并行实例一起运行.<br>此配置的优先级高于 StreamExecutionEnvironment 的并行度(实际上,此配置覆盖了 StreamExecutionEnvironment 的并行度).<br>值为 -1 表示未设置默认并行度,然后将回退使用 StreamExecutionEnvironment 的并行度.</p>
<p><code>table.exec.simplify-operator-name-enabled</code><br>Batch Streaming/true/Boolean<br>当它为真时,优化器将使用 ExecNode 的 id 和类型简化运算符名称,并在描述中保留详细信息.<br>默认值为真.</p>
<p><code>table.exec.sink.keyed-shuffle</code><br>Streaming/AUTO/Enum<br>为了最大程度地减少许多用户在使用主键将数据写入表时的分布式混乱问题.<br>当 sink 的并行度与上游操作符不同且上游仅追加时,FLINK 将默认自动添加 keyed shuffle.<br>这只有在上游保证了多条记录在主键上的顺序的情况下才有效,否则,添加的shuffle不能解决问题(这种情况下,更合适的方法是先考虑对源进行去重操作或使用具有真正反映记录演变的主键定义的 upsert 源).</p>
<p>默认情况下,当 sink 的并行度与上游 operator 不同时,将添加 keyed shuffle.<br>您可以设置为无随机播放(NONE)或强制随机播放(FORCE).</p>
<p>可能的值:<br>&quot;NONE&quot;<br>&quot;AUTO&quot;<br>&quot;FORCE&quot;</p>
<p><code>table.exec.sink.not-null-enforcer</code><br>Batch Streaming/ERROR/Enum<br>确定 Flink 在插入空值时如何强制执行 NOT NULL 列约束.</p>
<p>可能的值:<br>&quot;ERROR&quot;: 将空值写入 NOT NULL 列时引发运行时异常.<br>&quot;DROP&quot;: 如果必须将空值插入 NOT NULL 列,则静默删除记录.</p>
<p><code>table.exec.sink.type-length-enforcer</code><br>Batch Streaming/IGNORE/Enum<br>确定是否将修剪或填充具有 CHAR(<code>&lt;length&gt;</code>)/VARCHAR(<code>&lt;length&gt;</code>)/BINARY(<code>&lt;length&gt;</code>)/VARBINARY(<code>&lt;length&gt;</code>) 类型的列的值(仅适用于 CHAR(<code>&lt;length&gt;</code>)/BINARY (<code>&lt;length&gt;</code>)),以便它们的长度将匹配由它们各自的 CHAR/VARCHAR/BINARY/VARBINARY 列类型的长度定义的长度.</p>
<p>可能的值:<br>&quot;IGNORE&quot;: 不应用任何修剪和填充,而是忽略 CHAR/VARCHAR/BINARY/VARBINARY 长度指令.<br>&quot;TRIM_PAD&quot;: 修剪和填充字符串和二进制值以匹配 CHAR/VARCHAR/BINARY/VARBINARY 长度定义的长度.</p>
<p><code>table.exec.sink.upsert-materialize</code><br>Streaming/AUTO/Enum<br>由于分布式系统中 Shuffle 导致 ChangeLog 数据混乱,Sink 接收到的数据可能不是全局 upsert 的顺序.<br>因此,在 upsert sink 之前添加 upsert materialize 运算符.<br>它接收上游的变更日志记录并为下游生成一个 upsert 视图.</p>
<p>默认情况下,当唯一键出现分布式无序时,会添加具体化操作符.<br>您也可以选择不实现(NONE)或强制实现(FORCE).</p>
<p>可能的值:<br>&quot;NONE&quot;<br>&quot;AUTO&quot;<br>&quot;FORCE&quot;</p>
<p><code>table.exec.sort.async-merge-enabled</code><br>Batch/true/Boolean<br>是否异步合并已排序的溢出文件.</p>
<p><code>table.exec.sort.default-limit</code><br>Batch/-1/Integer<br>用户在 order by 后未设置限制时的默认限制.<br>-1 表示忽略此配置.</p>
<p><code>table.exec.sort.max-num-file-handles</code><br>Batch/128/Integer<br>外部合并排序的最大扇入.<br>它限制每个运算符的文件句柄数.<br>如果太小,可能会导致中间合并.<br>但是如果太大,会导致同时打开的文件太多,消耗内存,导致随机读取.</p>
<p><code>table.exec.source.cdc-events-duplicate</code><br>Streaming/false/Boolean<br>指示作业中的 CDC(更改数据捕获)源是否会产生重复的更改事件,这需要框架进行重复数据删除并获得一致的结果.<br>CDC 源是指产生完整更改事件的源,包括 INSERT/UPDATE_BEFORE/UPDATE_AFTER/DELETE,例如 Debezium 格式的 Kafka 源.<br>此配置的值默认为 false.</p>
<p>但是,存在重复更改事件是一种常见情况.<br>因为通常 CDC 工具(例如 Debezium)在发生故障转移时至少会交付一次.<br>因此,在异常情况下,Debezium 可能会向 Kafka 传递重复的更改事件,而 Flink 会获取重复的事件.<br>这可能会导致 Flink 查询得到错误的结果或意外的异常.</p>
<p>因此,如果您的 CDC 工具是至少一次交付,建议开启此配置.<br>启用此配置需要在 CDC 源上定义 PRIMARY KEY.<br>主键将用于对更改事件进行重复数据删除,并以额外的有状态操作符为代价生成规范化的更改日志流.</p>
<p><code>table.exec.source.idle-timeout</code><br>Streaming/0 ms/Duration<br>当一个源在超时时间内没有收到任何元素时,它将被标记为暂时空闲.<br>这允许下游任务推进其水印,而无需在空闲时等待来自该源的水印.<br>默认值为 0,表示不启用检测源空闲.</p>
<p><code>table.exec.spill-compression.block-size</code><br>Batch/64 kb/MemorySize<br>溢出数据时用于压缩的内存大小.<br>内存越大,压缩比越高,但是作业会消耗更多的内存资源.</p>
<p><code>table.exec.spill-compression.enabled</code><br>Batch/true/Boolean<br>是否压缩溢出的数据.<br>目前我们只支持对 sort 和 hash-agg 和 hash-join 运算符压缩溢出数据.</p>
<p><code>table.exec.state.ttl</code><br>Streaming/0 ms/Duration<br>指定将保留多长时间的空闲状态(即未更新的状态)的最小时间间隔.<br>状态在空闲时间少于最短时间之前永远不会被清除,并且会在空闲后的某个时间被清除.<br>默认是从不清理状态.<br>注意:清理状态需要额外的簿记开销.<br>默认值为 0,这意味着它永远不会清理状态.</p>
<p><code>table.exec.uid.generation</code><br>Streaming/PLAN_ONLY/Enum<br>此配置选项是在 1.15.2 中引入的,用于修复 1.15.0 和 1.15.1 的错误行为.<br>将 PLAN_ONLY 用于新管道,并在有状态补丁版本升级的情况下始终使用.</p>
<p>为了在恢复期间将状态重新映射到操作员,需要为管道的流式传输转换分配一个 UID.</p>
<p>规划器可以生成和分配明确的 UID.<br>如果规划器没有设置 UID,则 UID 将由较低层自动生成,这些层可以将完整的拓扑考虑到 ID 的唯一性.<br>有关详细信息,请参阅 DataStream API.</p>
<p>此配置选项仅供专家使用,默认值应该足以满足大多数用例.<br>默认情况下,只有从持久编译计划创建的管道才会获得显式分配的 UID.<br>因此,这些管道可以在同一拓扑内任意移动,而不会影响稳定的 UID.</p>
<p>可能的值:<br>&quot;PLAN_ONLY&quot;: 推荐用于新的 1.15.2+ 管道.<br>当且仅当管道定义来自已编译计划时,才在流转换上设置 UID.<br>在 API 中构建而没有编译步骤的管道将不会设置显式 UID,因为它可能在多个翻译中不稳定.</p>
<p>&quot;ALWAYS&quot;: 1.15.0 和 1.15.1 中的默认值,推荐用于这些版本的现有管道.<br>始终在流转换上设置 UID.<br>此策略仅供专家使用！在 API 中构建而没有编译步骤的管道可能无法正确恢复.<br>UID 生成取决于先前声明的管道(如果使用相同的 JVM,则可能跨作业).<br>因此,必须确保稳定的环境.<br>来自已编译计划的管道定义可以安全使用.</p>
<p>&quot;DISABLED&quot;: 不会设置显式 UIDt.</p>
<p><code>table.exec.window-agg.buffer-size-limit</code><br>Batch/100000/Integer<br>设置组窗口聚合运算符中使用的窗口元素缓冲区大小限制.</p>
<h3 id="优化器配置"><a href="#优化器配置" class="headerlink" title="优化器配置"></a>优化器配置</h3><p>以下配置可以用于调整查询优化器的行为以获得更好的执行计划.</p>
<p><code>table.optimizer.agg-phase-strategy</code><br>Batch Streaming/&quot;AUTO&quot;/String<br>聚合阶段的策略.<br>只能设置 AUTO/TWO_PHASE 或 ONE_PHASE.<br>AUTO:聚合阶段没有特殊的执行器.<br>选择两级骨料还是一级骨料取决于成本.<br>TWO_PHASE:强制使用具有 localAggregate 和 globalAggregate 的两阶段聚合.<br>请注意,如果聚合调用不支持优化为两阶段,我们仍将使用一阶段聚合.<br>ONE_PHASE:强制使用只有 CompleteGlobalAggregate 的阶段聚合.</p>
<p><code>table.optimizer.distinct-agg.split.bucket-num</code><br>Streaming/1024/Integer<br>配置拆分不同聚合时的桶数.<br>该数字在第一级聚合中用于计算一个bucket key &#39;hash_code(distinct_key) % BUCKET_NUM&#39;,它在拆分后用作附加的group key.</p>
<p><code>table.optimizer.distinct-agg.split.enabled</code><br>Streaming/false/Boolean<br>告诉优化器是否将不同的聚合(例如 COUNT(DISTINCT col)/SUM(DISTINCT col))分成两个级别.<br>第一个聚合被一个额外的键打乱,该键是使用 distinct_key 的哈希码和桶数计算的.<br>当不同聚合中存在数据偏斜时,此优化非常有用,并提供了扩展作业的能力.<br>默认为假.</p>
<p><code>table.optimizer.join-reorder-enabled</code><br>Batch Streaming/false/Boolean<br>在优化器中启用连接重新排序.<br>默认为禁用.</p>
<p><code>table.optimizer.join.broadcast-threshold</code><br>Batch/1048576/Long<br>配置在执行连接时将广播到所有工作节点的表的最大大小(以字节为单位).<br>通过将此值设置为 -1 来禁用广播.</p>
<p><code>table.optimizer.multiple-input-enabled</code><br>Batch/true/Boolean<br>当它为真时,优化器会将流水线洗牌的算子合并成一个多输入算子,以减少洗牌并提高性能.<br>默认值为真.</p>
<p><code>table.optimizer.reuse-source-enabled</code><br>Batch Streaming/true/Boolean<br>当它为真时,优化器将尝试找出重复的表源并重用它们.<br>这仅在 table.optimizer.reuse-sub-plan-enabled 为 true 时有效.</p>
<p><code>table.optimizer.reuse-sub-plan-enabled</code><br>Batch Streaming/true/Boolean<br>当它为真时,优化器将尝试找出重复的子计划并重用它们.</p>
<p><code>table.optimizer.source.aggregate-pushdown-enabled</code><br>Batch/true/Boolean<br>当它为真时,优化器会将本地聚合下推到实现 SupportsAggregatePushDown 的 TableSource 中.</p>
<p><code>table.optimizer.source.predicate-pushdown-enabled</code><br>Batch Streaming/true/Boolean<br>当它为真时,优化器会将谓词下推到 FilterableTableSource 中.<br>默认值为真.</p>
<h3 id="Planner-配置"><a href="#Planner-配置" class="headerlink" title="Planner 配置"></a>Planner 配置</h3><p>以下配置可以用于调整 planner 的行为.</p>
<p><code>table.builtin-catalog-name</code><br>Batch Streaming/&quot;default_catalog&quot;/String<br>实例化 TableEnvironment 时要创建的初始目录的名称.</p>
<p><code>table.builtin-database-name</code><br>Batch Streaming/&quot;default_database&quot;/String<br>实例化 TableEnvironment 时要创建的初始目录中默认数据库的名称.</p>
<p><code>table.dml-sync</code><br>Batch Streaming/false/Boolean<br>指定 DML 作业(即插入操作)是异步执行还是同步执行.<br>默认情况下,执行是异步的,因此您可以同时提交多个 DML 作业.<br>如果将此选项设置为 true,则插入操作将等待作业完成.</p>
<p><code>table.dynamic-table-options.enabled</code><br>Batch Streaming/true/Boolean<br>启用或禁用用于动态指定表选项的 OPTIONS 提示,如果禁用,则在指定任何 OPTIONS 提示时将引发异常</p>
<p><code>table.generated-code.max-length</code><br>Batch Streaming/4000/Integer<br>指定将生成的代码拆分为子函数调用的阈值.<br>Java 的最大方法长度为 64 KB.<br>如有必要,此设置允许更精细的粒度.<br>默认值为 4000 而不是 64KB,因为默认情况下 JIT 拒绝处理超过 8K 字节代码的方法.</p>
<p><code>table.local-time-zone</code><br>Batch Streaming/&quot;default&quot;/String<br>本地时区定义当前会话时区 ID.<br>它在转换到/从 <code>TIMESTAMP WITH LOCAL TIME ZONE</code> 时使用.<br>在内部,具有本地时区的时间戳始终以 UTC 时区表示.<br>但是,当转换为不包含时区的数据类型(例如 TIMESTAMP/TIME 或简单的 STRING)时,会在转换期间使用会话时区.<br>option 的输入可以是全名,例如&quot;America/Los_Angeles&quot;,也可以是自定义时区 ID,例如&quot;GMT-08:00&quot;.</p>
<p><code>table.plan.compile.catalog-objects</code><br>Batch Streaming/ALL/Enum<br>策略如何在编译期间将目录对象(例如表/函数或数据类型)持久化到计划中.</p>
<p>它会影响在还原操作期间存在目录元数据的需求,并影响计划大小.</p>
<p>此配置选项不影响匿名/内联或临时对象.<br>如果可能,匿名/内联对象将完全持久化(包括模式和选项),否则编译失败.<br>临时对象将仅通过其标识符保留,并且该对象需要在恢复期间出现在会话上下文中.</p>
<p>可能的值:<br>&quot;ALL&quot;: 所有关于目录表/函数或数据类型的元数据将在编译期间持久化到计划中.<br>对于目录表,这包括表的标识符/模式和选项.<br>对于目录函数,这包括函数的标识符和类.<br>对于目录数据类型,这包括标识符和整个类型结构.<br>使用此策略,目录的元数据在还原操作期间不必再可用.</p>
<p>&quot;SCHEMA&quot;: 除了标识符之外,关于目录表/函数或数据类型的模式信息将在编译期间持久化到计划中.<br>架构允许在计划恢复操作期间检测目录中的不兼容更改.<br>但是,仍将从目录中检索所有其他元数据.</p>
<p>&quot;IDENTIFIER&quot;: 编译时只会将目录表/函数或数据类型的标识符持久化到计划中.<br>在还原操作期间,将从目录中检索所有元数据.<br>使用这种策略,计划变得不那么冗长.</p>
<p><code>table.plan.force-recompile</code><br>Streaming/false/Boolean<br>如果输出计划文件已经存在,则 COMPILE PLAN 语句将失败,除非使用了子句 IF NOT EXISTS.<br>当为 true 时,COMPILE PLAN 将覆盖现有的输出计划文件.<br>我们强烈建议仅出于调试目的启用此标志.</p>
<p><code>table.plan.restore.catalog-objects</code><br>Batch Streaming/ALL/Enum<br>策略如何使用给定计划恢复目录对象,例如表/函数或数据类型,并在必要时执行目录查找.<br>它会影响对目录元数据的需求,并使计划信息的部分丰富成为可能.</p>
<p>可能的值:<br>&quot;ALL&quot;: 读取计划中已持久化的有关目录表/函数或数据类型的所有元数据.<br>该策略通过标识符执行目录查找以填充缺失的信息或丰富可变选项.<br>如果原始对象在目录中不再可用,如果计划中包含所有必要的信息,仍然可以恢复管道.</p>
<p>&quot;ALL_ENFORCED&quot;: 要求所有关于目录表/函数或数据类型的元数据都已保存在计划中.<br>该策略既不会通过标识符执行目录查找,也不会使用目录信息丰富可变选项.<br>如果计划中未包含所有必要信息,则恢复将失败.</p>
<p>&quot;IDENTIFIER&quot;: 仅使用目录表/函数或数据类型的标识符,并始终执行目录查找.<br>如果原始对象在目录中不再可用,则还原将失败.<br>计划中可能包含的其他元数据将被忽略.</p>
<p><code>table.sql-dialect</code><br>Batch Streaming/&quot;default&quot;/String<br>SQL 方言定义了如何解析 SQL 查询.<br>不同的 SQL 方言可能支持不同的 SQL 语法.<br>目前支持的方言有:default 和 hive</p>
<h3 id="SQL-Client-配置"><a href="#SQL-Client-配置" class="headerlink" title="SQL Client 配置"></a>SQL Client 配置</h3><p>以下配置可以用于调整 sql client 的行为.</p>
<p><code>sql-client.display.max-column-width</code><br>Streaming/30/Integer<br>打印查询结果时,此参数确定截断前屏幕上显示的字符数.<br>这仅适用于流模式下具有可变长度类型(例如 STRING)的列.<br>定长类型和批处理模式下的所有类型都使用打印确定的列宽</p>
<p><code>sql-client.execution.max-table-result.rows</code><br>Batch Streaming/1000000/Integer<br>在表模式下要缓存的行数.<br>如果行数超过指定值,则以 FIFO 样式重试该行.</p>
<p><code>sql-client.execution.result-mode</code><br>Batch Streaming/TABLE/Enum<br>确定应如何显示查询结果.</p>
<p>可能的值:<br>&quot;TABLE&quot;: 在内存中具体化结果,并以常规的分页表表示形式将它们可视化.<br>&quot;CHANGELOG&quot;: 可视化由连续查询产生的结果流.<br>&quot;TABLEAU&quot;: 以表格格式直接在屏幕上显示结果.</p>
<p><code>sql-client.verbose</code><br>Batch Streaming/false/Boolean<br>确定是否将详细输出输出到控制台.<br>如果将选项设置为 true,它将打印异常堆栈.<br>否则,它只输出原因.</p>
<h2 id="用户定义Sources-amp-Sinks"><a href="#用户定义Sources-amp-Sinks" class="headerlink" title="用户定义Sources &amp; Sinks"></a>用户定义Sources &amp; Sinks</h2><p>动态表是 Flink 的 Table &amp; SQL API 的核心概念,用于统一处理有界和无界数据.</p>
<p>因为动态表只是一个逻辑概念,Flink 并不拥有数据本身.<br>相反,动态表的内容存储在外部系统(如数据库/键值存储/消息队列)或文件中.</p>
<p>动态源和动态接收器可用于从外部系统读取数据和向外部系统写入数据.<br>在文档中,源和接收器通常在术语连接器下进行总结.</p>
<p>Flink 为 Kafka/Hive 和不同的文件系统提供了预定义的连接器.<br>有关内置表源和接收器的更多信息,请参阅连接器部分.</p>
<p>本页重点介绍如何开发自定义的用户定义连接器.</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/flink/" rel="tag"># flink</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/08/22/flink%20sql-%E5%87%BD%E6%95%B0/" rel="prev" title="flink sql-函数">
                  <i class="fa fa-chevron-left"></i> flink sql-函数
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/08/22/flink%20sql%20ddl&dml/" rel="next" title="flink sql ddl&dml">
                  flink sql ddl&dml <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>







<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">maoeryu</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  






  





</body>
</html>
